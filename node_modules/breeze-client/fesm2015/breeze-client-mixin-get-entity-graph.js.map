{"version":3,"file":"breeze-client-mixin-get-entity-graph.js","sources":["ng://breeze-client/mixin-get-entity-graph/mixin-get-entity-graph.ts","ng://breeze-client/mixin-get-entity-graph/breeze-client-mixin-get-entity-graph.ts"],"sourcesContent":["//#region Copyright, Version, and Description\r\n/*\r\n * Copyright 2015-2019 IdeaBlade, Inc.  All Rights Reserved.\r\n * Use, reproduction, distribution, and modification of this code is subject to the terms and\r\n * conditions of the IdeaBlade Breeze license, available at http://www.breezejs.com/license\r\n *\r\n * Author: Ward Bell\r\n * Version: 0.9.5 - Steve Schmitt - convert to TypeScript, migrate to breeze-client repo, add HasEntityGraph and mixinEntityGraph\r\n * Version: 0.9.4 - Marcel Good - fix UMD module name\r\n * --------------------------------------------------------------------------------\r\n * Adds getEntityGraph method to Breeze EntityManager prototype.\r\n * Call   mixinEntityGraph(EntityManager)   to apply the mixin in a tree-shaking-resistant way.\r\n * Then   (manager as any).getEntityGraph(entity, \"child\");\r\n *\r\n * Depends on Breeze which it patches\r\n *\r\n * For discussion, see:\r\n * http://www.breezejs.com/documentation/getentitygraph\r\n *\r\n * For example usage, see:\r\n * https://github.com/Breeze/breeze.js.samples/tree/master/net/DocCode/DocCode/tests/getEntityGraphTests.js\r\n */\r\n//#endregion\r\nimport { Entity, EntityManager, EntityQuery, EntityState, EntityType, ExpandClause } from 'breeze-client';\r\n\r\ninterface EntityGroup {\r\n  _entities: (Entity | null)[];\r\n  _indexMap: { [index: string]: number };\r\n}\r\n\r\n// module augmentation failed to build with ng-packagr, so we have a separate interface\r\nexport interface HasEntityGraph extends EntityManager {\r\n  /**\r\n  Get related entities of root entity (or root entities) as specified by expand.\r\n  @example\r\n      var graph = breeze.EntityManager.getEntityGraph(customer, 'Orders.OrderDetails');\r\n      // graph will be the customer, all of its orders and their details even if deleted.\r\n  @method getEntityGraph\r\n  @param roots {Entity|Array of Entity} The root entity or root entities.\r\n  @param expand {String|Array of String|Object} an expand string, a query expand clause, or array of string paths\r\n  @return {Array of Entity} root entities and their related entities, including deleted entities. Duplicates are removed and entity order is indeterminate.\r\n  **/\r\n  getEntityGraph(roots: Entity | Array<Entity>, expand: string | Array<string> | ExpandClause): Array<Entity>;\r\n\r\n  /**\r\n  Execute query locally and return both the query results and their related entities as specified by the optional expand parameter or the query's expand clause.\r\n  @example\r\n      var query = breeze.EntityQuery.from('Customers')\r\n                  .where('CompanyName', 'startsWith', 'Alfred')\r\n                  .expand('Orders.OrderDetails');\r\n      var graph = manager.getEntityGraph(query);\r\n      // graph will be the 'Alfred' customers, their orders and their details even if deleted.\r\n  @method getEntityGraph\r\n  @param query {EntityQuery} A query to be executed against the manager's local cache.\r\n  @param [expand] {String|Array of String|Object} an expand string, a query expand clause, or array of string paths\r\n  @return {Array of Entity} local queried root entities and their related entities, including deleted entities. Duplicates are removed and entity order is indeterminate.\r\n  **/\r\n  getEntityGraph(query: EntityQuery, expand: string | Array<string> | ExpandClause): Array<Entity>;\r\n\r\n}\r\n\r\nexport function mixinEntityGraph(emclass: { new(): EntityManager }) {\r\n  const proto = EntityManager.prototype;\r\n\r\n  if (!(proto as any).getEntityGraph) {\r\n    (proto as any).getEntityGraph = getEntityGraph;\r\n  }\r\n}\r\n\r\nmixinEntityGraph(EntityManager);\r\n\r\n\r\nfunction getEntityGraph(roots: Entity | Array<Entity> | EntityQuery, expand: string | Array<string> | ExpandClause) {\r\n  if (roots instanceof EntityQuery) {\r\n    let newRoots = this.executeQueryLocally(roots);\r\n    return getEntityGraphCore(newRoots, expand || roots.expandClause);\r\n  } else {\r\n    return getEntityGraphCore(roots, expand);\r\n  }\r\n}\r\n\r\nfunction getEntityGraphCore(root: Entity | Array<Entity>, expand: string | Array<string> | ExpandClause) {\r\n  let entityGroupMap: { [index: string]: EntityGroup };\r\n  let graph = [] as Array<Entity>;\r\n  let rootType: EntityType;\r\n  let roots = Array.isArray(root) ? root : [root];\r\n  addToGraph(roots);     // removes dups & nulls\r\n  roots = graph.slice(); // copy of de-duped roots\r\n  if (roots.length) {\r\n    getRootInfo();\r\n    getExpand();\r\n    buildGraph();\r\n  }\r\n  return graph;\r\n\r\n  function addToGraph(entities: Array<Entity>) {\r\n    entities.forEach(function (entity) {\r\n      if (entity && graph.indexOf(entity) < 0) {\r\n        graph.push(entity);\r\n      }\r\n    });\r\n  }\r\n\r\n  function getRootInfo() {\r\n    let compatTypes: Array<EntityType>;\r\n\r\n    roots.forEach(function (root, ix) {\r\n      let aspect;\r\n      if (!root || !(aspect = root.entityAspect)) {\r\n        throw getRootErr(ix, 'is not an entity');\r\n      }\r\n      if (aspect.entityState === EntityState.Detached) {\r\n        throw getRootErr(ix, 'is a detached entity');\r\n      }\r\n\r\n      let em = aspect.entityManager;\r\n      if (entityGroupMap) {\r\n        if (entityGroupMap !== em._entityGroupMap) {\r\n          throw getRootErr(ix, \"has a different 'EntityManager' than other roots\");\r\n        }\r\n      } else {\r\n        entityGroupMap = em._entityGroupMap;\r\n      }\r\n      getRootType(root, ix);\r\n\r\n    });\r\n\r\n    function getRootErr(ix: number, msg: string) {\r\n      return new Error(\"'getEntityGraph' root[\" + ix + \"] \" + msg);\r\n    }\r\n\r\n    function getRootType(root: Entity, ix: number) {\r\n      let thisType = root.entityType;\r\n      if (!rootType) {\r\n        rootType = thisType;\r\n        return;\r\n      } else if (rootType === thisType) {\r\n        return;\r\n      }\r\n      // Types differs. Look for closest common base type\r\n      // does thisType derive from current rootType?\r\n      let baseType = rootType;\r\n      do {\r\n        compatTypes = compatTypes || baseType.getSelfAndSubtypes();\r\n        if (compatTypes.indexOf(thisType) > -1) {\r\n          rootType = baseType;\r\n          return;\r\n        }\r\n        baseType = baseType.baseEntityType;\r\n        compatTypes = null;\r\n      } while (baseType);\r\n\r\n      // does current rootType derives from thisType?\r\n      baseType = thisType;\r\n      do {\r\n        compatTypes = baseType.getSelfAndSubtypes();\r\n        if (compatTypes.indexOf(rootType) > -1) {\r\n          rootType = baseType;\r\n          return;\r\n        }\r\n        baseType = baseType.baseEntityType;\r\n      } while (baseType);\r\n\r\n      throw getRootErr(ix, \"is not EntityType-compatible with other roots\");\r\n    }\r\n  }\r\n\r\n  function getExpand() {\r\n    try {\r\n      if (!expand) {\r\n        expand = [];\r\n      } else if (typeof expand === 'string') {\r\n        // tricky because Breeze expandClause not exposed publically\r\n        expand = new EntityQuery().expand(expand).expandClause;\r\n      }\r\n      if (expand instanceof ExpandClause && expand.propertyPaths) { // expand clause\r\n        expand = expand.propertyPaths;\r\n      } else if (Array.isArray(expand)) {\r\n        if (!expand.every(function (elem) { return typeof elem === 'string'; })) {\r\n          throw '';\r\n        }\r\n      } else {\r\n        throw '';\r\n      }\r\n    } catch (_) {\r\n      throw new Error(\r\n        \"expand must be an expand string, array of string paths, or a query expand clause\");\r\n    }\r\n  }\r\n\r\n  function buildGraph() {\r\n    if (expand && expand instanceof Array && expand.length) {\r\n      let fns = expand.map(makePathFn);\r\n      fns.forEach(function (fn) { fn(roots); });\r\n    }\r\n  }\r\n\r\n  // Make function to get entities along a single expand path\r\n  // such as 'Orders.OrderDetails.Product'\r\n  function makePathFn(path: string) {\r\n    let fns = [] as Array<Function>,\r\n      segments = path.split('.'),\r\n      type = rootType;\r\n\r\n    for (let i = 0, slen = segments.length; i < slen; i++) {\r\n      let f = makePathSegmentFn(type, segments[i]);\r\n      type = (f as any).navType;\r\n      fns.push(f);\r\n    }\r\n\r\n    return function pathFn(entities: Array<Entity>) {\r\n      for (let j = 0, flen = fns.length; j < flen; j++) {\r\n        let elen = entities.length;\r\n        if (elen === 0) { return; } // nothing left to explore\r\n        // fn to get related entities for this path segment\r\n        let fn = fns[j];\r\n        // get entities related by this path segment\r\n        let related = [] as Array<Entity>;\r\n        for (let k = 0; k < elen; k++) {\r\n          related = related.concat(fn(entities[k]));\r\n        }\r\n        addToGraph(related);\r\n        if (j >= flen - 1) { return; } // no more path segments\r\n\r\n        // reset entities to deduped related entities\r\n        entities = [];\r\n        for (let l = 0, rlen = related.length; l < rlen; l++) {\r\n          let r = related[l];\r\n          if (entities.indexOf(r) < 0) { entities.push(r); }\r\n        }\r\n      }\r\n    };\r\n  }\r\n\r\n  // Make function to get entities along a single expand path segment\r\n  // such as the 'OrderDetails' in the 'Orders.OrderDetails.Product' path\r\n  function makePathSegmentFn(baseType: EntityType, segment: string) {\r\n    let baseTypeName: string, fn = undefined, navType;\r\n    try {\r\n      baseTypeName = baseType.name;\r\n      let nav = baseType.getNavigationProperty(segment);\r\n      let fkName = nav.foreignKeyNames[0];\r\n      if (!nav) {\r\n        throw new Error(segment + \" is not a navigation property of \" + baseTypeName);\r\n      }\r\n      navType = nav.entityType;\r\n      // add derived types\r\n      let navTypes = navType.getSelfAndSubtypes();\r\n      let grps = [] as Array<EntityGroup>; // non-empty groups for these types\r\n      navTypes.forEach(function (t) {\r\n        let grp = entityGroupMap[t.name];\r\n        if (grp && grp._entities.length > 0) {\r\n          grps.push(grp);\r\n        }\r\n      });\r\n      let grpCount = grps.length;\r\n      if (grpCount === 0) {\r\n        // no related entities in cache\r\n        fn = function () { return [] as Array<Entity>; };\r\n      } else if (fkName) {\r\n        fn = function (entity: Entity) {\r\n          let val = null;\r\n          try {\r\n            let keyValue = entity.getProperty(fkName);\r\n            for (let i = 0; i < grpCount; i += 1) {\r\n              val = grps[i]._entities[grps[i]._indexMap[keyValue]];\r\n              if (val) { break; }\r\n            }\r\n          } catch (e) { rethrow(e); }\r\n          return val;\r\n        };\r\n      } else {\r\n        fkName = nav.inverse ?\r\n          nav.inverse.foreignKeyNames[0] :\r\n          nav.invForeignKeyNames[0];\r\n        if (!fkName) { throw new Error(\"No inverse keys\"); }\r\n        fn = function (entity: Entity) {\r\n          let vals = [] as Array<Entity>;\r\n          try {\r\n            let keyValue = entity.entityAspect.getKey().values[0];\r\n            grps.forEach(function (grp) {\r\n              vals = vals.concat(grp._entities.filter(function (en) {\r\n                return en && en.getProperty(fkName) === keyValue;\r\n              }));\r\n            });\r\n          } catch (e) { rethrow(e); }\r\n          return vals;\r\n        };\r\n      }\r\n      (fn as any).navType = navType;\r\n      (fn as any).path = segment;\r\n\r\n    } catch (err) { rethrow(err); }\r\n    return fn;\r\n\r\n    function rethrow(e: Error) {\r\n      let typeName = baseTypeName || baseType;\r\n      let error = new Error(\"'getEntityGraph' can't expand '\" + segment + \"' for \" + typeName);\r\n      (error as any).innerError = e;\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n\r\n\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './mixin-get-entity-graph';\n"],"names":[],"mappings":"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"}