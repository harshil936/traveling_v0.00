{"version":3,"file":"breeze-client-adapter-ajax-jquery.js","sources":["ng://breeze-client/adapter-ajax-jquery/adapter-ajax-jquery.ts","ng://breeze-client/adapter-ajax-jquery/breeze-client-adapter-ajax-jquery.ts"],"sourcesContent":["import * as breeze from 'breeze-client';\r\n\r\ndeclare var jQuery: any;\r\nlet core = breeze.core;\r\n\r\nexport class AjaxJQueryAdapter implements breeze.AjaxAdapter {\r\n  name: string;\r\n  defaultSettings: { headers?: any };\r\n  requestInterceptor?: (() => breeze.ChangeRequestInterceptor) | breeze.ChangeRequestInterceptor;\r\n  jQuery: any;\r\n\r\n  constructor() {\r\n    this.name = \"jQuery\";\r\n    this.defaultSettings = { };\r\n    this.requestInterceptor = undefined;\r\n  }\r\n\r\n  static register(config?: breeze.BreezeConfig) {\r\n    config = config || breeze.config;\r\n    config.registerAdapter(\"ajax\", AjaxJQueryAdapter);\r\n    return config.initializeAdapterInstance(\"ajax\", \"jQuery\", true) as AjaxJQueryAdapter;\r\n  }\r\n\r\n  initialize() {\r\n    this.jQuery = jQuery;\r\n    // look for the jQuery lib but don't fail immediately if not found\r\n    if (!jQuery) {\r\n      this.jQuery = core.requireLib(\"jQuery;jquery\");\r\n    }\r\n  }\r\n\r\n  ajax(config: breeze.AjaxConfig) {\r\n    if (!this.jQuery) {\r\n      throw new Error(\"Unable to locate jQuery\");\r\n    }\r\n    let jqConfig = {\r\n      type: config.type,\r\n      url: config.url,\r\n      data: config.params || config.data,\r\n      dataType: config.dataType,\r\n      contentType: config.contentType,\r\n      crossDomain: config.crossDomain,\r\n      headers: config.headers || {}\r\n    };\r\n\r\n    if (!core.isEmpty(this.defaultSettings)) {\r\n      let compositeConfig = core.extend({}, this.defaultSettings);\r\n      jqConfig = core.extend(compositeConfig, jqConfig) as any;\r\n      // extend is shallow; extend headers separately\r\n      let headers = core.extend({}, this.defaultSettings.headers); // copy default headers 1st\r\n      jqConfig.headers = core.extend(headers, jqConfig.headers);\r\n    }\r\n\r\n    let requestInfo = {\r\n      adapter: this,      // this adapter\r\n      config: jqConfig,   // jQuery's ajax 'settings' object\r\n      dsaConfig: config,  // the config arg from the calling Breeze DataServiceAdapter\r\n      success: successFn, // adapter's success callback\r\n      error: errorFn,      // adapter's error callback\r\n    };\r\n\r\n    if (core.isFunction(this.requestInterceptor)) {\r\n      let ri = this.requestInterceptor as any;\r\n      ri(requestInfo);\r\n      if (ri.oneTime) {\r\n        this.requestInterceptor = undefined;\r\n      }\r\n    }\r\n\r\n    if (requestInfo.config) { // exists unless requestInterceptor killed it.\r\n      (requestInfo as any).jqXHR = this.jQuery.ajax(requestInfo.config)\r\n        .done(requestInfo.success)\r\n        .fail(requestInfo.error);\r\n    }\r\n\r\n    function successFn(data: any, statusText: string, jqXHR: XMLHttpRequest) {\r\n      let httpResponse = {\r\n        config: config,\r\n        data: data,\r\n        getHeaders: getHeadersFn(jqXHR),\r\n        status: jqXHR.status,\r\n        statusText: statusText\r\n      };\r\n      config.success(httpResponse);\r\n      // TODO: not sure how to do this or if needed.\r\n      // jqXHR.onreadystatechange = null;\r\n      // jqXHR.abort = null;\r\n    }\r\n\r\n    function errorFn(jqXHR: XMLHttpRequest, statusText: string, errorThrown: any) {\r\n      let httpResponse = {\r\n        config: config,\r\n        data: jqXHR.responseText,\r\n        error: errorThrown,\r\n        getHeaders: getHeadersFn(jqXHR),\r\n        status: jqXHR.status,\r\n        statusText: statusText\r\n      };\r\n      config.error(httpResponse);\r\n      // TODO: not sure how to do this or if needed.\r\n      // jqXHR.onreadystatechange = null;\r\n      // jqXHR.abort = null;\r\n    }\r\n  }\r\n}\r\n\r\nbreeze.config.registerAdapter(\"ajax\", AjaxJQueryAdapter);\r\n\r\nfunction getHeadersFn(jqXHR: XMLHttpRequest): any {\r\n  if (jqXHR.status === 0) { // timeout or abort; no headers\r\n    return function (headerName: string) {\r\n      return (headerName && headerName.length > 0) ? \"\" : {};\r\n    };\r\n  } else { // jqXHR should have header functions\r\n    return function (headerName: string) {\r\n      return (headerName && headerName.length > 0) ?\r\n        jqXHR.getResponseHeader(headerName) :\r\n        jqXHR.getAllResponseHeaders();\r\n    };\r\n  }\r\n}\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './adapter-ajax-jquery';\n"],"names":["breeze.core","config","breeze.config"],"mappings":"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"}