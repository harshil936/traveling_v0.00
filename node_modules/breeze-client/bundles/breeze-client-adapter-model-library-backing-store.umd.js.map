{"version":3,"file":"breeze-client-adapter-model-library-backing-store.umd.js","sources":["ng://breeze-client/adapter-model-library-backing-store/adapter-model-library-backing-store.ts"],"sourcesContent":["import * as breeze from 'breeze-client';\r\n\r\nlet core = breeze.core;\r\n\r\nexport class ModelLibraryBackingStoreAdapter implements breeze.ModelLibraryAdapter {\r\n  name: string;\r\n\r\n  constructor() {\r\n    this.name = \"backingStore\";\r\n  }\r\n\r\n  static register(config?: breeze.BreezeConfig) {\r\n    config = config || breeze.config;\r\n    config.registerAdapter(\"modelLibrary\", ModelLibraryBackingStoreAdapter);\r\n    return config.initializeAdapterInstance(\"modelLibrary\", \"backingStore\", true) as ModelLibraryBackingStoreAdapter;\r\n  }\r\n\r\n  initialize() {\r\n  }\r\n\r\n  getTrackablePropertyNames(entity: breeze.Entity) {\r\n    let names: string[] = [];\r\n    for (let p in entity) {\r\n      if (p === \"entityAspect\" || p === \"entityType\") continue;\r\n      if (p === \"_$typeName\" || p === \"_pendingSets\" || p === \"_backingStore\") continue;\r\n      let val = entity[p];\r\n      if (!core.isFunction(val)) {\r\n        names.push(p);\r\n      }\r\n    }\r\n    return names;\r\n  }\r\n\r\n  // This method is called during Metadata initialization\r\n  initializeEntityPrototype(proto: any) {\r\n\r\n    proto.getProperty = function (propertyName: string) {\r\n      return this[propertyName];\r\n    };\r\n\r\n    proto.setProperty = function (propertyName: string, value: any) {\r\n      //if (!this._backingStore.hasOwnProperty(propertyName)) {\r\n      //    throw new Error(\"Unknown property name:\" + propertyName);\r\n      //}\r\n      this[propertyName] = value;\r\n      // allow setProperty chaining.\r\n      return this;\r\n    };\r\n\r\n    movePropDefsToProto(proto);\r\n  }\r\n\r\n  // This method is called when an EntityAspect is first created - this will occur as part of the entityType.createEntity call.\r\n  // which can be called either directly or via standard query materialization\r\n\r\n  // entity is either an entity or a complexObject\r\n  startTracking(entity: breeze.StructuralObject, proto: any) {\r\n    // can't touch the normal property sets within this method - access the backingStore directly instead.\r\n    let bs = movePropsToBackingStore(entity);\r\n\r\n    // assign default values to the entity\r\n    let stype = breeze.EntityAspect.isEntity(entity) ? entity.entityType : entity.complexType;\r\n    stype.getProperties().forEach(function (prop) {\r\n\r\n      let propName = prop.name;\r\n      let val = entity[propName];\r\n\r\n      if (prop instanceof breeze.DataProperty) {\r\n        if (prop.isComplexProperty) {\r\n          if (prop.isScalar) {\r\n            val = (prop.dataType as breeze.ComplexType)._createInstanceCore(entity, prop);\r\n          } else {\r\n            val = breeze.makeComplexArray([], entity, prop);\r\n          }\r\n        } else if (!prop.isScalar) {\r\n          val = breeze.makePrimitiveArray([], entity, prop);\r\n        } else if (val === undefined) {\r\n          val = prop.defaultValue;\r\n        }\r\n\r\n      } else if (prop.isNavigationProperty) {\r\n        if (val !== undefined && val !== null) {\r\n          throw new Error(\"Cannot assign a navigation property in an entity ctor.: \" + propName);\r\n        }\r\n        if (prop.isScalar) {\r\n          // TODO: change this to nullstob later.\r\n          val = null;\r\n        } else {\r\n          val = breeze.makeRelationArray([], entity as breeze.Entity, prop);\r\n        }\r\n      } else {\r\n        throw new Error(\"unknown property: \" + propName);\r\n      }\r\n      // can't touch the normal property sets within this method (IE9 Bug) - so we access the backingStore directly instead.\r\n      // otherwise we could just do\r\n      // entity[propName] = val\r\n      // after all of the interception logic had been injected.\r\n      if ((prop as breeze.DataProperty).isSettable || prop.isNavigationProperty) {\r\n        bs[propName] = val;\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nbreeze.config.registerAdapter(\"modelLibrary\", ModelLibraryBackingStoreAdapter);\r\n\r\n// private methods\r\n\r\n// This method is called during Metadata initialization to correctly \"wrap\" properties.\r\nfunction movePropDefsToProto(proto: any) {\r\n  let stype = (proto.entityType || proto.complexType) as breeze.StructuralType;\r\n  let extra = stype._extra;\r\n\r\n  let alreadyWrapped = extra.alreadyWrappedProps || {};\r\n\r\n  stype.getProperties().forEach(function (prop) {\r\n    let propName = prop.name;\r\n    // we only want to wrap props that haven't already been wrapped\r\n    if (alreadyWrapped[propName]) return;\r\n\r\n    // If property is already defined on the prototype then wrap it in another propertyDescriptor.\r\n    // otherwise create a propDescriptor for it.\r\n    let descr: any;\r\n    if (propName in proto) {\r\n      descr = wrapPropDescription(proto, prop);\r\n    } else {\r\n      descr = makePropDescription(proto, prop);\r\n    }\r\n    // descr will be null for a wrapped descr that is not configurable\r\n    if (descr != null) {\r\n      Object.defineProperty(proto, propName, descr);\r\n    }\r\n    alreadyWrapped[propName] = true;\r\n  });\r\n  extra.alreadyWrappedProps = alreadyWrapped;\r\n}\r\n\r\n// This method is called when an instance is first created via materialization or createEntity.\r\n// this method cannot be called while a 'defineProperty' accessor is executing\r\n// because of IE bug mentioned above.\r\n\r\nfunction movePropsToBackingStore(instance: any) {\r\n\r\n  let bs = getBackingStore(instance);\r\n  let proto = Object.getPrototypeOf(instance);\r\n  let stype = (proto.entityType || proto.complexType) as breeze.StructuralType;\r\n  stype.getProperties().forEach(function (prop) {\r\n    let propName = prop.name;\r\n    if (prop.isUnmapped) {\r\n      // insure that any unmapped properties that were added after entityType\r\n      // was first created are wrapped with a property descriptor.\r\n      if (!core.getPropertyDescriptor(proto, propName)) {\r\n        let descr = makePropDescription(proto, prop);\r\n        Object.defineProperty(proto, propName, descr);\r\n      }\r\n    }\r\n    if (!instance.hasOwnProperty(propName)) return;\r\n    // pulls off the value, removes the instance property and then rewrites it via ES5 accessor\r\n    let value = instance[propName];\r\n    delete instance[propName];\r\n    instance[propName] = value;\r\n  });\r\n  return bs;\r\n}\r\n\r\nfunction makePropDescription(proto: any, property: breeze.EntityProperty) {\r\n  let propName = property.name;\r\n  let pendingStores = proto._pendingBackingStores;\r\n  if (!pendingStores) {\r\n    pendingStores = [];\r\n    proto._pendingBackingStores = pendingStores;\r\n  }\r\n  let descr = {\r\n    get: function () {\r\n      let bs = this._backingStore || getBackingStore(this);\r\n      return bs[propName];\r\n    },\r\n    set: function (value: any) {\r\n      // IE9 cannot touch instance._backingStore here\r\n      let bs = this._backingStore || getPendingBackingStore(this);\r\n      let accessorFn = getAccessorFn(bs, propName);\r\n      this._$interceptor(property, value, accessorFn);\r\n    },\r\n    enumerable: true,\r\n    configurable: true\r\n  };\r\n\r\n  (descr.set as any).rawSet = function (value: any) {\r\n    let bs = this._backingStore || getPendingBackingStore(this);\r\n    let accessorFn = getAccessorFn(bs, propName);\r\n    accessorFn(value);\r\n  };\r\n  return descr;\r\n\r\n}\r\n\r\nfunction getAccessorFn(bs: {}, propName: string): any {\r\n  return function () {\r\n    if (arguments.length === 0) {\r\n      return bs[propName];\r\n    } else {\r\n      bs[propName] = arguments[0];\r\n      return undefined;\r\n    }\r\n  };\r\n}\r\n\r\nfunction wrapPropDescription(proto: any, property: breeze.EntityProperty): any {\r\n  if (!proto.hasOwnProperty(property.name)) {\r\n    let nextProto = Object.getPrototypeOf(proto);\r\n    return wrapPropDescription(nextProto, property);\r\n  }\r\n\r\n  let propDescr = Object.getOwnPropertyDescriptor(proto, property.name);\r\n  if (!propDescr) return undefined;\r\n  // if not configurable; we can't touch it - so leave.\r\n  if (!propDescr.configurable) return undefined;\r\n  // if a data descriptor - don't change it - this is basically a static property - i.e. defined on every instance of the type with the same value.\r\n  if (propDescr.value) return undefined;\r\n  // if a read only property descriptor - no need to change it.\r\n  if (!propDescr.set) return undefined;\r\n\r\n  let localAccessorFn = function (entity: any) {\r\n    return function () {\r\n      if (!propDescr) return undefined;\r\n      if (arguments.length === 0) {\r\n        return propDescr.get!.bind(entity)();\r\n      } else {\r\n        let set = propDescr.set;\r\n        let rawSet = (set as any).rawSet || set;\r\n        rawSet.bind(entity)(arguments[0]);\r\n        return undefined;\r\n      }\r\n    };\r\n  };\r\n\r\n  let newDescr = {\r\n    get: function () {\r\n      if (!propDescr) return undefined;\r\n      return propDescr.get!.bind(this)();\r\n    },\r\n    set: function (value: any) {\r\n      this._$interceptor(property, value, localAccessorFn(this));\r\n    },\r\n    enumerable: propDescr.enumerable,\r\n    configurable: true\r\n  };\r\n  (newDescr.set as any).rawSet = propDescr.set;\r\n  return newDescr;\r\n}\r\n\r\n\r\nfunction getBackingStore(instance: any) {\r\n  let proto = Object.getPrototypeOf(instance);\r\n  processPendingStores(proto);\r\n  let bs = instance._backingStore;\r\n  if (!bs) {\r\n    bs = {};\r\n    instance._backingStore = bs;\r\n  }\r\n  return bs;\r\n}\r\n\r\n// workaround for IE9 bug where instance properties cannot be changed when executing a property 'set' method.\r\nfunction getPendingBackingStore(instance: any) {\r\n  let proto = Object.getPrototypeOf(instance);\r\n  let pendingStores = proto._pendingBackingStores;\r\n  let pending = core.arrayFirst(pendingStores, function (pending) {\r\n    return pending.entity === instance;\r\n  });\r\n  if (pending) return (pending as any).backingStore;\r\n  let bs = {};\r\n  pendingStores.push({ entity: instance, backingStore: bs });\r\n  return bs;\r\n}\r\n\r\nfunction processPendingStores(proto: any) {\r\n  let pendingStores = proto._pendingBackingStores;\r\n  if (pendingStores) {\r\n    pendingStores.forEach(function (pending: any) {\r\n      pending.entity._backingStore = pending.backingStore;\r\n    });\r\n    pendingStores.length = 0;\r\n  }\r\n}\r\n\r\n"],"names":["breeze.core","config","breeze.config","breeze.EntityAspect","breeze.DataProperty","breeze.makeComplexArray","breeze.makePrimitiveArray","breeze.makeRelationArray"],"mappings":"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"}