import * as tslib_1 from "tslib";
import { core } from './core';
import { EntityType, DataProperty } from './entity-metadata';
import { DataType } from './data-type';
import { EntityAspect } from './entity-aspect';
/**
Used to define a 'where' predicate for an [[EntityQuery]].  Predicates are immutable, which means that any
method that would modify a Predicate actually returns a new Predicate.
**/
var Predicate = /** @class */ (function () {
    /**
    Predicate constructor
    >     let p1 = new Predicate("CompanyName", "StartsWith", "B");
    >     let query = new EntityQuery("Customers").where(p1);
  
    or
    >     let p2 = new Predicate("Region", FilterQueryOp.Equals, null);
    >     let query = new EntityQuery("Customers").where(p2);
    @param property - A property name, a nested property name or an expression involving a property name.
    @param operator -
    @param value - This will be treated as either a property expression or a literal depending on context.  In general,
    if the value can be interpreted as a property expression it will be, otherwise it will be treated as a literal.
    In most cases this works well, but you can also force the interpretation by making the value argument itself an object with a 'value'
    property and an 'isLiteral' property set to either true or false.  Breeze also tries to infer the dataType of any
    literal based on context, if this fails you can force this inference by making the value argument an object with a
    'value' property and a 'dataType' property set to one of the breeze.DataType enumeration instances.
    **/
    function Predicate() {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        if (args.length === 0)
            return;
        if (!(this instanceof Predicate)) {
            return new (Predicate.bind.apply(Predicate, tslib_1.__spread([void 0], args)))();
        }
        return Predicate.create.apply(Predicate, tslib_1.__spread(args));
    }
    /**
    Same as using the ctor.
    >      // so
    >      let p = Predicate.create(a, b, c);
    >      // is the same as
    >      let p = new Predicate(a, b, c);
    @param property -  A property name, a nested property name or an expression involving a property name.
    @param operator - the filter query operator.
    @param value - This will be treated as either a property expression or a literal depending on context.  In general,
    if the value can be interpreted as a property expression it will be, otherwise it will be treated as a literal.
    In most cases this works well, but you can also force the interpretation by making the value argument itself an object with a 'value'
    property and an 'isLiteral' property set to either true or false.  Breeze also tries to infer the dataType of any
    literal based on context, if this fails you can force this inference by making the value argument an object with a
    'value' property and a 'dataType' property set to one of the breeze.DataType enumeration instances.
    **/
    Predicate.create = function () {
        // can be called from std javascript without new ( legacy )
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        // empty ctor is used by all subclasses.
        if (args.length === 0)
            return new Predicate();
        if (args.length === 1) {
            // possibilities:
            //      Predicate([ aPredicate ]) or  Predicate(["freight", ">", 100]) - an array
            //      Predicate(aPredicate) - a predicate
            //      Predicate( "freight gt 100" }  // passthru ( i.e. maybe an odata string) - a string
            //      Predicate( { freight: { ">": 100 } }) - an object
            var arg = arguments[0];
            if (Array.isArray(arg)) {
                if (arg.length === 1) {
                    // recurse
                    return new Predicate(arg[0]);
                }
                else {
                    return createPredicateFromArray(arg);
                }
            }
            else if (arg instanceof Predicate) {
                return arg;
            }
            else if (typeof arg === 'string') {
                return new PassthruPredicate(arg);
            }
            else {
                return createPredicateFromObject(arg);
            }
        }
        else {
            // 2 possibilities
            //      Predicate("freight", ">", 100");
            //      Predicate("orders", "any", "freight",  ">", 950);
            return createPredicateFromArray(args);
        }
    };
    /** @hidden @internal */
    Predicate.prototype._validate = function (entityType, usesNameOnServer) {
        // noop here;
    };
    /**
    Creates a 'composite' Predicate by 'and'ing a set of specified Predicates together.
    >      let dt = new Date(88, 9, 12);
    >      let p1 = Predicate.create("OrderDate", "ne", dt);
    >      let p2 = Predicate.create("ShipCity", "startsWith", "C");
    >      let p3 = Predicate.create("Freight", ">", 100);
    >      let newPred = Predicate.and(p1, p2, p3);
  
    or
    >      let preds = [p1, p2, p3];
    >      let newPred = Predicate.and(preds);
    @param predicates - multiple Predicates or an array of Predicate.
    Any null or undefined values passed in will be automatically filtered out before constructing the composite predicate.
    **/
    Predicate.and = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        var pred = new AndOrPredicate("and", args);
        // TODO removed below
        // return undefined if empty
        // return pred.op && pred;
        return pred;
    };
    /**
    Creates a 'composite' Predicate by 'or'ing a set of specified Predicates together.
    >      let dt = new Date(88, 9, 12);
    >      let p1 = Predicate.create("OrderDate", "ne", dt);
    >      let p2 = Predicate.create("ShipCity", "startsWith", "C");
    >      let p3 = Predicate.create("Freight", ">", 100);
    >      let newPred = Predicate.or(p1, p2, p3);
  
    or
    >      let preds = [p1, p2, p3];
    >      let newPred = Predicate.or(preds);
    @param predicates - multiple Predicates or an array of Predicate.
    Any null or undefined values passed in will be automatically filtered out before constructing the composite predicate.
    **/
    Predicate.or = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        var pred = new AndOrPredicate("or", args);
        // return pred.op && pred;
        return pred;
    };
    /**
    Creates a 'composite' Predicate by 'negating' a specified predicate.
    >      let p1 = Predicate.create("Freight", "gt", 100);
    >      let not_p1 = Predicate.not(p1);
  
    This can also be accomplished using the 'instance' version of the 'not' method
    >      let not_p1 = p1.not();
  
    Both of which would be the same as
    >      let not_p1 = Predicate.create("Freight", "le", 100);
    **/
    Predicate.not = function (pred) {
        return pred.not();
    };
    // TODO: determine if/where this is used.
    // static extendBinaryPredicateFn(opMap: IOpMap, visitorFn: any) {
    //   let baseVisitorFn = toFunctionVisitor.binaryPredicate;
    //   for (let op in (opMap || {})) {
    //     let config = opMap[op];
    //     config.visitorFn = visitorFn;
    //     updateAliasMap(BinaryPredicate.prototype.aliasMap, op, opMap[op]);
    //   }
    //   if (!toFunctionVisitor.isExtended) {
    //     toFunctionVisitor.binaryPredicate = function (context, expr1Val, expr2Val) {
    //       let visitorFn = this.aliasMap[this.op.key].visitorFn;
    //       if (visitorFn) {
    //         return visitorFn(context, expr1Val, expr2Val);
    //       } else {
    //         return baseVisitorFn(context, expr1Val, expr2Val);
    //       }
    //     };
    //     toFunctionVisitor.isExtended = true;
    //   }
    // };
    /**
    'And's this Predicate with one or more other Predicates and returns a new 'composite' Predicate
    >      let dt = new Date(88, 9, 12);
    >      let p1 = Predicate.create("OrderDate", "ne", dt);
    >      let p2 = Predicate.create("ShipCity", "startsWith", "C");
    >      let p3 = Predicate.create("Freight", ">", 100);
    >      let newPred = p1.and(p2, p3);
  
    or
    >      let preds = [p2, p3];
    >      let newPred = p1.and(preds);
  
    The 'and' method is also used to write "fluent" expressions
    >      let p4 = Predicate.create("ShipCity", "startswith", "F")
    >        .and("Size", "gt", 2000);
    @param predicates - multiple Predicates or an array of Predicates.
    Any null or undefined values passed in will be automatically filtered out before constructing the composite predicate.
    **/
    Predicate.prototype.and = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        return new AndOrPredicate("and", argsForAndOrPredicates(this, args));
    };
    /**
    'Or's this Predicate with one or more other Predicates and returns a new 'composite' Predicate
    >      let dt = new Date(88, 9, 12);
    >      let p1 = Predicate.create("OrderDate", "ne", dt);
    >      let p2 = Predicate.create("ShipCity", "startsWith", "C");
    >      let p3 = Predicate.create("Freight", ">", 100);
    >      let newPred = p1.or(p2, p3);
  
    or
    >      let preds = [p2, p3];
    >      let newPred = p1.or(preds);
  
    The 'or' method is also used to write "fluent" expressions
    >      let p4 = Predicate.create("ShipCity", "startswith", "F")
    >        .or("Size", "gt", 2000);
    @param predicates - multiple Predicates or an array of Predicates.
    Any null or undefined values passed in will be automatically filtered out before constructing the composite predicate.
    **/
    Predicate.prototype.or = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        return new AndOrPredicate("or", argsForAndOrPredicates(this, args));
    };
    /**
    Returns the 'negated' version of this Predicate
    >      let p1 = Predicate.create("Freight", "gt", 100);
    >      let not_p1 = p1.not();
  
    This can also be accomplished using the 'static' version of the 'not' method
    >      let p1 = Predicate.create("Freight", "gt", 100);
    >      let not_p1 = Predicate.not(p1);
  
    which would be the same as
    >      let not_p1 = Predicate.create("Freight", "le", 100);
    **/
    Predicate.prototype.not = function () {
        return new UnaryPredicate("not", this);
    };
    //
    Predicate.prototype.toJSON = function () {
        // toJSON ( part of js standard - takes a single parameter
        // that is either "" or the name of the property being serialized.
        return this.toJSONExt({ entityType: this._entityType });
    };
    /** For use by breeze plugin authors only. The class is for use in building a [[IUriBuilderAdapter]] implementation.
    @adapter (see [[IUriBuilderAdapter]])
    @hidden @internal
    */
    Predicate.prototype.toJSONExt = function (context) {
        return this.visit(context, toJSONVisitor);
    };
    /** For use by breeze plugin authors only. The class is for use in building a [[IUriBuilderAdapter]] implementation.
    @adapter (see [[IUriBuilderAdapter]])
    @hidden @internal
    */
    Predicate.prototype.toFunction = function (context) {
        return this.visit(context, toFunctionVisitor);
    };
    Predicate.prototype.toString = function () {
        return JSON.stringify(this);
    };
    /** For use by breeze plugin authors only. The class is for use in building a [[IUriBuilderAdapter]] implementation.
    @adapter (see [[IUriBuilderAdapter]])
    @hidden @internal
    */
    Predicate.prototype.visit = function (context, visitor) {
        if (core.isEmpty(context)) {
            context = { entityType: undefined };
        }
        else if (context instanceof EntityType) {
            context = { entityType: context };
        }
        else if (!core.hasOwnProperty(context, "entityType")) {
            throw new Error("All visitor methods must be called with a context object containing at least an 'entityType' property");
        }
        if (visitor) {
            context.visitor = visitor;
        }
        var tVisitor = visitor || context.visitor;
        var fn = tVisitor[this.visitorMethodName];
        if (fn == null) {
            throw new Error("Unable to locate method: " + this.visitorMethodName + " on visitor");
        }
        var entityType = context.entityType;
        // don't bother validating if already done so ( or if no _validate method
        if (this._validate && (entityType == null || this._entityType !== entityType)) {
            // don't need to capture return value because validation fn doesn't have one.
            // TODO: this was old code
            // this._validate(entityType, context.usesNameOnServer);
            this._validate(entityType, context.toNameOnServer);
            this._entityType = entityType;
        }
        return fn.call(this, context);
    };
    /** @hidden @internal */
    Predicate.prototype._initialize = function (visitorMethodName, opMap) {
        if (opMap === void 0) { opMap = {}; }
        this.visitorMethodName = visitorMethodName;
        var aliasMap = this.aliasMap = {};
        for (var op in opMap) {
            updateAliasMap(aliasMap, op, opMap[op]);
        }
    };
    /** @hidden @internal */
    Predicate.prototype._resolveOp = function (op, okIfNotFound) {
        var opStr = (typeof op === "string") ? op : op.operator;
        var result = this.aliasMap[opStr.toLowerCase()];
        if (!result && !okIfNotFound) {
            throw new Error("Unable to resolve operator: " + opStr);
        }
        return result;
    };
    return Predicate;
}());
export { Predicate };
function createPredicateFromArray(arr) {
    // TODO: assert that length of the array should be > 3
    // Needs to handle:
    //      [ "freight", ">", 100"];
    //      [ "orders", "any", "freight",  ">", 950 ]
    //      [ "orders", "and", anotherPred ]
    //      [ "orders", "and", [ "freight, ">", 950 ]]
    var json = {};
    var value = {};
    json[arr[0]] = value;
    var op = arr[1];
    op = op.operator || op; // incoming op will be either a string or a FilterQueryOp
    if (arr.length === 3) {
        value[op] = arr[2];
    }
    else {
        value[op] = createPredicateFromArray(arr.splice(2));
    }
    return createPredicateFromObject(json);
}
function createPredicateFromObject(obj) {
    if (obj instanceof Predicate)
        return obj;
    if (typeof obj !== 'object') {
        throw new Error("Unable to convert to a Predicate: " + obj);
    }
    var keys = Object.keys(obj);
    var preds = keys.map(function (key) {
        return createPredicateFromKeyValue(key, obj[key]);
    });
    return (preds.length === 1) ? preds[0] : new AndOrPredicate("and", preds);
}
function createPredicateFromKeyValue(key, value) {
    // { and: [a,b] } key='and', value = [a,b]
    if (AndOrPredicate.prototype._resolveOp(key, true)) {
        return new AndOrPredicate(key, value);
    }
    // { not: a }  key= 'not', value = a
    if (UnaryPredicate.prototype._resolveOp(key, true)) {
        return new UnaryPredicate(key, value);
    }
    if ((typeof value !== 'object') || value == null || core.isDate(value)) {
        // { foo: bar } key='foo', value = bar ( where bar is a literal i.e. a string, a number, a boolean or a date.
        return new BinaryPredicate("eq", key, value);
    }
    else if (core.hasOwnProperty(value, 'value')) {
        // { foo: { value: bar, dataType: xxx} } key='foo', value = bar ( where bar is an object representing a literal
        return new BinaryPredicate("eq", key, value);
    }
    if (Array.isArray(value)) {
        throw new Error("Unable to resolve predicate after the phrase: " + key);
    }
    var expr = key;
    var keys = Object.keys(value);
    var preds = keys.map(function (op) {
        // { a: { any: b } op = 'any', expr=a, value[op] = b
        if (AnyAllPredicate.prototype._resolveOp(op, true)) {
            return new AnyAllPredicate(op, expr, value[op]);
        }
        if (BinaryPredicate.prototype._resolveOp(op, true)) {
            // { a: { ">": b }} op = ">", expr=a, value[op] = b
            return new BinaryPredicate(op, expr, value[op]);
        }
        else if (core.hasOwnProperty(value[op], 'value')) {
            // { a: { ">": { value: b, dataType: 'Int32' }} expr = a value[op] = { value: b, dataType: 'Int32' }
            return new BinaryPredicate("eq", expr, value[op]);
        }
        var msg = core.formatString("Unable to resolve predicate after the phrase: '%1' for operator: '%2'  and value: '%3'", expr, op, value[op]);
        throw new Error(msg);
    });
    return (preds.length === 1) ? preds[0] : new AndOrPredicate("and", preds);
}
function argsForAndOrPredicates(obj, args) {
    var preds = args[0];
    if (preds instanceof Predicate) {
        preds = core.arraySlice(args);
    }
    else if (!Array.isArray(preds)) {
        preds = [new Predicate(core.arraySlice(args))];
    }
    return [obj].concat(preds);
}
function updateAliasMap(aliasMap, opStr, op) {
    var key = opStr.toLowerCase();
    op.key = key;
    aliasMap[key] = op;
    op.aliases && op.aliases.forEach(function (alias) {
        aliasMap[alias.toLowerCase()] = op;
    });
}
/** For use by breeze plugin authors only. The class is for use in building a [[IUriBuilderAdapter]] implementation.
@adapter (see [[IUriBuilderAdapter]])
@hidden @internal
*/
var PassthruPredicate = /** @class */ (function (_super) {
    tslib_1.__extends(PassthruPredicate, _super);
    function PassthruPredicate(value) {
        var _this = _super.call(this) || this;
        _this.value = value;
        return _this;
    }
    return PassthruPredicate;
}(Predicate));
Error['x'] = PassthruPredicate.prototype._initialize('passthruPredicate');
/** For use by breeze plugin authors only. The class is for use in building a [[IUriBuilderAdapter]] implementation.
@adapter (see [[IUriBuilderAdapter]])
@hidden
*/
var UnaryPredicate = /** @class */ (function (_super) {
    tslib_1.__extends(UnaryPredicate, _super);
    function UnaryPredicate(op) {
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        var _this = _super.call(this) || this;
        _this.op = _this._resolveOp(op);
        _this.pred = new Predicate(args);
        return _this;
    }
    UnaryPredicate.prototype._validate = function (entityType, usesNameOnServer) {
        this.pred._validate(entityType, usesNameOnServer);
    };
    return UnaryPredicate;
}(Predicate));
export { UnaryPredicate };
Error['x'] = UnaryPredicate.prototype._initialize('unaryPredicate', {
    'not': { aliases: ['!', '~'] },
});
/** For use by breeze plugin authors only. The class is for use in building a [[IUriBuilderAdapter]] implementation.
@adapter (see [[IUriBuilderAdapter]])
@hidden
*/
var BinaryPredicate = /** @class */ (function (_super) {
    tslib_1.__extends(BinaryPredicate, _super);
    function BinaryPredicate(op, expr1, expr2) {
        var _this = _super.call(this) || this;
        // 5 public props op, expr1Source, expr2Source, expr1, expr2
        _this.op = _this._resolveOp(op);
        _this.expr1Source = expr1;
        _this.expr2Source = expr2;
        return _this;
        // this.expr1 and this.expr2 won't be
        // determined until validate is run
    }
    BinaryPredicate.prototype._validate = function (entityType, usesNameOnServer) {
        var expr1Context = { entityType: entityType, usesNameOnServer: usesNameOnServer };
        this.expr1 = createExpr(this.expr1Source, expr1Context);
        if (this.expr1 == null) {
            throw new Error("Unable to validate 1st expression: " + this.expr1Source);
        }
        if (this.expr1 instanceof LitExpr) {
            // lhs must be either a property or a function.
            throw new Error("The left hand side of a binary predicate cannot be a literal expression, it must be a valid property or functional predicate expression: " + this.expr1Source);
        }
        if (this.op.key === 'in' && !Array.isArray(this.expr2Source)) {
            throw new Error("The 'in' operator requires that its right hand argument be an array");
        }
        var expr2Context = core.extend(expr1Context, { isRHS: true, dataType: this.expr1.dataType });
        this.expr2 = createExpr(this.expr2Source, expr2Context);
        if (this.expr2 == null) {
            throw new Error("Unable to validate 2nd expression: " + this.expr2Source);
        }
        if (this.expr1.dataType == null) {
            this.expr1.dataType = this.expr2.dataType;
        }
    };
    return BinaryPredicate;
}(Predicate));
export { BinaryPredicate };
Error['x'] = BinaryPredicate.prototype._initialize('binaryPredicate', {
    'eq': {
        aliases: ["==", "equals"]
    },
    'ne': {
        aliases: ["!=", "~=", "notequals"]
    },
    'lt': {
        aliases: ["<", "lessthan"]
    },
    'le': {
        aliases: ["<=", "lessthanorequal"]
    },
    'gt': {
        aliases: [">", "greaterthan"]
    },
    'ge': {
        aliases: [">=", "greaterthanorequal"]
    },
    'startswith': {
        isFunction: true
    },
    'endswith': {
        isFunction: true
    },
    'contains': {
        aliases: ["substringof"],
        isFunction: true
    },
    'in': {}
});
/** For use by breeze plugin authors only. The class is for use in building a [[IUriBuilderAdapter]] implementation.
@adapter (see [[IUriBuilderAdapter]])
@hidden
*/
var AndOrPredicate = /** @class */ (function (_super) {
    tslib_1.__extends(AndOrPredicate, _super);
    function AndOrPredicate(op, preds) {
        var _this = _super.call(this) || this;
        _this.op = _this._resolveOp(op);
        if (preds.length === 1 && Array.isArray(preds[0])) {
            preds = preds[0];
        }
        _this.preds = preds.filter(function (pred) {
            return pred != null;
        }).map(function (pred) {
            return new Predicate(pred);
        });
        // TODO: this was removed - test if really needed.
        // if (this.preds.length === 0) {
        //   // marker for an empty predicate
        //   this.op = null;
        // }
        if (_this.preds.length === 1) {
            return _this.preds[0]; // HACK: this.preds[0] is actually NOT a AndOrPredicate but some other kind of pred.
        }
        return _this;
    }
    AndOrPredicate.prototype._validate = function (entityType, usesNameOnServer) {
        this.preds.forEach(function (pred) {
            pred._validate(entityType, usesNameOnServer);
        });
    };
    return AndOrPredicate;
}(Predicate));
export { AndOrPredicate };
Error['x'] = AndOrPredicate.prototype._initialize("andOrPredicate", {
    'and': { aliases: ['&&'] },
    'or': { aliases: ['||'] }
});
/** For use by breeze plugin authors only. The class is for use in building a [[IUriBuilderAdapter]] implementation.
@adapter (see [[IUriBuilderAdapter]])
@hidden
*/
var AnyAllPredicate = /** @class */ (function (_super) {
    tslib_1.__extends(AnyAllPredicate, _super);
    // 4 public props: op, exprSource, expr, pred
    function AnyAllPredicate(op, expr, pred) {
        var _this = _super.call(this) || this;
        _this.op = _this._resolveOp(op);
        _this.exprSource = expr;
        // this.expr will not be resolved until validate is called
        _this.pred = new Predicate(pred);
        return _this;
    }
    AnyAllPredicate.prototype._validate = function (entityType, usesNameOnServer) {
        this.expr = createExpr(this.exprSource, { entityType: entityType, usesNameOnServer: usesNameOnServer });
        // can't really know the predicateEntityType unless the original entity type was known.
        if (entityType == null || entityType.isAnonymous) {
            this.expr.dataType = undefined;
        }
        this.pred._validate(this.expr.dataType, usesNameOnServer);
    };
    return AnyAllPredicate;
}(Predicate));
export { AnyAllPredicate };
Error['x'] = AnyAllPredicate.prototype._initialize("anyAllPredicate", {
    'any': { aliases: ['some'] },
    'all': { aliases: ["every"] }
});
/** @hidden */
var PredicateExpression = /** @class */ (function () {
    function PredicateExpression(visitorMethodName) {
        this.visitorMethodName = visitorMethodName;
        // give expressions the Predicate prototype method
        this.visit = Predicate.prototype.visit;
    }
    // default impls - may/will be overridden be subclass expressions
    PredicateExpression.prototype._validate = function (entityType, usesNameOnServer) {
        // noop;
    };
    return PredicateExpression;
}());
export { PredicateExpression };
/** For use by breeze plugin authors only. The class is for use in building a [[IUriBuilderAdapter]] implementation.
@adapter (see [[IUriBuilderAdapter]])
@hidden
*/
var LitExpr = /** @class */ (function (_super) {
    tslib_1.__extends(LitExpr, _super);
    // 2 public props: value, dataType
    function LitExpr(value, dataType, hasExplicitDataType) {
        var _this = _super.call(this, "litExpr") || this;
        // dataType may come is an a string
        var dt1 = resolveDataType(dataType);
        // if the DataType comes in as Undefined this means
        // that we should NOT attempt to parse it but just leave it alone
        // for now - this is usually because it is part of a Func expr.
        // TODO: cast as DataType seems to be needed by early version of TypeDoc - may be able to remove later
        var dt2 = (dt1 || DataType.fromValue(value));
        if (dt2.parse) {
            if (Array.isArray(value)) {
                _this.value = value.map(function (v) { return dt2.parse(v, typeof v); });
            }
            else {
                _this.value = dt2.parse(value, typeof value);
            }
        }
        else {
            _this.value = value;
        }
        _this.dataType = dt2;
        _this.hasExplicitDataType = !!hasExplicitDataType;
        return _this;
    }
    LitExpr.prototype.toString = function () {
        return " LitExpr - value: " + this.value.toString() + " dataType: " + this.dataType.toString();
    };
    return LitExpr;
}(PredicateExpression));
export { LitExpr };
function resolveDataType(dataType) {
    if (dataType == null)
        return dataType;
    // if (DataType.contains(dataType)) {
    if (dataType instanceof DataType) {
        return dataType;
    }
    if (typeof dataType === 'string') {
        var dt = DataType.fromName(dataType);
        if (dt)
            return dt;
        throw new Error("Unable to resolve a dataType named: " + dataType);
    }
    throw new Error("The dataType parameter passed into this literal expression is not a 'DataType'" + dataType);
}
/** For use by breeze plugin authors only. The class is for use in building a [[IUriBuilderAdapter]] implementation.
@adapter (see [[IUriBuilderAdapter]])
@hidden
*/
var PropExpr = /** @class */ (function (_super) {
    tslib_1.__extends(PropExpr, _super);
    // two public props: propertyPath, dateType
    function PropExpr(propertyPath) {
        var _this = _super.call(this, 'propExpr') || this;
        _this.propertyPath = propertyPath;
        return _this;
        //this.dataType = DataType.Undefined;
        // this.dataType resolved after validate ( if not on an anon type }
    }
    PropExpr.prototype.toString = function () {
        return " PropExpr - " + this.propertyPath;
    };
    PropExpr.prototype._validate = function (entityType, usesNameOnServer) {
        if (entityType == null || entityType.isAnonymous)
            return;
        var props = entityType.getPropertiesOnPath(this.propertyPath, null, false);
        if (!props) {
            var msg = core.formatString("Unable to resolve propertyPath.  EntityType: '%1'   PropertyPath: '%2'", entityType.name, this.propertyPath);
            throw new Error(msg);
        }
        // get the last property
        var prop = props[props.length - 1];
        if (prop instanceof DataProperty) {
            this.dataType = prop.dataType;
        }
        else {
            this.dataType = prop.entityType;
        }
    };
    return PropExpr;
}(PredicateExpression));
export { PropExpr };
/** For use by breeze plugin authors only. The class is for use in building a [[IUriBuilderAdapter]] implementation.
@adapter (see [[IUriBuilderAdapter]])
@hidden @dynamic
*/
var FnExpr = /** @class */ (function (_super) {
    tslib_1.__extends(FnExpr, _super);
    function FnExpr(fnName, exprs) {
        var _this = _super.call(this, 'fnExpr') || this;
        // 4 public props: fnName, exprs, localFn, dataType
        _this.fnName = fnName;
        _this.exprs = exprs;
        var qf = FnExpr._funcMap[fnName];
        if (qf == null) {
            throw new Error("Unknown function: " + fnName);
        }
        _this.localFn = qf.fn;
        _this.dataType = qf.dataType;
        return _this;
    }
    FnExpr.prototype.toString = function () {
        var exprStr = this.exprs.map(function (expr) {
            expr.toString();
        }).toString();
        return "FnExpr - " + this.fnName + "(" + exprStr + ")";
    };
    FnExpr.prototype._validate = function (entityType, usesNameOnServer) {
        this.exprs.forEach(function (expr) {
            expr._validate(entityType, usesNameOnServer);
        });
    };
    FnExpr._funcMap = {
        toupper: {
            fn: function (source) {
                return source.toUpperCase();
            }, dataType: DataType.String
        },
        tolower: {
            fn: function (source) {
                return source.toLowerCase();
            }, dataType: DataType.String
        },
        substring: {
            fn: function (source, pos, length) {
                return source.substring(pos, length);
            }, dataType: DataType.String
        },
        substringof: {
            fn: function (find, source) {
                return source.indexOf(find) >= 0;
            }, dataType: DataType.Boolean
        },
        length: {
            fn: function (source) {
                return source.length;
            }, dataType: DataType.Int32
        },
        trim: {
            fn: function (source) {
                return source.trim();
            }, dataType: DataType.String
        },
        concat: {
            fn: function (s1, s2) {
                return s1.concat(s2);
            }, dataType: DataType.String
        },
        replace: {
            fn: function (source, find, replace) {
                return source.replace(find, replace);
            }, dataType: DataType.String
        },
        startswith: {
            fn: function (source, find) {
                return core.stringStartsWith(source, find);
            }, dataType: DataType.Boolean
        },
        endswith: {
            fn: function (source, find) {
                return core.stringEndsWith(source, find);
            }, dataType: DataType.Boolean
        },
        indexof: {
            fn: function (source, find) {
                return source.indexOf(find);
            }, dataType: DataType.Int32
        },
        round: {
            fn: function (source) {
                return Math.round(source);
            }, dataType: DataType.Int32
        },
        ceiling: {
            fn: function (source) {
                return Math.ceil(source);
            }, dataType: DataType.Int32
        },
        floor: {
            fn: function (source) {
                return Math.floor(source);
            }, dataType: DataType.Int32
        },
        second: {
            fn: function (source) {
                return source.getSeconds();
            }, dataType: DataType.Int32
        },
        minute: {
            fn: function (source) {
                return source.getMinutes();
            }, dataType: DataType.Int32
        },
        day: {
            fn: function (source) {
                return source.getDate();
            }, dataType: DataType.Int32
        },
        month: {
            fn: function (source) {
                return source.getMonth() + 1;
            }, dataType: DataType.Int32
        },
        year: {
            fn: function (source) {
                return source.getFullYear();
            }, dataType: DataType.Int32
        }
    };
    return FnExpr;
}(PredicateExpression));
export { FnExpr };
// TODO: add dataTypes for the args next - will help to infer other dataTypes.
var RX_IDENTIFIER = /^[a-z_][\w.$]*$/i;
// comma delimited expressions ignoring commas inside of both single and double quotes.
var RX_COMMA_DELIM1 = /('[^']*'|[^,]+)/g;
var RX_COMMA_DELIM2 = /("[^"]*"|[^,]+)/g;
var DELIM = String.fromCharCode(191);
function createExpr(source, exprContext) {
    var entityType = exprContext.entityType;
    // the right hand side of an 'in' clause
    if (Array.isArray(source)) {
        if (!exprContext.isRHS) {
            throw new Error("Array expressions are only permitted on the right hand side of a BinaryPredicate");
        }
        return new LitExpr(source, exprContext.dataType);
    }
    if (!(typeof source === 'string')) {
        if (source != null && typeof source === 'object' && !source.toISOString) {
            // source is an object but not a Date-like thing such as a JS or MomentJS Date
            if (source.value === undefined) {
                throw new Error("Unable to resolve an expression for: " + source + " on entityType: " + (entityType ? entityType.name : 'null'));
            }
            if (source.isProperty) {
                return new PropExpr(source.value);
            }
            else {
                // we want to insure that any LitExpr created this way is tagged with 'hasExplicitDataType: true'
                // because we want to insure that if we roundtrip thru toJSON that we don't
                // accidentally reinterpret this node as a PropExpr.
                // return new LitExpr(source.value, source.dataType || context.dataType, !!source.dataType);
                return new LitExpr(source.value, source.dataType || exprContext.dataType, true);
            }
        }
        else {
            return new LitExpr(source, exprContext.dataType);
        }
    }
    if (exprContext.isRHS) {
        if (entityType == null || entityType.isAnonymous) {
            // if entityType is unknown then assume that the rhs is a literal
            return new LitExpr(source, exprContext.dataType);
        }
        else {
            return parseLitOrPropExpr(source, exprContext);
        }
    }
    else {
        var regex = /\([^()]*\)/;
        var m = void 0;
        var tokens = [];
        var i = 0;
        while (m = regex.exec(source)) {
            var token = m[0];
            tokens.push(token);
            var repl = DELIM + i++;
            source = source.replace(token, repl);
        }
        var expr = parseExpr(source, tokens, exprContext);
        expr._validate(entityType, exprContext.usesNameOnServer);
        return expr;
    }
}
function parseExpr(source, tokens, exprContext) {
    var parts = source.split(DELIM);
    if (parts.length === 1) {
        return parseLitOrPropExpr(parts[0], exprContext);
    }
    else {
        return parseFnExpr(source, parts, tokens, exprContext);
    }
}
function parseLitOrPropExpr(value, exprContext) {
    value = value.trim();
    // value is either a string, a quoted string, a number, a bool value, or a date
    // if a string ( not a quoted string) then this represents a property name ( 1st ) or a lit string ( 2nd)
    var firstChar = value.substr(0, 1);
    var isQuoted = (firstChar === "'" || firstChar === '"') && value.length > 1 && value.substr(value.length - 1) === firstChar;
    if (isQuoted) {
        var unquotedValue = value.substr(1, value.length - 2);
        return new LitExpr(unquotedValue, exprContext.dataType || DataType.String);
    }
    else {
        var entityType = exprContext.entityType;
        // TODO: get rid of isAnonymous below when we get the chance.
        if (entityType == null || entityType.isAnonymous) {
            // this fork will only be reached on the LHS of an BinaryPredicate -
            // a RHS expr cannot get here with an anon type
            return new PropExpr(value);
        }
        else {
            var mayBeIdentifier = RX_IDENTIFIER.test(value);
            if (mayBeIdentifier) {
                // if (entityType.getProperty(value, false) != null) {
                if (entityType.getPropertiesOnPath(value, null, false) != null) {
                    return new PropExpr(value);
                }
            }
        }
        // we don't really know the datatype here because even though it comes in as a string
        // its usually a string BUT it might be a number  i.e. the "1" or the "2" from an expr
        // like "toUpper(substring(companyName, 1, 2))"
        return new LitExpr(value, exprContext.dataType);
    }
}
function parseFnExpr(source, parts, tokens, exprContext) {
    try {
        var fnName = parts[0].trim().toLowerCase();
        var argSource = tokens[parts[1]].trim();
        if (argSource.substr(0, 1) === "(") {
            argSource = argSource.substr(1, argSource.length - 2);
        }
        var commaMatchStr = source.indexOf("'") >= 0 ? RX_COMMA_DELIM1 : RX_COMMA_DELIM2;
        var args = argSource.match(commaMatchStr);
        var newContext_1 = core.extend({}, exprContext);
        // a dataType of Undefined on a context basically means not to try parsing
        // the value if the expr is a literal
        newContext_1.dataType = DataType.Undefined;
        newContext_1.isFnArg = true;
        var exprs = args.map(function (a) {
            return parseExpr(a, tokens, newContext_1);
        });
        return new FnExpr(fnName, exprs);
    }
    catch (e) {
        // TODO: removed old code here
        // return null;
        // and replaced with 
        throw e;
    }
}
var ɵ0 = function () {
    throw new Error("Cannot execute an PassthruPredicate expression against the local cache: " + this.value);
}, ɵ1 = function (context) {
    var predFn = this.pred.visit(context);
    switch (this.op.key) {
        case "not":
            return function (entity) {
                return !predFn(entity);
            };
        default:
            throw new Error("Invalid unary operator:" + this.op.key);
    }
}, ɵ2 = function (context) {
    var expr1Fn = this.expr1.visit(context);
    var expr2Fn = this.expr2.visit(context);
    var dataType = this.expr1.dataType || this.expr2.dataType;
    var lqco = context.entityType.metadataStore.localQueryComparisonOptions;
    var predFn = getBinaryPredicateFn(this, dataType, lqco);
    if (predFn == null) {
        throw new Error("Invalid binaryPredicate operator:" + this.op.key);
    }
    return function (entity) {
        return predFn(expr1Fn(entity), expr2Fn(entity));
    };
}, ɵ3 = function (context) {
    var predFns = this.preds.map(function (pred) {
        return pred.visit(context);
    });
    switch (this.op.key) {
        case "and":
            return function (entity) {
                var result = predFns.reduce(function (prev, cur) {
                    return prev && cur(entity);
                }, true);
                return result;
            };
        case "or":
            return function (entity) {
                var result = predFns.reduce(function (prev, cur) {
                    return prev || cur(entity);
                }, false);
                return result;
            };
        default:
            throw new Error("Invalid boolean operator:" + this.op.key);
    }
}, ɵ4 = function (context) {
    var exprFn = this.expr.visit(context);
    var newContext = core.extend({}, context);
    newContext.entityType = this.expr.dataType;
    var predFn = this.pred.visit(newContext);
    var anyAllPredFn = getAnyAllPredicateFn(this.op);
    return function (entity) {
        return anyAllPredFn(exprFn(entity), predFn);
    };
}, ɵ5 = function () {
    var value = this.value;
    return function (entity) {
        return value;
    };
}, ɵ6 = function () {
    var propertyPath = this.propertyPath;
    var properties = propertyPath.split('.');
    if (properties.length === 1) {
        return function (entity) {
            return entity.getProperty(propertyPath);
        };
    }
    else {
        return function (entity) {
            return EntityAspect.getPropertyPathValue(entity, properties);
        };
    }
}, ɵ7 = function (context) {
    var exprFns = this.exprs.map(function (expr) {
        return expr.visit(context);
    });
    var that = this;
    return function (entity) {
        var values = exprFns.map(function (exprFn) {
            var value = exprFn(entity);
            return value;
        });
        var result = that.localFn.apply(null, values);
        return result;
    };
};
// toFunctionVisitor
var toFunctionVisitor = {
    isExtended: false,
    passthruPredicate: ɵ0,
    unaryPredicate: ɵ1,
    binaryPredicate: ɵ2,
    andOrPredicate: ɵ3,
    anyAllPredicate: ɵ4,
    litExpr: ɵ5,
    propExpr: ɵ6,
    fnExpr: ɵ7
};
function getAnyAllPredicateFn(op) {
    switch (op.key) {
        case "any":
            return function (v1, v2) {
                return v1.some(function (v) {
                    return v2(v);
                });
            };
        case "all":
            return function (v1, v2) {
                return v1.every(function (v) {
                    return v2(v);
                });
            };
        default:
            throw new Error("Unknown operator: " + op.key);
    }
}
function getBinaryPredicateFn(binaryPredicate, dataType, lqco) {
    var op = binaryPredicate.op;
    var mc = DataType.getComparableFn(dataType);
    var predFn;
    switch (op.key) {
        case 'eq':
            predFn = function (v1, v2) {
                if (v1 && typeof v1 === 'string') {
                    return stringEquals(v1, v2, lqco);
                }
                else {
                    return mc(v1) === mc(v2);
                }
            };
            break;
        case 'ne':
            predFn = function (v1, v2) {
                if (v1 && typeof v1 === 'string') {
                    return !stringEquals(v1, v2, lqco);
                }
                else {
                    return mc(v1) !== mc(v2);
                }
            };
            break;
        case 'gt':
            predFn = function (v1, v2) {
                return mc(v1) > mc(v2);
            };
            break;
        case 'ge':
            predFn = function (v1, v2) {
                return mc(v1) >= mc(v2);
            };
            break;
        case 'lt':
            predFn = function (v1, v2) {
                return mc(v1) < mc(v2);
            };
            break;
        case 'le':
            predFn = function (v1, v2) {
                return mc(v1) <= mc(v2);
            };
            break;
        case 'startswith':
            predFn = function (v1, v2) {
                return stringStartsWith(v1, v2, lqco);
            };
            break;
        case 'endswith':
            predFn = function (v1, v2) {
                return stringEndsWith(v1, v2, lqco);
            };
            break;
        case 'contains':
            predFn = function (v1, v2) {
                return stringContains(v1, v2, lqco);
            };
            break;
        case 'in':
            predFn = function (v1, v2) {
                v1 = mc(v1);
                v2 = v2.map(function (v) { return mc(v); });
                return v2.indexOf(v1) >= 0;
            };
            break;
        default:
            return null;
    }
    return predFn;
}
function stringEquals(a, b, lqco) {
    if (b == null)
        return false;
    if (typeof b !== 'string') {
        b = b.toString();
    }
    if (lqco.usesSql92CompliantStringComparison) {
        a = (a || "").trim();
        b = (b || "").trim();
    }
    if (!lqco.isCaseSensitive) {
        a = (a || "").toLowerCase();
        b = (b || "").toLowerCase();
    }
    return a === b;
}
function stringStartsWith(a, b, lqco) {
    if (!lqco.isCaseSensitive) {
        a = (a || "").toLowerCase();
        b = (b || "").toLowerCase();
    }
    return core.stringStartsWith(a, b);
}
function stringEndsWith(a, b, lqco) {
    if (!lqco.isCaseSensitive) {
        a = (a || "").toLowerCase();
        b = (b || "").toLowerCase();
    }
    return core.stringEndsWith(a, b);
}
function stringContains(a, b, lqco) {
    if (!lqco.isCaseSensitive) {
        a = (a || "").toLowerCase();
        b = (b || "").toLowerCase();
    }
    return a.indexOf(b) >= 0;
}
var ɵ8 = function () {
    return this.value;
}, ɵ9 = function (context) {
    var predVal = this.pred.visit(context);
    var json = {};
    json[this.op.key] = predVal;
    return json;
}, ɵ10 = function (context) {
    var expr1Val = this.expr1.visit(context);
    var expr2Val = this.expr2.visit(context);
    var json = {};
    if (this.expr2 instanceof PropExpr) {
        expr2Val = { value: expr2Val, isProperty: true };
    }
    if (this.op.key === "eq") {
        json[expr1Val] = expr2Val;
    }
    else {
        var value = {};
        json[expr1Val] = value;
        value[this.op.key] = expr2Val;
    }
    return json;
}, ɵ11 = function (context) {
    var predVals = this.preds.map(function (pred) {
        return pred.visit(context);
    });
    if (!predVals || !predVals.length) {
        return {};
    }
    var json;
    // normalizeAnd clauses if possible.
    // passthru predicate will appear as string and their 'ands' can't be 'normalized'
    if (this.op.key === 'and' && predVals.length === 2 && !predVals.some(function (v) { return typeof (v) === 'string'; })) {
        // normalize 'and' clauses - will return null if can't be combined.
        json = predVals.reduce(combine);
    }
    if (json == null) {
        json = {};
        json[this.op.key] = predVals;
    }
    return json;
}, ɵ12 = function (context) {
    var exprVal = this.expr.visit(context);
    var newContext = core.extend({}, context);
    newContext.entityType = this.expr.dataType;
    var predVal = this.pred.visit(newContext);
    var json = {};
    var value = {};
    value[this.op.key] = predVal;
    json[exprVal] = value;
    return json;
}, ɵ13 = function (context) {
    if (this.hasExplicitDataType || context.useExplicitDataType) {
        return { value: this.value, dataType: this.dataType.name };
    }
    else {
        return this.value;
    }
}, ɵ14 = function (context) {
    if (context.toNameOnServer) {
        return context.entityType.clientPropertyPathToServer(this.propertyPath);
    }
    else {
        return this.propertyPath;
    }
}, ɵ15 = function (context) {
    var exprVals = this.exprs.map(function (expr) {
        return expr.visit(context);
    });
    return this.fnName + "(" + exprVals.join(",") + ")";
};
// toJSONVisitor
var toJSONVisitor = {
    passthruPredicate: ɵ8,
    unaryPredicate: ɵ9,
    binaryPredicate: ɵ10,
    andOrPredicate: ɵ11,
    anyAllPredicate: ɵ12,
    litExpr: ɵ13,
    propExpr: ɵ14,
    fnExpr: ɵ15
};
function combine(j1, j2) {
    var ok = Object.keys(j2).every(function (key) {
        if (j1.hasOwnProperty(key)) {
            if (typeof (j2[key]) !== 'object') {
                // exit and indicate that we can't combine
                return false;
            }
            if (combine(j1[key], j2[key]) == null) {
                return false;
            }
        }
        else {
            j1[key] = j2[key];
        }
        return true;
    });
    return ok ? j1 : null;
}
export { ɵ0, ɵ1, ɵ2, ɵ3, ɵ4, ɵ5, ɵ6, ɵ7, ɵ8, ɵ9, ɵ10, ɵ11, ɵ12, ɵ13, ɵ14, ɵ15 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJlZGljYXRlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYnJlZXplLWNsaWVudC8iLCJzb3VyY2VzIjpbInNyYy9wcmVkaWNhdGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDOUIsT0FBTyxFQUFFLFVBQVUsRUFBa0IsWUFBWSxFQUFHLE1BQU0sbUJBQW1CLENBQUM7QUFFOUUsT0FBTyxFQUFFLFFBQVEsRUFBRyxNQUFNLGFBQWEsQ0FBQztBQUN4QyxPQUFPLEVBQUUsWUFBWSxFQUFVLE1BQU0saUJBQWlCLENBQUM7QUE4Q3ZEOzs7R0FHRztBQUNIO0lBU0U7Ozs7Ozs7Ozs7Ozs7Ozs7T0FnQkc7SUFDSDtRQUFZLGNBQWM7YUFBZCxVQUFjLEVBQWQscUJBQWMsRUFBZCxJQUFjO1lBQWQseUJBQWM7O1FBQ3hCLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDO1lBQUUsT0FBTztRQUM5QixJQUFJLENBQUMsQ0FBQyxJQUFJLFlBQVksU0FBUyxDQUFDLEVBQUU7WUFDaEMsWUFBVyxTQUFTLFlBQVQsU0FBUyw2QkFBUyxJQUFJLE1BQUU7U0FDcEM7UUFDRCxPQUFPLFNBQVMsQ0FBQyxNQUFNLE9BQWhCLFNBQVMsbUJBQWdCLElBQUksR0FBRTtJQUN4QyxDQUFDO0lBRUQ7Ozs7Ozs7Ozs7Ozs7O09BY0c7SUFDSSxnQkFBTSxHQUFiO1FBQ0UsMkRBQTJEO1FBRC9DLGNBQWM7YUFBZCxVQUFjLEVBQWQscUJBQWMsRUFBZCxJQUFjO1lBQWQseUJBQWM7O1FBRzFCLHdDQUF3QztRQUN4QyxJQUFJLElBQUksQ0FBQyxNQUFNLEtBQUssQ0FBQztZQUFFLE9BQU8sSUFBSSxTQUFTLEVBQUUsQ0FBQztRQUM5QyxJQUFJLElBQUksQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ3JCLGlCQUFpQjtZQUNqQixpRkFBaUY7WUFDakYsMkNBQTJDO1lBQzNDLDJGQUEyRjtZQUMzRix5REFBeUQ7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SUFBSSxJQUFJLEVBQUU7Z0JBQ3JDLE9BQU8sS0FBSyxDQUFDO2FBQ2Q7U0FDRjthQUFNO1lBQ0wsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUNuQjtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQyxDQUFDLENBQUM7SUFDSCxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7QUFDeEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNvcmUgfSBmcm9tICcuL2NvcmUnO1xyXG5pbXBvcnQgeyBFbnRpdHlUeXBlLCBTdHJ1Y3R1cmFsVHlwZSwgRGF0YVByb3BlcnR5ICB9IGZyb20gJy4vZW50aXR5LW1ldGFkYXRhJztcclxuaW1wb3J0IHsgUXVlcnlPcCB9IGZyb20gJy4vZW50aXR5LXF1ZXJ5JztcclxuaW1wb3J0IHsgRGF0YVR5cGUgIH0gZnJvbSAnLi9kYXRhLXR5cGUnO1xyXG5pbXBvcnQgeyBFbnRpdHlBc3BlY3QsIEVudGl0eSB9IGZyb20gJy4vZW50aXR5LWFzcGVjdCc7XHJcbmltcG9ydCB7IExvY2FsUXVlcnlDb21wYXJpc29uT3B0aW9ucyB9IGZyb20gJy4vbG9jYWwtcXVlcnktY29tcGFyaXNvbi1vcHRpb25zJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgT3Age1xyXG4gIGtleTogc3RyaW5nO1xyXG4gIGFsaWFzZXM/OiBzdHJpbmdbXTtcclxuICBpc0Z1bmN0aW9uPzogYm9vbGVhbjtcclxufVxyXG5cclxuLyoqIEBoaWRkZW4gQGludGVybmFsICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgT3BNYXAge1xyXG4gIFtrZXk6IHN0cmluZ106IE9wO1xyXG59XHJcblxyXG4vKiogRm9yIHVzZSBieSBicmVlemUgcGx1Z2luIGF1dGhvcnMgb25seS4gVGhlIGNsYXNzIGlzIGZvciB1c2UgaW4gYnVpbGRpbmcgYSBbW0lVcmlCdWlsZGVyQWRhcHRlcl1dIGltcGxlbWVudGF0aW9uLiBcclxuQGFkYXB0ZXIgKHNlZSBbW0lVcmlCdWlsZGVyQWRhcHRlcl1dKSAgICBcclxuQGhpZGRlbiBcclxuKi9cclxuZXhwb3J0IGludGVyZmFjZSBWaXNpdG9yIHtcclxuXHJcbn1cclxuXHJcbi8qKiBGb3IgdXNlIGJ5IGJyZWV6ZSBwbHVnaW4gYXV0aG9ycyBvbmx5LiBUaGUgY2xhc3MgaXMgZm9yIHVzZSBpbiBidWlsZGluZyBhIFtbSVVyaUJ1aWxkZXJBZGFwdGVyXV0gaW1wbGVtZW50YXRpb24uIFxyXG5AYWRhcHRlciAoc2VlIFtbSVVyaUJ1aWxkZXJBZGFwdGVyXV0pICAgIFxyXG5AaGlkZGVuIFxyXG4qL1xyXG5leHBvcnQgaW50ZXJmYWNlIFZpc2l0Q29udGV4dCB7XHJcbiAgZW50aXR5VHlwZT86IEVudGl0eVR5cGU7XHJcbiAgLy8gdXNlc05hbWVPblNlcnZlcj86IGJvb2xlYW47XHJcbiAgdG9OYW1lT25TZXJ2ZXI/OiBib29sZWFuO1xyXG4gIHVzZUV4cGxpY2l0RGF0YVR5cGU/OiBib29sZWFuO1xyXG4gIHZpc2l0b3I/OiBWaXNpdG9yO1xyXG59XHJcblxyXG4vKiogRm9yIHVzZSBieSBicmVlemUgcGx1Z2luIGF1dGhvcnMgb25seS4gVGhlIGNsYXNzIGlzIGZvciB1c2UgaW4gYnVpbGRpbmcgYSBbW0lVcmlCdWlsZGVyQWRhcHRlcl1dIGltcGxlbWVudGF0aW9uLiBcclxuQGFkYXB0ZXIgKHNlZSBbW0lVcmlCdWlsZGVyQWRhcHRlcl1dKSAgICBcclxuQGhpZGRlbiBcclxuKi9cclxuZXhwb3J0IGludGVyZmFjZSBFeHByZXNzaW9uQ29udGV4dCB7XHJcbiAgZW50aXR5VHlwZT86IEVudGl0eVR5cGU7XHJcbiAgdXNlc05hbWVPblNlcnZlcj86IGJvb2xlYW47XHJcbiAgZGF0YVR5cGU/OiBEYXRhVHlwZSB8IHN0cmluZztcclxuICBpc1JIUz86IGJvb2xlYW47XHJcbiAgaXNGbkFyZz86IGJvb2xlYW47XHJcbn1cclxuXHJcbi8qKlxyXG5Vc2VkIHRvIGRlZmluZSBhICd3aGVyZScgcHJlZGljYXRlIGZvciBhbiBbW0VudGl0eVF1ZXJ5XV0uICBQcmVkaWNhdGVzIGFyZSBpbW11dGFibGUsIHdoaWNoIG1lYW5zIHRoYXQgYW55XHJcbm1ldGhvZCB0aGF0IHdvdWxkIG1vZGlmeSBhIFByZWRpY2F0ZSBhY3R1YWxseSByZXR1cm5zIGEgbmV3IFByZWRpY2F0ZS5cclxuKiovXHJcbmV4cG9ydCBjbGFzcyBQcmVkaWNhdGUge1xyXG4gIG9wOiBPcDtcclxuICAvKiogQGhpZGRlbiBAaW50ZXJuYWwgKi9cclxuICBfZW50aXR5VHlwZT86IEVudGl0eVR5cGU7XHJcbiAgLyoqIEBoaWRkZW4gQGludGVybmFsICovXHJcbiAgYWxpYXNNYXA6IE9wTWFwO1xyXG4gIHZpc2l0b3JNZXRob2ROYW1lOiBzdHJpbmc7XHJcblxyXG5cclxuICAvKipcclxuICBQcmVkaWNhdGUgY29uc3RydWN0b3JcclxuICA+ICAgICBsZXQgcDEgPSBuZXcgUHJlZGljYXRlKFwiQ29tcGFueU5hbWVcIiwgXCJTdGFydHNXaXRoXCIsIFwiQlwiKTtcclxuICA+ICAgICBsZXQgcXVlcnkgPSBuZXcgRW50aXR5UXVlcnkoXCJDdXN0b21lcnNcIikud2hlcmUocDEpO1xyXG5cclxuICBvclxyXG4gID4gICAgIGxldCBwMiA9IG5ldyBQcmVkaWNhdGUoXCJSZWdpb25cIiwgRmlsdGVyUXVlcnlPcC5FcXVhbHMsIG51bGwpO1xyXG4gID4gICAgIGxldCBxdWVyeSA9IG5ldyBFbnRpdHlRdWVyeShcIkN1c3RvbWVyc1wiKS53aGVyZShwMik7XHJcbiAgQHBhcmFtIHByb3BlcnR5IC0gQSBwcm9wZXJ0eSBuYW1lLCBhIG5lc3RlZCBwcm9wZXJ0eSBuYW1lIG9yIGFuIGV4cHJlc3Npb24gaW52b2x2aW5nIGEgcHJvcGVydHkgbmFtZS5cclxuICBAcGFyYW0gb3BlcmF0b3IgLSBcclxuICBAcGFyYW0gdmFsdWUgLSBUaGlzIHdpbGwgYmUgdHJlYXRlZCBhcyBlaXRoZXIgYSBwcm9wZXJ0eSBleHByZXNzaW9uIG9yIGEgbGl0ZXJhbCBkZXBlbmRpbmcgb24gY29udGV4dC4gIEluIGdlbmVyYWwsXHJcbiAgaWYgdGhlIHZhbHVlIGNhbiBiZSBpbnRlcnByZXRlZCBhcyBhIHByb3BlcnR5IGV4cHJlc3Npb24gaXQgd2lsbCBiZSwgb3RoZXJ3aXNlIGl0IHdpbGwgYmUgdHJlYXRlZCBhcyBhIGxpdGVyYWwuXHJcbiAgSW4gbW9zdCBjYXNlcyB0aGlzIHdvcmtzIHdlbGwsIGJ1dCB5b3UgY2FuIGFsc28gZm9yY2UgdGhlIGludGVycHJldGF0aW9uIGJ5IG1ha2luZyB0aGUgdmFsdWUgYXJndW1lbnQgaXRzZWxmIGFuIG9iamVjdCB3aXRoIGEgJ3ZhbHVlJ1xyXG4gIHByb3BlcnR5IGFuZCBhbiAnaXNMaXRlcmFsJyBwcm9wZXJ0eSBzZXQgdG8gZWl0aGVyIHRydWUgb3IgZmFsc2UuICBCcmVlemUgYWxzbyB0cmllcyB0byBpbmZlciB0aGUgZGF0YVR5cGUgb2YgYW55XHJcbiAgbGl0ZXJhbCBiYXNlZCBvbiBjb250ZXh0LCBpZiB0aGlzIGZhaWxzIHlvdSBjYW4gZm9yY2UgdGhpcyBpbmZlcmVuY2UgYnkgbWFraW5nIHRoZSB2YWx1ZSBhcmd1bWVudCBhbiBvYmplY3Qgd2l0aCBhXHJcbiAgJ3ZhbHVlJyBwcm9wZXJ0eSBhbmQgYSAnZGF0YVR5cGUnIHByb3BlcnR5IHNldCB0byBvbmUgb2YgdGhlIGJyZWV6ZS5EYXRhVHlwZSBlbnVtZXJhdGlvbiBpbnN0YW5jZXMuXHJcbiAgKiovXHJcbiAgY29uc3RydWN0b3IoLi4uYXJnczogYW55W10pIHtcclxuICAgIGlmIChhcmdzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG4gICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFByZWRpY2F0ZSkpIHtcclxuICAgICAgcmV0dXJuIG5ldyBQcmVkaWNhdGUoLi4uPGFueT5hcmdzKTtcclxuICAgIH1cclxuICAgIHJldHVybiBQcmVkaWNhdGUuY3JlYXRlKC4uLjxhbnk+YXJncyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICBTYW1lIGFzIHVzaW5nIHRoZSBjdG9yLlxyXG4gID4gICAgICAvLyBzbyBcclxuICA+ICAgICAgbGV0IHAgPSBQcmVkaWNhdGUuY3JlYXRlKGEsIGIsIGMpO1xyXG4gID4gICAgICAvLyBpcyB0aGUgc2FtZSBhcyBcclxuICA+ICAgICAgbGV0IHAgPSBuZXcgUHJlZGljYXRlKGEsIGIsIGMpOyBcclxuICBAcGFyYW0gcHJvcGVydHkgLSAgQSBwcm9wZXJ0eSBuYW1lLCBhIG5lc3RlZCBwcm9wZXJ0eSBuYW1lIG9yIGFuIGV4cHJlc3Npb24gaW52b2x2aW5nIGEgcHJvcGVydHkgbmFtZS5cclxuICBAcGFyYW0gb3BlcmF0b3IgLSB0aGUgZmlsdGVyIHF1ZXJ5IG9wZXJhdG9yLlxyXG4gIEBwYXJhbSB2YWx1ZSAtIFRoaXMgd2lsbCBiZSB0cmVhdGVkIGFzIGVpdGhlciBhIHByb3BlcnR5IGV4cHJlc3Npb24gb3IgYSBsaXRlcmFsIGRlcGVuZGluZyBvbiBjb250ZXh0LiAgSW4gZ2VuZXJhbCxcclxuICBpZiB0aGUgdmFsdWUgY2FuIGJlIGludGVycHJldGVkIGFzIGEgcHJvcGVydHkgZXhwcmVzc2lvbiBpdCB3aWxsIGJlLCBvdGhlcndpc2UgaXQgd2lsbCBiZSB0cmVhdGVkIGFzIGEgbGl0ZXJhbC5cclxuICBJbiBtb3N0IGNhc2VzIHRoaXMgd29ya3Mgd2VsbCwgYnV0IHlvdSBjYW4gYWxzbyBmb3JjZSB0aGUgaW50ZXJwcmV0YXRpb24gYnkgbWFraW5nIHRoZSB2YWx1ZSBhcmd1bWVudCBpdHNlbGYgYW4gb2JqZWN0IHdpdGggYSAndmFsdWUnXHJcbiAgcHJvcGVydHkgYW5kIGFuICdpc0xpdGVyYWwnIHByb3BlcnR5IHNldCB0byBlaXRoZXIgdHJ1ZSBvciBmYWxzZS4gIEJyZWV6ZSBhbHNvIHRyaWVzIHRvIGluZmVyIHRoZSBkYXRhVHlwZSBvZiBhbnlcclxuICBsaXRlcmFsIGJhc2VkIG9uIGNvbnRleHQsIGlmIHRoaXMgZmFpbHMgeW91IGNhbiBmb3JjZSB0aGlzIGluZmVyZW5jZSBieSBtYWtpbmcgdGhlIHZhbHVlIGFyZ3VtZW50IGFuIG9iamVjdCB3aXRoIGFcclxuICAndmFsdWUnIHByb3BlcnR5IGFuZCBhICdkYXRhVHlwZScgcHJvcGVydHkgc2V0IHRvIG9uZSBvZiB0aGUgYnJlZXplLkRhdGFUeXBlIGVudW1lcmF0aW9uIGluc3RhbmNlcy5cclxuICAqKi9cclxuICBzdGF0aWMgY3JlYXRlKC4uLmFyZ3M6IGFueVtdKSB7XHJcbiAgICAvLyBjYW4gYmUgY2FsbGVkIGZyb20gc3RkIGphdmFzY3JpcHQgd2l0aG91dCBuZXcgKCBsZWdhY3kgKVxyXG5cclxuICAgIC8vIGVtcHR5IGN0b3IgaXMgdXNlZCBieSBhbGwgc3ViY2xhc3Nlcy5cclxuICAgIGlmIChhcmdzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIG5ldyBQcmVkaWNhdGUoKTtcclxuICAgIGlmIChhcmdzLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAvLyBwb3NzaWJpbGl0aWVzOlxyXG4gICAgICAvLyAgICAgIFByZWRpY2F0ZShbIGFQcmVkaWNhdGUgXSkgb3IgIFByZWRpY2F0ZShbXCJmcmVpZ2h0XCIsIFwiPlwiLCAxMDBdKSAtIGFuIGFycmF5XHJcbiAgICAgIC8vICAgICAgUHJlZGljYXRlKGFQcmVkaWNhdGUpIC0gYSBwcmVkaWNhdGVcclxuICAgICAgLy8gICAgICBQcmVkaWNhdGUoIFwiZnJlaWdodCBndCAxMDBcIiB9ICAvLyBwYXNzdGhydSAoIGkuZS4gbWF5YmUgYW4gb2RhdGEgc3RyaW5nKSAtIGEgc3RyaW5nXHJcbiAgICAgIC8vICAgICAgUHJlZGljYXRlKCB7IGZyZWlnaHQ6IHsgXCI+XCI6IDEwMCB9IH0pIC0gYW4gb2JqZWN0XHJcbiAgICAgIGxldCBhcmcgPSBhcmd1bWVudHNbMF07XHJcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KGFyZykpIHtcclxuICAgICAgICBpZiAoYXJnLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgICAgLy8gcmVjdXJzZVxyXG4gICAgICAgICAgcmV0dXJuIG5ldyBQcmVkaWNhdGUoYXJnWzBdKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIGNyZWF0ZVByZWRpY2F0ZUZyb21BcnJheShhcmcpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmIChhcmcgaW5zdGFuY2VvZiBQcmVkaWNhdGUpIHtcclxuICAgICAgICByZXR1cm4gYXJnO1xyXG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmcgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQYXNzdGhydVByZWRpY2F0ZShhcmcpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBjcmVhdGVQcmVkaWNhdGVGcm9tT2JqZWN0KGFyZyk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIDIgcG9zc2liaWxpdGllc1xyXG4gICAgICAvLyAgICAgIFByZWRpY2F0ZShcImZyZWlnaHRcIiwgXCI+XCIsIDEwMFwiKTtcclxuICAgICAgLy8gICAgICBQcmVkaWNhdGUoXCJvcmRlcnNcIiwgXCJhbnlcIiwgXCJmcmVpZ2h0XCIsICBcIj5cIiwgOTUwKTtcclxuICAgICAgcmV0dXJuIGNyZWF0ZVByZWRpY2F0ZUZyb21BcnJheShhcmdzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKiBAaGlkZGVuIEBpbnRlcm5hbCAqL1xyXG4gIF92YWxpZGF0ZShlbnRpdHlUeXBlOiBFbnRpdHlUeXBlIHwgdW5kZWZpbmVkLCB1c2VzTmFtZU9uU2VydmVyPzogYm9vbGVhbikge1xyXG4gICAgLy8gbm9vcCBoZXJlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgQ3JlYXRlcyBhICdjb21wb3NpdGUnIFByZWRpY2F0ZSBieSAnYW5kJ2luZyBhIHNldCBvZiBzcGVjaWZpZWQgUHJlZGljYXRlcyB0b2dldGhlci5cclxuICA+ICAgICAgbGV0IGR0ID0gbmV3IERhdGUoODgsIDksIDEyKTtcclxuICA+ICAgICAgbGV0IHAxID0gUHJlZGljYXRlLmNyZWF0ZShcIk9yZGVyRGF0ZVwiLCBcIm5lXCIsIGR0KTtcclxuICA+ICAgICAgbGV0IHAyID0gUHJlZGljYXRlLmNyZWF0ZShcIlNoaXBDaXR5XCIsIFwic3RhcnRzV2l0aFwiLCBcIkNcIik7XHJcbiAgPiAgICAgIGxldCBwMyA9IFByZWRpY2F0ZS5jcmVhdGUoXCJGcmVpZ2h0XCIsIFwiPlwiLCAxMDApO1xyXG4gID4gICAgICBsZXQgbmV3UHJlZCA9IFByZWRpY2F0ZS5hbmQocDEsIHAyLCBwMyk7XHJcblxyXG4gIG9yXHJcbiAgPiAgICAgIGxldCBwcmVkcyA9IFtwMSwgcDIsIHAzXTtcclxuICA+ICAgICAgbGV0IG5ld1ByZWQgPSBQcmVkaWNhdGUuYW5kKHByZWRzKTtcclxuICBAcGFyYW0gcHJlZGljYXRlcyAtIG11bHRpcGxlIFByZWRpY2F0ZXMgb3IgYW4gYXJyYXkgb2YgUHJlZGljYXRlLiBcclxuICBBbnkgbnVsbCBvciB1bmRlZmluZWQgdmFsdWVzIHBhc3NlZCBpbiB3aWxsIGJlIGF1dG9tYXRpY2FsbHkgZmlsdGVyZWQgb3V0IGJlZm9yZSBjb25zdHJ1Y3RpbmcgdGhlIGNvbXBvc2l0ZSBwcmVkaWNhdGUuXHJcbiAgKiovXHJcbiAgc3RhdGljIGFuZCguLi5hcmdzOiBhbnlbXSkge1xyXG4gICAgbGV0IHByZWQgPSBuZXcgQW5kT3JQcmVkaWNhdGUoXCJhbmRcIiwgYXJncyk7XHJcbiAgICAvLyBUT0RPIHJlbW92ZWQgYmVsb3dcclxuICAgIC8vIHJldHVybiB1bmRlZmluZWQgaWYgZW1wdHlcclxuICAgIC8vIHJldHVybiBwcmVkLm9wICYmIHByZWQ7XHJcbiAgICByZXR1cm4gcHJlZDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gIENyZWF0ZXMgYSAnY29tcG9zaXRlJyBQcmVkaWNhdGUgYnkgJ29yJ2luZyBhIHNldCBvZiBzcGVjaWZpZWQgUHJlZGljYXRlcyB0b2dldGhlci5cclxuICA+ICAgICAgbGV0IGR0ID0gbmV3IERhdGUoODgsIDksIDEyKTtcclxuICA+ICAgICAgbGV0IHAxID0gUHJlZGljYXRlLmNyZWF0ZShcIk9yZGVyRGF0ZVwiLCBcIm5lXCIsIGR0KTtcclxuICA+ICAgICAgbGV0IHAyID0gUHJlZGljYXRlLmNyZWF0ZShcIlNoaXBDaXR5XCIsIFwic3RhcnRzV2l0aFwiLCBcIkNcIik7XHJcbiAgPiAgICAgIGxldCBwMyA9IFByZWRpY2F0ZS5jcmVhdGUoXCJGcmVpZ2h0XCIsIFwiPlwiLCAxMDApO1xyXG4gID4gICAgICBsZXQgbmV3UHJlZCA9IFByZWRpY2F0ZS5vcihwMSwgcDIsIHAzKTtcclxuXHJcbiAgb3JcclxuICA+ICAgICAgbGV0IHByZWRzID0gW3AxLCBwMiwgcDNdO1xyXG4gID4gICAgICBsZXQgbmV3UHJlZCA9IFByZWRpY2F0ZS5vcihwcmVkcyk7XHJcbiAgQHBhcmFtIHByZWRpY2F0ZXMgLSBtdWx0aXBsZSBQcmVkaWNhdGVzIG9yIGFuIGFycmF5IG9mIFByZWRpY2F0ZS5cclxuICBBbnkgbnVsbCBvciB1bmRlZmluZWQgdmFsdWVzIHBhc3NlZCBpbiB3aWxsIGJlIGF1dG9tYXRpY2FsbHkgZmlsdGVyZWQgb3V0IGJlZm9yZSBjb25zdHJ1Y3RpbmcgdGhlIGNvbXBvc2l0ZSBwcmVkaWNhdGUuXHJcbiAgKiovXHJcbiAgc3RhdGljIG9yKC4uLmFyZ3M6IGFueVtdKSB7XHJcbiAgICBsZXQgcHJlZCA9IG5ldyBBbmRPclByZWRpY2F0ZShcIm9yXCIsIGFyZ3MpO1xyXG4gICAgLy8gcmV0dXJuIHByZWQub3AgJiYgcHJlZDtcclxuICAgIHJldHVybiBwcmVkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgQ3JlYXRlcyBhICdjb21wb3NpdGUnIFByZWRpY2F0ZSBieSAnbmVnYXRpbmcnIGEgc3BlY2lmaWVkIHByZWRpY2F0ZS5cclxuICA+ICAgICAgbGV0IHAxID0gUHJlZGljYXRlLmNyZWF0ZShcIkZyZWlnaHRcIiwgXCJndFwiLCAxMDApO1xyXG4gID4gICAgICBsZXQgbm90X3AxID0gUHJlZGljYXRlLm5vdChwMSk7XHJcblxyXG4gIFRoaXMgY2FuIGFsc28gYmUgYWNjb21wbGlzaGVkIHVzaW5nIHRoZSAnaW5zdGFuY2UnIHZlcnNpb24gb2YgdGhlICdub3QnIG1ldGhvZFxyXG4gID4gICAgICBsZXQgbm90X3AxID0gcDEubm90KCk7XHJcblxyXG4gIEJvdGggb2Ygd2hpY2ggd291bGQgYmUgdGhlIHNhbWUgYXNcclxuICA+ICAgICAgbGV0IG5vdF9wMSA9IFByZWRpY2F0ZS5jcmVhdGUoXCJGcmVpZ2h0XCIsIFwibGVcIiwgMTAwKTtcclxuICAqKi9cclxuICBzdGF0aWMgbm90KHByZWQ6IFByZWRpY2F0ZSkge1xyXG4gICAgcmV0dXJuIHByZWQubm90KCk7XHJcbiAgfVxyXG5cclxuICAvLyBUT0RPOiBkZXRlcm1pbmUgaWYvd2hlcmUgdGhpcyBpcyB1c2VkLlxyXG4gIC8vIHN0YXRpYyBleHRlbmRCaW5hcnlQcmVkaWNhdGVGbihvcE1hcDogSU9wTWFwLCB2aXNpdG9yRm46IGFueSkge1xyXG4gIC8vICAgbGV0IGJhc2VWaXNpdG9yRm4gPSB0b0Z1bmN0aW9uVmlzaXRvci5iaW5hcnlQcmVkaWNhdGU7XHJcbiAgLy8gICBmb3IgKGxldCBvcCBpbiAob3BNYXAgfHwge30pKSB7XHJcbiAgLy8gICAgIGxldCBjb25maWcgPSBvcE1hcFtvcF07XHJcbiAgLy8gICAgIGNvbmZpZy52aXNpdG9yRm4gPSB2aXNpdG9yRm47XHJcbiAgLy8gICAgIHVwZGF0ZUFsaWFzTWFwKEJpbmFyeVByZWRpY2F0ZS5wcm90b3R5cGUuYWxpYXNNYXAsIG9wLCBvcE1hcFtvcF0pO1xyXG4gIC8vICAgfVxyXG4gIC8vICAgaWYgKCF0b0Z1bmN0aW9uVmlzaXRvci5pc0V4dGVuZGVkKSB7XHJcbiAgLy8gICAgIHRvRnVuY3Rpb25WaXNpdG9yLmJpbmFyeVByZWRpY2F0ZSA9IGZ1bmN0aW9uIChjb250ZXh0LCBleHByMVZhbCwgZXhwcjJWYWwpIHtcclxuICAvLyAgICAgICBsZXQgdmlzaXRvckZuID0gdGhpcy5hbGlhc01hcFt0aGlzLm9wLmtleV0udmlzaXRvckZuO1xyXG4gIC8vICAgICAgIGlmICh2aXNpdG9yRm4pIHtcclxuICAvLyAgICAgICAgIHJldHVybiB2aXNpdG9yRm4oY29udGV4dCwgZXhwcjFWYWwsIGV4cHIyVmFsKTtcclxuICAvLyAgICAgICB9IGVsc2Uge1xyXG4gIC8vICAgICAgICAgcmV0dXJuIGJhc2VWaXNpdG9yRm4oY29udGV4dCwgZXhwcjFWYWwsIGV4cHIyVmFsKTtcclxuICAvLyAgICAgICB9XHJcbiAgLy8gICAgIH07XHJcbiAgLy8gICAgIHRvRnVuY3Rpb25WaXNpdG9yLmlzRXh0ZW5kZWQgPSB0cnVlO1xyXG4gIC8vICAgfVxyXG4gIC8vIH07XHJcblxyXG5cclxuICAvKipcclxuICAnQW5kJ3MgdGhpcyBQcmVkaWNhdGUgd2l0aCBvbmUgb3IgbW9yZSBvdGhlciBQcmVkaWNhdGVzIGFuZCByZXR1cm5zIGEgbmV3ICdjb21wb3NpdGUnIFByZWRpY2F0ZVxyXG4gID4gICAgICBsZXQgZHQgPSBuZXcgRGF0ZSg4OCwgOSwgMTIpO1xyXG4gID4gICAgICBsZXQgcDEgPSBQcmVkaWNhdGUuY3JlYXRlKFwiT3JkZXJEYXRlXCIsIFwibmVcIiwgZHQpO1xyXG4gID4gICAgICBsZXQgcDIgPSBQcmVkaWNhdGUuY3JlYXRlKFwiU2hpcENpdHlcIiwgXCJzdGFydHNXaXRoXCIsIFwiQ1wiKTtcclxuICA+ICAgICAgbGV0IHAzID0gUHJlZGljYXRlLmNyZWF0ZShcIkZyZWlnaHRcIiwgXCI+XCIsIDEwMCk7XHJcbiAgPiAgICAgIGxldCBuZXdQcmVkID0gcDEuYW5kKHAyLCBwMyk7XHJcblxyXG4gIG9yXHJcbiAgPiAgICAgIGxldCBwcmVkcyA9IFtwMiwgcDNdO1xyXG4gID4gICAgICBsZXQgbmV3UHJlZCA9IHAxLmFuZChwcmVkcyk7XHJcblxyXG4gIFRoZSAnYW5kJyBtZXRob2QgaXMgYWxzbyB1c2VkIHRvIHdyaXRlIFwiZmx1ZW50XCIgZXhwcmVzc2lvbnNcclxuICA+ICAgICAgbGV0IHA0ID0gUHJlZGljYXRlLmNyZWF0ZShcIlNoaXBDaXR5XCIsIFwic3RhcnRzd2l0aFwiLCBcIkZcIilcclxuICA+ICAgICAgICAuYW5kKFwiU2l6ZVwiLCBcImd0XCIsIDIwMDApO1xyXG4gIEBwYXJhbSBwcmVkaWNhdGVzIC0gbXVsdGlwbGUgUHJlZGljYXRlcyBvciBhbiBhcnJheSBvZiBQcmVkaWNhdGVzLiBcclxuICBBbnkgbnVsbCBvciB1bmRlZmluZWQgdmFsdWVzIHBhc3NlZCBpbiB3aWxsIGJlIGF1dG9tYXRpY2FsbHkgZmlsdGVyZWQgb3V0IGJlZm9yZSBjb25zdHJ1Y3RpbmcgdGhlIGNvbXBvc2l0ZSBwcmVkaWNhdGUuXHJcbiAgKiovXHJcbiAgYW5kKC4uLmFyZ3M6IGFueVtdKSB7XHJcbiAgICByZXR1cm4gbmV3IEFuZE9yUHJlZGljYXRlKFwiYW5kXCIsIGFyZ3NGb3JBbmRPclByZWRpY2F0ZXModGhpcywgYXJncykpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgJ09yJ3MgdGhpcyBQcmVkaWNhdGUgd2l0aCBvbmUgb3IgbW9yZSBvdGhlciBQcmVkaWNhdGVzIGFuZCByZXR1cm5zIGEgbmV3ICdjb21wb3NpdGUnIFByZWRpY2F0ZVxyXG4gID4gICAgICBsZXQgZHQgPSBuZXcgRGF0ZSg4OCwgOSwgMTIpO1xyXG4gID4gICAgICBsZXQgcDEgPSBQcmVkaWNhdGUuY3JlYXRlKFwiT3JkZXJEYXRlXCIsIFwibmVcIiwgZHQpO1xyXG4gID4gICAgICBsZXQgcDIgPSBQcmVkaWNhdGUuY3JlYXRlKFwiU2hpcENpdHlcIiwgXCJzdGFydHNXaXRoXCIsIFwiQ1wiKTtcclxuICA+ICAgICAgbGV0IHAzID0gUHJlZGljYXRlLmNyZWF0ZShcIkZyZWlnaHRcIiwgXCI+XCIsIDEwMCk7XHJcbiAgPiAgICAgIGxldCBuZXdQcmVkID0gcDEub3IocDIsIHAzKTtcclxuXHJcbiAgb3JcclxuICA+ICAgICAgbGV0IHByZWRzID0gW3AyLCBwM107XHJcbiAgPiAgICAgIGxldCBuZXdQcmVkID0gcDEub3IocHJlZHMpO1xyXG5cclxuICBUaGUgJ29yJyBtZXRob2QgaXMgYWxzbyB1c2VkIHRvIHdyaXRlIFwiZmx1ZW50XCIgZXhwcmVzc2lvbnNcclxuICA+ICAgICAgbGV0IHA0ID0gUHJlZGljYXRlLmNyZWF0ZShcIlNoaXBDaXR5XCIsIFwic3RhcnRzd2l0aFwiLCBcIkZcIilcclxuICA+ICAgICAgICAub3IoXCJTaXplXCIsIFwiZ3RcIiwgMjAwMCk7XHJcbiAgQHBhcmFtIHByZWRpY2F0ZXMgLSBtdWx0aXBsZSBQcmVkaWNhdGVzIG9yIGFuIGFycmF5IG9mIFByZWRpY2F0ZXMuIFxyXG4gIEFueSBudWxsIG9yIHVuZGVmaW5lZCB2YWx1ZXMgcGFzc2VkIGluIHdpbGwgYmUgYXV0b21hdGljYWxseSBmaWx0ZXJlZCBvdXQgYmVmb3JlIGNvbnN0cnVjdGluZyB0aGUgY29tcG9zaXRlIHByZWRpY2F0ZS5cclxuICAqKi9cclxuICBvciguLi5hcmdzOiBhbnlbXSkge1xyXG4gICAgcmV0dXJuIG5ldyBBbmRPclByZWRpY2F0ZShcIm9yXCIsIGFyZ3NGb3JBbmRPclByZWRpY2F0ZXModGhpcywgYXJncykpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgUmV0dXJucyB0aGUgJ25lZ2F0ZWQnIHZlcnNpb24gb2YgdGhpcyBQcmVkaWNhdGVcclxuICA+ICAgICAgbGV0IHAxID0gUHJlZGljYXRlLmNyZWF0ZShcIkZyZWlnaHRcIiwgXCJndFwiLCAxMDApO1xyXG4gID4gICAgICBsZXQgbm90X3AxID0gcDEubm90KCk7XHJcblxyXG4gIFRoaXMgY2FuIGFsc28gYmUgYWNjb21wbGlzaGVkIHVzaW5nIHRoZSAnc3RhdGljJyB2ZXJzaW9uIG9mIHRoZSAnbm90JyBtZXRob2RcclxuICA+ICAgICAgbGV0IHAxID0gUHJlZGljYXRlLmNyZWF0ZShcIkZyZWlnaHRcIiwgXCJndFwiLCAxMDApO1xyXG4gID4gICAgICBsZXQgbm90X3AxID0gUHJlZGljYXRlLm5vdChwMSk7XHJcblxyXG4gIHdoaWNoIHdvdWxkIGJlIHRoZSBzYW1lIGFzXHJcbiAgPiAgICAgIGxldCBub3RfcDEgPSBQcmVkaWNhdGUuY3JlYXRlKFwiRnJlaWdodFwiLCBcImxlXCIsIDEwMCk7XHJcbiAgKiovXHJcbiAgbm90KCkge1xyXG4gICAgcmV0dXJuIG5ldyBVbmFyeVByZWRpY2F0ZShcIm5vdFwiLCB0aGlzKTtcclxuICB9XHJcblxyXG4gIC8vXHJcbiAgdG9KU09OKCkge1xyXG4gICAgLy8gdG9KU09OICggcGFydCBvZiBqcyBzdGFuZGFyZCAtIHRha2VzIGEgc2luZ2xlIHBhcmFtZXRlclxyXG4gICAgLy8gdGhhdCBpcyBlaXRoZXIgXCJcIiBvciB0aGUgbmFtZSBvZiB0aGUgcHJvcGVydHkgYmVpbmcgc2VyaWFsaXplZC5cclxuICAgIHJldHVybiB0aGlzLnRvSlNPTkV4dCh7IGVudGl0eVR5cGU6IHRoaXMuX2VudGl0eVR5cGUgfSk7XHJcbiAgfVxyXG5cclxuICAvKiogRm9yIHVzZSBieSBicmVlemUgcGx1Z2luIGF1dGhvcnMgb25seS4gVGhlIGNsYXNzIGlzIGZvciB1c2UgaW4gYnVpbGRpbmcgYSBbW0lVcmlCdWlsZGVyQWRhcHRlcl1dIGltcGxlbWVudGF0aW9uLiBcclxuICBAYWRhcHRlciAoc2VlIFtbSVVyaUJ1aWxkZXJBZGFwdGVyXV0pICAgIFxyXG4gIEBoaWRkZW4gQGludGVybmFsIFxyXG4gICovXHJcbiAgdG9KU09ORXh0KGNvbnRleHQ6IFZpc2l0Q29udGV4dCkge1xyXG4gICAgcmV0dXJuIHRoaXMudmlzaXQoY29udGV4dCwgdG9KU09OVmlzaXRvcik7XHJcbiAgfVxyXG5cclxuICAvKiogRm9yIHVzZSBieSBicmVlemUgcGx1Z2luIGF1dGhvcnMgb25seS4gVGhlIGNsYXNzIGlzIGZvciB1c2UgaW4gYnVpbGRpbmcgYSBbW0lVcmlCdWlsZGVyQWRhcHRlcl1dIGltcGxlbWVudGF0aW9uLiBcclxuICBAYWRhcHRlciAoc2VlIFtbSVVyaUJ1aWxkZXJBZGFwdGVyXV0pICAgIFxyXG4gIEBoaWRkZW4gQGludGVybmFsIFxyXG4gICovXHJcbiAgdG9GdW5jdGlvbihjb250ZXh0OiBWaXNpdENvbnRleHQpIHtcclxuICAgIHJldHVybiB0aGlzLnZpc2l0KGNvbnRleHQsIHRvRnVuY3Rpb25WaXNpdG9yKTtcclxuICB9XHJcblxyXG4gIHRvU3RyaW5nKCkge1xyXG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMpO1xyXG4gIH1cclxuXHJcbiAgLyoqIEZvciB1c2UgYnkgYnJlZXplIHBsdWdpbiBhdXRob3JzIG9ubHkuIFRoZSBjbGFzcyBpcyBmb3IgdXNlIGluIGJ1aWxkaW5nIGEgW1tJVXJpQnVpbGRlckFkYXB0ZXJdXSBpbXBsZW1lbnRhdGlvbi4gXHJcbiAgQGFkYXB0ZXIgKHNlZSBbW0lVcmlCdWlsZGVyQWRhcHRlcl1dKSAgICBcclxuICBAaGlkZGVuIEBpbnRlcm5hbCBcclxuICAqL1xyXG4gIHZpc2l0KGNvbnRleHQ6IFZpc2l0Q29udGV4dCwgdmlzaXRvcj86IFZpc2l0b3IpIHtcclxuICAgIGlmIChjb3JlLmlzRW1wdHkoY29udGV4dCkpIHtcclxuICAgICAgY29udGV4dCA9IHsgZW50aXR5VHlwZTogdW5kZWZpbmVkIH07XHJcbiAgICB9IGVsc2UgaWYgKGNvbnRleHQgaW5zdGFuY2VvZiBFbnRpdHlUeXBlKSB7XHJcbiAgICAgIGNvbnRleHQgPSB7IGVudGl0eVR5cGU6IGNvbnRleHQgfTtcclxuICAgIH0gZWxzZSBpZiAoIWNvcmUuaGFzT3duUHJvcGVydHkoY29udGV4dCwgXCJlbnRpdHlUeXBlXCIpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkFsbCB2aXNpdG9yIG1ldGhvZHMgbXVzdCBiZSBjYWxsZWQgd2l0aCBhIGNvbnRleHQgb2JqZWN0IGNvbnRhaW5pbmcgYXQgbGVhc3QgYW4gJ2VudGl0eVR5cGUnIHByb3BlcnR5XCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh2aXNpdG9yKSB7XHJcbiAgICAgIGNvbnRleHQudmlzaXRvciA9IHZpc2l0b3I7XHJcbiAgICB9XHJcbiAgICBsZXQgdFZpc2l0b3IgPSB2aXNpdG9yIHx8IGNvbnRleHQudmlzaXRvciE7XHJcbiAgICBsZXQgZm4gPSB0VmlzaXRvclt0aGlzLnZpc2l0b3JNZXRob2ROYW1lXTtcclxuICAgIGlmIChmbiA9PSBudWxsKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuYWJsZSB0byBsb2NhdGUgbWV0aG9kOiBcIiArIHRoaXMudmlzaXRvck1ldGhvZE5hbWUgKyBcIiBvbiB2aXNpdG9yXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBlbnRpdHlUeXBlID0gY29udGV4dC5lbnRpdHlUeXBlO1xyXG4gICAgLy8gZG9uJ3QgYm90aGVyIHZhbGlkYXRpbmcgaWYgYWxyZWFkeSBkb25lIHNvICggb3IgaWYgbm8gX3ZhbGlkYXRlIG1ldGhvZFxyXG4gICAgaWYgKHRoaXMuX3ZhbGlkYXRlICYmIChlbnRpdHlUeXBlID09IG51bGwgfHwgdGhpcy5fZW50aXR5VHlwZSAhPT0gZW50aXR5VHlwZSkpIHtcclxuICAgICAgLy8gZG9uJ3QgbmVlZCB0byBjYXB0dXJlIHJldHVybiB2YWx1ZSBiZWNhdXNlIHZhbGlkYXRpb24gZm4gZG9lc24ndCBoYXZlIG9uZS5cclxuICAgICAgLy8gVE9ETzogdGhpcyB3YXMgb2xkIGNvZGVcclxuICAgICAgLy8gdGhpcy5fdmFsaWRhdGUoZW50aXR5VHlwZSwgY29udGV4dC51c2VzTmFtZU9uU2VydmVyKTtcclxuICAgICAgdGhpcy5fdmFsaWRhdGUoZW50aXR5VHlwZSwgY29udGV4dC50b05hbWVPblNlcnZlcik7XHJcbiAgICAgIHRoaXMuX2VudGl0eVR5cGUgPSBlbnRpdHlUeXBlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmbi5jYWxsKHRoaXMsIGNvbnRleHQpO1xyXG4gIH1cclxuXHJcbiAgLyoqIEBoaWRkZW4gQGludGVybmFsICovXHJcbiAgX2luaXRpYWxpemUodmlzaXRvck1ldGhvZE5hbWU6IHN0cmluZywgb3BNYXA6IHsgW2tleTogc3RyaW5nXTogeyBhbGlhc2VzPzogc3RyaW5nW10sIGlzRnVuY3Rpb24/OiBib29sZWFuIH19ID0ge30pIHtcclxuICAgIHRoaXMudmlzaXRvck1ldGhvZE5hbWUgPSB2aXNpdG9yTWV0aG9kTmFtZTtcclxuICAgIGxldCBhbGlhc01hcCA9IHRoaXMuYWxpYXNNYXAgPSB7fTtcclxuICAgIGZvciAobGV0IG9wIGluIG9wTWFwICkge1xyXG4gICAgICB1cGRhdGVBbGlhc01hcChhbGlhc01hcCwgb3AsIG9wTWFwW29wXSBhcyBPcCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKiogQGhpZGRlbiBAaW50ZXJuYWwgKi9cclxuICBfcmVzb2x2ZU9wKG9wOiBzdHJpbmcgfCBRdWVyeU9wLCBva0lmTm90Rm91bmQ/OiBib29sZWFuKSB7XHJcbiAgICBsZXQgb3BTdHIgPSAodHlwZW9mIG9wID09PSBcInN0cmluZ1wiKSA/IG9wIDogb3Aub3BlcmF0b3I7XHJcbiAgICBsZXQgcmVzdWx0ID0gdGhpcy5hbGlhc01hcFtvcFN0ci50b0xvd2VyQ2FzZSgpXTtcclxuICAgIGlmICghcmVzdWx0ICYmICFva0lmTm90Rm91bmQpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5hYmxlIHRvIHJlc29sdmUgb3BlcmF0b3I6IFwiICsgb3BTdHIpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVQcmVkaWNhdGVGcm9tQXJyYXkoYXJyOiBhbnlbXSkge1xyXG4gIC8vIFRPRE86IGFzc2VydCB0aGF0IGxlbmd0aCBvZiB0aGUgYXJyYXkgc2hvdWxkIGJlID4gM1xyXG4gIC8vIE5lZWRzIHRvIGhhbmRsZTpcclxuICAvLyAgICAgIFsgXCJmcmVpZ2h0XCIsIFwiPlwiLCAxMDBcIl07XHJcbiAgLy8gICAgICBbIFwib3JkZXJzXCIsIFwiYW55XCIsIFwiZnJlaWdodFwiLCAgXCI+XCIsIDk1MCBdXHJcbiAgLy8gICAgICBbIFwib3JkZXJzXCIsIFwiYW5kXCIsIGFub3RoZXJQcmVkIF1cclxuICAvLyAgICAgIFsgXCJvcmRlcnNcIiwgXCJhbmRcIiwgWyBcImZyZWlnaHQsIFwiPlwiLCA5NTAgXV1cclxuICBsZXQganNvbiA9IHt9O1xyXG4gIGxldCB2YWx1ZSA9IHt9O1xyXG4gIGpzb25bYXJyWzBdXSA9IHZhbHVlO1xyXG4gIGxldCBvcCA9IGFyclsxXTtcclxuICBvcCA9IG9wLm9wZXJhdG9yIHx8IG9wOyAgLy8gaW5jb21pbmcgb3Agd2lsbCBiZSBlaXRoZXIgYSBzdHJpbmcgb3IgYSBGaWx0ZXJRdWVyeU9wXHJcbiAgaWYgKGFyci5sZW5ndGggPT09IDMpIHtcclxuICAgIHZhbHVlW29wXSA9IGFyclsyXTtcclxuICB9IGVsc2Uge1xyXG4gICAgdmFsdWVbb3BdID0gY3JlYXRlUHJlZGljYXRlRnJvbUFycmF5KGFyci5zcGxpY2UoMikpO1xyXG4gIH1cclxuICByZXR1cm4gY3JlYXRlUHJlZGljYXRlRnJvbU9iamVjdChqc29uKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlUHJlZGljYXRlRnJvbU9iamVjdChvYmo6IE9iamVjdCkge1xyXG4gIGlmIChvYmogaW5zdGFuY2VvZiBQcmVkaWNhdGUpIHJldHVybiBvYmo7XHJcblxyXG4gIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0Jykge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiVW5hYmxlIHRvIGNvbnZlcnQgdG8gYSBQcmVkaWNhdGU6IFwiICsgb2JqKTtcclxuICB9XHJcbiAgbGV0IGtleXMgPSBPYmplY3Qua2V5cyhvYmopO1xyXG4gIGxldCBwcmVkcyA9IGtleXMubWFwKGZ1bmN0aW9uIChrZXkpIHtcclxuICAgIHJldHVybiBjcmVhdGVQcmVkaWNhdGVGcm9tS2V5VmFsdWUoa2V5LCBvYmpba2V5XSk7XHJcbiAgfSk7XHJcbiAgcmV0dXJuIChwcmVkcy5sZW5ndGggPT09IDEpID8gcHJlZHNbMF0gOiBuZXcgQW5kT3JQcmVkaWNhdGUoXCJhbmRcIiwgcHJlZHMpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVQcmVkaWNhdGVGcm9tS2V5VmFsdWUoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpOiBQcmVkaWNhdGUge1xyXG4gIC8vIHsgYW5kOiBbYSxiXSB9IGtleT0nYW5kJywgdmFsdWUgPSBbYSxiXVxyXG4gIGlmIChBbmRPclByZWRpY2F0ZS5wcm90b3R5cGUuX3Jlc29sdmVPcChrZXksIHRydWUpKSB7XHJcbiAgICByZXR1cm4gbmV3IEFuZE9yUHJlZGljYXRlKGtleSwgdmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgLy8geyBub3Q6IGEgfSAga2V5PSAnbm90JywgdmFsdWUgPSBhXHJcbiAgaWYgKFVuYXJ5UHJlZGljYXRlLnByb3RvdHlwZS5fcmVzb2x2ZU9wKGtleSwgdHJ1ZSkpIHtcclxuICAgIHJldHVybiBuZXcgVW5hcnlQcmVkaWNhdGUoa2V5LCB2YWx1ZSk7XHJcbiAgfVxyXG5cclxuICBpZiAoKHR5cGVvZiB2YWx1ZSAhPT0gJ29iamVjdCcpIHx8IHZhbHVlID09IG51bGwgfHwgY29yZS5pc0RhdGUodmFsdWUpKSB7XHJcbiAgICAvLyB7IGZvbzogYmFyIH0ga2V5PSdmb28nLCB2YWx1ZSA9IGJhciAoIHdoZXJlIGJhciBpcyBhIGxpdGVyYWwgaS5lLiBhIHN0cmluZywgYSBudW1iZXIsIGEgYm9vbGVhbiBvciBhIGRhdGUuXHJcbiAgICByZXR1cm4gbmV3IEJpbmFyeVByZWRpY2F0ZShcImVxXCIsIGtleSwgdmFsdWUpO1xyXG4gIH0gZWxzZSBpZiAoY29yZS5oYXNPd25Qcm9wZXJ0eSh2YWx1ZSwgJ3ZhbHVlJykpIHtcclxuICAgIC8vIHsgZm9vOiB7IHZhbHVlOiBiYXIsIGRhdGFUeXBlOiB4eHh9IH0ga2V5PSdmb28nLCB2YWx1ZSA9IGJhciAoIHdoZXJlIGJhciBpcyBhbiBvYmplY3QgcmVwcmVzZW50aW5nIGEgbGl0ZXJhbFxyXG4gICAgcmV0dXJuIG5ldyBCaW5hcnlQcmVkaWNhdGUoXCJlcVwiLCBrZXksIHZhbHVlKTtcclxuICB9XHJcblxyXG4gIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiVW5hYmxlIHRvIHJlc29sdmUgcHJlZGljYXRlIGFmdGVyIHRoZSBwaHJhc2U6IFwiICsga2V5KTtcclxuICB9XHJcblxyXG4gIGxldCBleHByID0ga2V5O1xyXG4gIGxldCBrZXlzID0gT2JqZWN0LmtleXModmFsdWUpO1xyXG4gIGxldCBwcmVkcyA9IGtleXMubWFwKGZ1bmN0aW9uIChvcCkge1xyXG5cclxuICAgIC8vIHsgYTogeyBhbnk6IGIgfSBvcCA9ICdhbnknLCBleHByPWEsIHZhbHVlW29wXSA9IGJcclxuICAgIGlmIChBbnlBbGxQcmVkaWNhdGUucHJvdG90eXBlLl9yZXNvbHZlT3Aob3AsIHRydWUpKSB7XHJcbiAgICAgIHJldHVybiBuZXcgQW55QWxsUHJlZGljYXRlKG9wLCBleHByLCB2YWx1ZVtvcF0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChCaW5hcnlQcmVkaWNhdGUucHJvdG90eXBlLl9yZXNvbHZlT3Aob3AsIHRydWUpKSB7XHJcbiAgICAgIC8vIHsgYTogeyBcIj5cIjogYiB9fSBvcCA9IFwiPlwiLCBleHByPWEsIHZhbHVlW29wXSA9IGJcclxuICAgICAgcmV0dXJuIG5ldyBCaW5hcnlQcmVkaWNhdGUob3AsIGV4cHIsIHZhbHVlW29wXSk7XHJcbiAgICB9IGVsc2UgaWYgKGNvcmUuaGFzT3duUHJvcGVydHkodmFsdWVbb3BdLCAndmFsdWUnKSkge1xyXG4gICAgICAvLyB7IGE6IHsgXCI+XCI6IHsgdmFsdWU6IGIsIGRhdGFUeXBlOiAnSW50MzInIH19IGV4cHIgPSBhIHZhbHVlW29wXSA9IHsgdmFsdWU6IGIsIGRhdGFUeXBlOiAnSW50MzInIH1cclxuICAgICAgcmV0dXJuIG5ldyBCaW5hcnlQcmVkaWNhdGUoXCJlcVwiLCBleHByLCB2YWx1ZVtvcF0pO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBtc2cgPSBjb3JlLmZvcm1hdFN0cmluZyhcIlVuYWJsZSB0byByZXNvbHZlIHByZWRpY2F0ZSBhZnRlciB0aGUgcGhyYXNlOiAnJTEnIGZvciBvcGVyYXRvcjogJyUyJyAgYW5kIHZhbHVlOiAnJTMnXCIsIGV4cHIsIG9wLCB2YWx1ZVtvcF0pO1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7XHJcblxyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gKHByZWRzLmxlbmd0aCA9PT0gMSkgPyBwcmVkc1swXSA6IG5ldyBBbmRPclByZWRpY2F0ZShcImFuZFwiLCBwcmVkcyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFyZ3NGb3JBbmRPclByZWRpY2F0ZXMob2JqOiB7fSwgYXJnczogYW55W10pIHtcclxuICBsZXQgcHJlZHMgPSBhcmdzWzBdO1xyXG4gIGlmIChwcmVkcyBpbnN0YW5jZW9mIFByZWRpY2F0ZSkge1xyXG4gICAgcHJlZHMgPSBjb3JlLmFycmF5U2xpY2UoYXJncyk7XHJcbiAgfSBlbHNlIGlmICghQXJyYXkuaXNBcnJheShwcmVkcykpIHtcclxuICAgIHByZWRzID0gW25ldyBQcmVkaWNhdGUoY29yZS5hcnJheVNsaWNlKGFyZ3MpKV07XHJcbiAgfVxyXG4gIHJldHVybiBbb2JqXS5jb25jYXQocHJlZHMpO1xyXG59XHJcblxyXG5mdW5jdGlvbiB1cGRhdGVBbGlhc01hcChhbGlhc01hcDogT3BNYXAsIG9wU3RyOiBzdHJpbmcsIG9wOiBPcCkge1xyXG4gIGxldCBrZXkgPSBvcFN0ci50b0xvd2VyQ2FzZSgpO1xyXG4gIG9wLmtleSA9IGtleTtcclxuICBhbGlhc01hcFtrZXldID0gb3A7XHJcblxyXG4gIG9wLmFsaWFzZXMgJiYgb3AuYWxpYXNlcy5mb3JFYWNoKChhbGlhczogYW55KSA9PiB7XHJcbiAgICBhbGlhc01hcFthbGlhcy50b0xvd2VyQ2FzZSgpXSA9IG9wO1xyXG4gIH0pO1xyXG59XHJcblxyXG4vKiogRm9yIHVzZSBieSBicmVlemUgcGx1Z2luIGF1dGhvcnMgb25seS4gVGhlIGNsYXNzIGlzIGZvciB1c2UgaW4gYnVpbGRpbmcgYSBbW0lVcmlCdWlsZGVyQWRhcHRlcl1dIGltcGxlbWVudGF0aW9uLiBcclxuQGFkYXB0ZXIgKHNlZSBbW0lVcmlCdWlsZGVyQWRhcHRlcl1dKSAgICBcclxuQGhpZGRlbiBAaW50ZXJuYWwgXHJcbiovXHJcbmNsYXNzIFBhc3N0aHJ1UHJlZGljYXRlIGV4dGVuZHMgUHJlZGljYXRlIHtcclxuICB2YWx1ZTogYW55O1xyXG4gIGNvbnN0cnVjdG9yKHZhbHVlOiBhbnkpIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgICB0aGlzLnZhbHVlID0gdmFsdWU7XHJcbiAgfVxyXG5cclxuICAvLyBfdmFsaWRhdGUgPSBjb3JlLm5vb3A7XHJcbn1cclxuRXJyb3JbJ3gnXSA9IFBhc3N0aHJ1UHJlZGljYXRlLnByb3RvdHlwZS5faW5pdGlhbGl6ZSgncGFzc3RocnVQcmVkaWNhdGUnKTtcclxuXHJcbi8qKiBGb3IgdXNlIGJ5IGJyZWV6ZSBwbHVnaW4gYXV0aG9ycyBvbmx5LiBUaGUgY2xhc3MgaXMgZm9yIHVzZSBpbiBidWlsZGluZyBhIFtbSVVyaUJ1aWxkZXJBZGFwdGVyXV0gaW1wbGVtZW50YXRpb24uIFxyXG5AYWRhcHRlciAoc2VlIFtbSVVyaUJ1aWxkZXJBZGFwdGVyXV0pICAgIFxyXG5AaGlkZGVuIFxyXG4qL1xyXG5leHBvcnQgY2xhc3MgVW5hcnlQcmVkaWNhdGUgZXh0ZW5kcyBQcmVkaWNhdGUge1xyXG4gIG9wOiBPcDtcclxuICBwcmVkOiBQcmVkaWNhdGU7XHJcbiAgY29uc3RydWN0b3Iob3A6IHN0cmluZyB8IFF1ZXJ5T3AsIC4uLmFyZ3M6IGFueVtdKSB7XHJcbiAgICBzdXBlcigpO1xyXG4gICAgdGhpcy5vcCA9IHRoaXMuX3Jlc29sdmVPcChvcCk7XHJcbiAgICB0aGlzLnByZWQgPSBuZXcgUHJlZGljYXRlKGFyZ3MpO1xyXG4gIH1cclxuXHJcbiAgX3ZhbGlkYXRlKGVudGl0eVR5cGU6IEVudGl0eVR5cGUsIHVzZXNOYW1lT25TZXJ2ZXI/OiBib29sZWFuKSB7XHJcbiAgICB0aGlzLnByZWQuX3ZhbGlkYXRlKGVudGl0eVR5cGUsIHVzZXNOYW1lT25TZXJ2ZXIpO1xyXG4gIH1cclxufVxyXG5cclxuRXJyb3JbJ3gnXSA9IFVuYXJ5UHJlZGljYXRlLnByb3RvdHlwZS5faW5pdGlhbGl6ZSgndW5hcnlQcmVkaWNhdGUnLCB7XHJcbiAgJ25vdCc6IHsgYWxpYXNlczogWychJywgJ34nXSB9LFxyXG59KTtcclxuXHJcbi8qKiBGb3IgdXNlIGJ5IGJyZWV6ZSBwbHVnaW4gYXV0aG9ycyBvbmx5LiBUaGUgY2xhc3MgaXMgZm9yIHVzZSBpbiBidWlsZGluZyBhIFtbSVVyaUJ1aWxkZXJBZGFwdGVyXV0gaW1wbGVtZW50YXRpb24uIFxyXG5AYWRhcHRlciAoc2VlIFtbSVVyaUJ1aWxkZXJBZGFwdGVyXV0pICAgIFxyXG5AaGlkZGVuIFxyXG4qL1xyXG5leHBvcnQgY2xhc3MgQmluYXJ5UHJlZGljYXRlIGV4dGVuZHMgUHJlZGljYXRlIHtcclxuICBvcDogT3A7XHJcbiAgZXhwcjFTb3VyY2U6IGFueTtcclxuICBleHByMlNvdXJjZTogYW55O1xyXG4gIGV4cHIxPzogUHJlZGljYXRlRXhwcmVzc2lvbjtcclxuICBleHByMj86IFByZWRpY2F0ZUV4cHJlc3Npb247XHJcbiAgY29uc3RydWN0b3Iob3A6IHN0cmluZyB8IFF1ZXJ5T3AsIGV4cHIxOiBhbnksIGV4cHIyOiBhbnkpIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgICAvLyA1IHB1YmxpYyBwcm9wcyBvcCwgZXhwcjFTb3VyY2UsIGV4cHIyU291cmNlLCBleHByMSwgZXhwcjJcclxuICAgIHRoaXMub3AgPSB0aGlzLl9yZXNvbHZlT3Aob3ApO1xyXG4gICAgdGhpcy5leHByMVNvdXJjZSA9IGV4cHIxO1xyXG4gICAgdGhpcy5leHByMlNvdXJjZSA9IGV4cHIyO1xyXG4gICAgLy8gdGhpcy5leHByMSBhbmQgdGhpcy5leHByMiB3b24ndCBiZVxyXG4gICAgLy8gZGV0ZXJtaW5lZCB1bnRpbCB2YWxpZGF0ZSBpcyBydW5cclxuICB9XHJcblxyXG5cclxuICBfdmFsaWRhdGUoZW50aXR5VHlwZTogRW50aXR5VHlwZSwgdXNlc05hbWVPblNlcnZlcj86IGJvb2xlYW4pIHtcclxuICAgIGxldCBleHByMUNvbnRleHQgPSB7IGVudGl0eVR5cGU6IGVudGl0eVR5cGUsIHVzZXNOYW1lT25TZXJ2ZXI6IHVzZXNOYW1lT25TZXJ2ZXIgfTtcclxuICAgIHRoaXMuZXhwcjEgPSBjcmVhdGVFeHByKHRoaXMuZXhwcjFTb3VyY2UsIGV4cHIxQ29udGV4dCk7XHJcbiAgICBpZiAodGhpcy5leHByMSA9PSBudWxsKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuYWJsZSB0byB2YWxpZGF0ZSAxc3QgZXhwcmVzc2lvbjogXCIgKyB0aGlzLmV4cHIxU291cmNlKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmV4cHIxIGluc3RhbmNlb2YgTGl0RXhwcikge1xyXG4gICAgICAvLyBsaHMgbXVzdCBiZSBlaXRoZXIgYSBwcm9wZXJ0eSBvciBhIGZ1bmN0aW9uLlxyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgbGVmdCBoYW5kIHNpZGUgb2YgYSBiaW5hcnkgcHJlZGljYXRlIGNhbm5vdCBiZSBhIGxpdGVyYWwgZXhwcmVzc2lvbiwgaXQgbXVzdCBiZSBhIHZhbGlkIHByb3BlcnR5IG9yIGZ1bmN0aW9uYWwgcHJlZGljYXRlIGV4cHJlc3Npb246IFwiICsgdGhpcy5leHByMVNvdXJjZSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMub3Aua2V5ID09PSAnaW4nICYmICFBcnJheS5pc0FycmF5KHRoaXMuZXhwcjJTb3VyY2UpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZSAnaW4nIG9wZXJhdG9yIHJlcXVpcmVzIHRoYXQgaXRzIHJpZ2h0IGhhbmQgYXJndW1lbnQgYmUgYW4gYXJyYXlcIik7XHJcbiAgICB9XHJcbiAgICBsZXQgZXhwcjJDb250ZXh0ID0gY29yZS5leHRlbmQoZXhwcjFDb250ZXh0LCB7IGlzUkhTOiB0cnVlLCBkYXRhVHlwZTogdGhpcy5leHByMS5kYXRhVHlwZSB9KTtcclxuICAgIHRoaXMuZXhwcjIgPSBjcmVhdGVFeHByKHRoaXMuZXhwcjJTb3VyY2UsIGV4cHIyQ29udGV4dCk7XHJcbiAgICBpZiAodGhpcy5leHByMiA9PSBudWxsKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuYWJsZSB0byB2YWxpZGF0ZSAybmQgZXhwcmVzc2lvbjogXCIgKyB0aGlzLmV4cHIyU291cmNlKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5leHByMS5kYXRhVHlwZSA9PSBudWxsKSB7XHJcbiAgICAgIHRoaXMuZXhwcjEuZGF0YVR5cGUgPSB0aGlzLmV4cHIyLmRhdGFUeXBlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcblxyXG59XHJcblxyXG5FcnJvclsneCddID0gQmluYXJ5UHJlZGljYXRlLnByb3RvdHlwZS5faW5pdGlhbGl6ZSgnYmluYXJ5UHJlZGljYXRlJywge1xyXG4gICdlcSc6IHtcclxuICAgIGFsaWFzZXM6IFtcIj09XCIsIFwiZXF1YWxzXCJdXHJcbiAgfSxcclxuICAnbmUnOiB7XHJcbiAgICBhbGlhc2VzOiBbXCIhPVwiLCBcIn49XCIsIFwibm90ZXF1YWxzXCJdXHJcbiAgfSxcclxuICAnbHQnOiB7XHJcbiAgICBhbGlhc2VzOiBbXCI8XCIsIFwibGVzc3RoYW5cIl1cclxuICB9LFxyXG4gICdsZSc6IHtcclxuICAgIGFsaWFzZXM6IFtcIjw9XCIsIFwibGVzc3RoYW5vcmVxdWFsXCJdXHJcbiAgfSxcclxuICAnZ3QnOiB7XHJcbiAgICBhbGlhc2VzOiBbXCI+XCIsIFwiZ3JlYXRlcnRoYW5cIl1cclxuICB9LFxyXG4gICdnZSc6IHtcclxuICAgIGFsaWFzZXM6IFtcIj49XCIsIFwiZ3JlYXRlcnRoYW5vcmVxdWFsXCJdXHJcbiAgfSxcclxuICAnc3RhcnRzd2l0aCc6IHtcclxuICAgIGlzRnVuY3Rpb246IHRydWVcclxuICB9LFxyXG4gICdlbmRzd2l0aCc6IHtcclxuICAgIGlzRnVuY3Rpb246IHRydWVcclxuICB9LFxyXG4gICdjb250YWlucyc6IHtcclxuICAgIGFsaWFzZXM6IFtcInN1YnN0cmluZ29mXCJdLFxyXG4gICAgaXNGdW5jdGlvbjogdHJ1ZVxyXG4gIH0sXHJcbiAgJ2luJzoge1xyXG5cclxuICB9XHJcbn0pO1xyXG5cclxuLyoqIEZvciB1c2UgYnkgYnJlZXplIHBsdWdpbiBhdXRob3JzIG9ubHkuIFRoZSBjbGFzcyBpcyBmb3IgdXNlIGluIGJ1aWxkaW5nIGEgW1tJVXJpQnVpbGRlckFkYXB0ZXJdXSBpbXBsZW1lbnRhdGlvbi4gXHJcbkBhZGFwdGVyIChzZWUgW1tJVXJpQnVpbGRlckFkYXB0ZXJdXSkgICAgXHJcbkBoaWRkZW5cclxuKi9cclxuZXhwb3J0IGNsYXNzIEFuZE9yUHJlZGljYXRlIGV4dGVuZHMgUHJlZGljYXRlIHtcclxuICBvcDogT3A7XHJcbiAgcHJlZHM6IFByZWRpY2F0ZVtdO1xyXG4gIGNvbnN0cnVjdG9yKG9wOiBzdHJpbmcgfCBRdWVyeU9wLCBwcmVkczogYW55W10pIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgICB0aGlzLm9wID0gdGhpcy5fcmVzb2x2ZU9wKG9wKTtcclxuICAgIGlmIChwcmVkcy5sZW5ndGggPT09IDEgJiYgQXJyYXkuaXNBcnJheShwcmVkc1swXSkpIHtcclxuICAgICAgcHJlZHMgPSBwcmVkc1swXTtcclxuICAgIH1cclxuICAgIHRoaXMucHJlZHMgPSBwcmVkcy5maWx0ZXIoZnVuY3Rpb24gKHByZWQpIHtcclxuICAgICAgcmV0dXJuIHByZWQgIT0gbnVsbDtcclxuICAgIH0pLm1hcChmdW5jdGlvbiAocHJlZCkge1xyXG4gICAgICByZXR1cm4gbmV3IFByZWRpY2F0ZShwcmVkKTtcclxuICAgIH0pO1xyXG4gICAgLy8gVE9ETzogdGhpcyB3YXMgcmVtb3ZlZCAtIHRlc3QgaWYgcmVhbGx5IG5lZWRlZC5cclxuICAgIC8vIGlmICh0aGlzLnByZWRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgLy8gICAvLyBtYXJrZXIgZm9yIGFuIGVtcHR5IHByZWRpY2F0ZVxyXG4gICAgLy8gICB0aGlzLm9wID0gbnVsbDtcclxuICAgIC8vIH1cclxuICAgIGlmICh0aGlzLnByZWRzLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5wcmVkc1swXSBhcyBBbmRPclByZWRpY2F0ZTsgLy8gSEFDSzogdGhpcy5wcmVkc1swXSBpcyBhY3R1YWxseSBOT1QgYSBBbmRPclByZWRpY2F0ZSBidXQgc29tZSBvdGhlciBraW5kIG9mIHByZWQuXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfdmFsaWRhdGUoZW50aXR5VHlwZTogRW50aXR5VHlwZSwgdXNlc05hbWVPblNlcnZlcj86IGJvb2xlYW4pIHtcclxuICAgIHRoaXMucHJlZHMuZm9yRWFjaCgocHJlZCkgPT4ge1xyXG4gICAgICBwcmVkLl92YWxpZGF0ZShlbnRpdHlUeXBlLCB1c2VzTmFtZU9uU2VydmVyKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuRXJyb3JbJ3gnXSA9IEFuZE9yUHJlZGljYXRlLnByb3RvdHlwZS5faW5pdGlhbGl6ZShcImFuZE9yUHJlZGljYXRlXCIsIHtcclxuICAnYW5kJzogeyBhbGlhc2VzOiBbJyYmJ10gfSxcclxuICAnb3InOiB7IGFsaWFzZXM6IFsnfHwnXSB9XHJcbn0gKTtcclxuXHJcbi8qKiBGb3IgdXNlIGJ5IGJyZWV6ZSBwbHVnaW4gYXV0aG9ycyBvbmx5LiBUaGUgY2xhc3MgaXMgZm9yIHVzZSBpbiBidWlsZGluZyBhIFtbSVVyaUJ1aWxkZXJBZGFwdGVyXV0gaW1wbGVtZW50YXRpb24uIFxyXG5AYWRhcHRlciAoc2VlIFtbSVVyaUJ1aWxkZXJBZGFwdGVyXV0pICAgIFxyXG5AaGlkZGVuIFxyXG4qL1xyXG5leHBvcnQgY2xhc3MgQW55QWxsUHJlZGljYXRlIGV4dGVuZHMgUHJlZGljYXRlIHtcclxuICBvcDogT3A7XHJcbiAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gIGV4cHI6IFByZWRpY2F0ZUV4cHJlc3Npb247XHJcbiAgZXhwclNvdXJjZTogc3RyaW5nO1xyXG4gIHByZWQ6IFByZWRpY2F0ZTtcclxuICAvLyA0IHB1YmxpYyBwcm9wczogb3AsIGV4cHJTb3VyY2UsIGV4cHIsIHByZWRcclxuICBjb25zdHJ1Y3RvcihvcDogc3RyaW5nIHwgUXVlcnlPcCwgZXhwcjogc3RyaW5nLCBwcmVkOiBhbnkpIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgICB0aGlzLm9wID0gdGhpcy5fcmVzb2x2ZU9wKG9wKTtcclxuICAgIHRoaXMuZXhwclNvdXJjZSA9IGV4cHI7XHJcbiAgICAvLyB0aGlzLmV4cHIgd2lsbCBub3QgYmUgcmVzb2x2ZWQgdW50aWwgdmFsaWRhdGUgaXMgY2FsbGVkXHJcbiAgICB0aGlzLnByZWQgPSBuZXcgUHJlZGljYXRlKHByZWQpO1xyXG4gIH1cclxuXHJcbiAgX3ZhbGlkYXRlKGVudGl0eVR5cGU6IEVudGl0eVR5cGUsIHVzZXNOYW1lT25TZXJ2ZXI6IGJvb2xlYW4pIHtcclxuICAgIHRoaXMuZXhwciA9IGNyZWF0ZUV4cHIodGhpcy5leHByU291cmNlLCB7IGVudGl0eVR5cGU6IGVudGl0eVR5cGUsIHVzZXNOYW1lT25TZXJ2ZXI6IHVzZXNOYW1lT25TZXJ2ZXIgfSBhcyBFeHByZXNzaW9uQ29udGV4dCk7XHJcbiAgICAvLyBjYW4ndCByZWFsbHkga25vdyB0aGUgcHJlZGljYXRlRW50aXR5VHlwZSB1bmxlc3MgdGhlIG9yaWdpbmFsIGVudGl0eSB0eXBlIHdhcyBrbm93bi5cclxuICAgIGlmIChlbnRpdHlUeXBlID09IG51bGwgfHwgZW50aXR5VHlwZS5pc0Fub255bW91cykge1xyXG4gICAgICB0aGlzLmV4cHIuZGF0YVR5cGUgPSB1bmRlZmluZWQ7XHJcbiAgICB9XHJcbiAgICB0aGlzLnByZWQuX3ZhbGlkYXRlKHRoaXMuZXhwci5kYXRhVHlwZSBhcyBFbnRpdHlUeXBlIHwgdW5kZWZpbmVkLCB1c2VzTmFtZU9uU2VydmVyKTtcclxuICB9XHJcblxyXG59XHJcblxyXG5FcnJvclsneCddID0gQW55QWxsUHJlZGljYXRlLnByb3RvdHlwZS5faW5pdGlhbGl6ZShcImFueUFsbFByZWRpY2F0ZVwiLCB7XHJcbiAgJ2FueSc6IHsgYWxpYXNlczogWydzb21lJ10gfSxcclxuICAnYWxsJzogeyBhbGlhc2VzOiBbXCJldmVyeVwiXSB9XHJcbn0pO1xyXG5cclxuLyoqIEBoaWRkZW4gKi9cclxuZXhwb3J0IGNsYXNzIFByZWRpY2F0ZUV4cHJlc3Npb24ge1xyXG4gIHZpc2l0b3JNZXRob2ROYW1lOiBzdHJpbmc7XHJcbiAgdmlzaXQ6IEZ1bmN0aW9uOyAvLyBUT0RPXHJcbiAgZGF0YVR5cGU/OiBEYXRhVHlwZSB8IFN0cnVjdHVyYWxUeXBlO1xyXG4gIGNvbnN0cnVjdG9yKHZpc2l0b3JNZXRob2ROYW1lOiBzdHJpbmcpIHtcclxuICAgIHRoaXMudmlzaXRvck1ldGhvZE5hbWUgPSB2aXNpdG9yTWV0aG9kTmFtZTtcclxuICAgIC8vIGdpdmUgZXhwcmVzc2lvbnMgdGhlIFByZWRpY2F0ZSBwcm90b3R5cGUgbWV0aG9kXHJcbiAgICB0aGlzLnZpc2l0ID0gUHJlZGljYXRlLnByb3RvdHlwZS52aXNpdDtcclxuICB9XHJcblxyXG4gIC8vIGRlZmF1bHQgaW1wbHMgLSBtYXkvd2lsbCBiZSBvdmVycmlkZGVuIGJlIHN1YmNsYXNzIGV4cHJlc3Npb25zXHJcbiAgX3ZhbGlkYXRlKGVudGl0eVR5cGU6IEVudGl0eVR5cGUgfCB1bmRlZmluZWQsIHVzZXNOYW1lT25TZXJ2ZXI/OiBib29sZWFuKSB7XHJcbiAgICAvLyBub29wO1xyXG4gIH1cclxufVxyXG5cclxuLyoqIEZvciB1c2UgYnkgYnJlZXplIHBsdWdpbiBhdXRob3JzIG9ubHkuIFRoZSBjbGFzcyBpcyBmb3IgdXNlIGluIGJ1aWxkaW5nIGEgW1tJVXJpQnVpbGRlckFkYXB0ZXJdXSBpbXBsZW1lbnRhdGlvbi4gXHJcbkBhZGFwdGVyIChzZWUgW1tJVXJpQnVpbGRlckFkYXB0ZXJdXSkgICAgXHJcbkBoaWRkZW4gXHJcbiovXHJcbmV4cG9ydCBjbGFzcyBMaXRFeHByIGV4dGVuZHMgUHJlZGljYXRlRXhwcmVzc2lvbiB7XHJcbiAgdmFsdWU6IGFueTtcclxuICBkYXRhVHlwZTogRGF0YVR5cGU7XHJcbiAgaGFzRXhwbGljaXREYXRhVHlwZTogYm9vbGVhbjtcclxuICAvLyAyIHB1YmxpYyBwcm9wczogdmFsdWUsIGRhdGFUeXBlXHJcbiAgY29uc3RydWN0b3IodmFsdWU6IGFueSwgZGF0YVR5cGU6IHN0cmluZyB8IERhdGFUeXBlIHwgdW5kZWZpbmVkLCBoYXNFeHBsaWNpdERhdGFUeXBlPzogYm9vbGVhbikge1xyXG4gICAgc3VwZXIoXCJsaXRFeHByXCIpO1xyXG4gICAgLy8gZGF0YVR5cGUgbWF5IGNvbWUgaXMgYW4gYSBzdHJpbmdcclxuICAgIGxldCBkdDEgPSByZXNvbHZlRGF0YVR5cGUoZGF0YVR5cGUpO1xyXG4gICAgLy8gaWYgdGhlIERhdGFUeXBlIGNvbWVzIGluIGFzIFVuZGVmaW5lZCB0aGlzIG1lYW5zXHJcbiAgICAvLyB0aGF0IHdlIHNob3VsZCBOT1QgYXR0ZW1wdCB0byBwYXJzZSBpdCBidXQganVzdCBsZWF2ZSBpdCBhbG9uZVxyXG4gICAgLy8gZm9yIG5vdyAtIHRoaXMgaXMgdXN1YWxseSBiZWNhdXNlIGl0IGlzIHBhcnQgb2YgYSBGdW5jIGV4cHIuXHJcbiAgICAvLyBUT0RPOiBjYXN0IGFzIERhdGFUeXBlIHNlZW1zIHRvIGJlIG5lZWRlZCBieSBlYXJseSB2ZXJzaW9uIG9mIFR5cGVEb2MgLSBtYXkgYmUgYWJsZSB0byByZW1vdmUgbGF0ZXJcclxuICAgIGxldCBkdDIgPSAoZHQxIHx8IERhdGFUeXBlLmZyb21WYWx1ZSh2YWx1ZSkpIGFzIERhdGFUeXBlO1xyXG5cclxuICAgIGlmIChkdDIucGFyc2UpIHtcclxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlLm1hcCgodikgPT4geyByZXR1cm4gZHQyLnBhcnNlISh2LCB0eXBlb2Ygdik7IH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMudmFsdWUgPSBkdDIucGFyc2UodmFsdWUsIHR5cGVvZiB2YWx1ZSk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcclxuICAgIH1cclxuICAgIHRoaXMuZGF0YVR5cGUgPSBkdDI7XHJcbiAgICB0aGlzLmhhc0V4cGxpY2l0RGF0YVR5cGUgPSAhIWhhc0V4cGxpY2l0RGF0YVR5cGU7XHJcbiAgfVxyXG5cclxuICB0b1N0cmluZygpIHtcclxuICAgIHJldHVybiBcIiBMaXRFeHByIC0gdmFsdWU6IFwiICsgdGhpcy52YWx1ZS50b1N0cmluZygpICsgXCIgZGF0YVR5cGU6IFwiICsgdGhpcy5kYXRhVHlwZS50b1N0cmluZygpO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlc29sdmVEYXRhVHlwZShkYXRhVHlwZT86IERhdGFUeXBlIHwgc3RyaW5nKSB7XHJcbiAgaWYgKGRhdGFUeXBlID09IG51bGwpIHJldHVybiBkYXRhVHlwZTtcclxuICAvLyBpZiAoRGF0YVR5cGUuY29udGFpbnMoZGF0YVR5cGUpKSB7XHJcbiAgaWYgKGRhdGFUeXBlIGluc3RhbmNlb2YgRGF0YVR5cGUpIHtcclxuICAgIHJldHVybiBkYXRhVHlwZTtcclxuICB9XHJcbiAgaWYgKHR5cGVvZiBkYXRhVHlwZSA9PT0gJ3N0cmluZycpIHtcclxuICAgIGxldCBkdCA9IERhdGFUeXBlLmZyb21OYW1lKGRhdGFUeXBlKSBhcyBEYXRhVHlwZTtcclxuICAgIGlmIChkdCkgcmV0dXJuIGR0O1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiVW5hYmxlIHRvIHJlc29sdmUgYSBkYXRhVHlwZSBuYW1lZDogXCIgKyBkYXRhVHlwZSk7XHJcbiAgfVxyXG5cclxuICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgZGF0YVR5cGUgcGFyYW1ldGVyIHBhc3NlZCBpbnRvIHRoaXMgbGl0ZXJhbCBleHByZXNzaW9uIGlzIG5vdCBhICdEYXRhVHlwZSdcIiArIGRhdGFUeXBlKTtcclxufVxyXG5cclxuLyoqIEZvciB1c2UgYnkgYnJlZXplIHBsdWdpbiBhdXRob3JzIG9ubHkuIFRoZSBjbGFzcyBpcyBmb3IgdXNlIGluIGJ1aWxkaW5nIGEgW1tJVXJpQnVpbGRlckFkYXB0ZXJdXSBpbXBsZW1lbnRhdGlvbi4gXHJcbkBhZGFwdGVyIChzZWUgW1tJVXJpQnVpbGRlckFkYXB0ZXJdXSkgICAgXHJcbkBoaWRkZW4gXHJcbiovXHJcbmV4cG9ydCBjbGFzcyBQcm9wRXhwciBleHRlbmRzIFByZWRpY2F0ZUV4cHJlc3Npb24ge1xyXG4gIHByb3BlcnR5UGF0aDogc3RyaW5nO1xyXG4gIGRhdGFUeXBlOiBEYXRhVHlwZSB8IFN0cnVjdHVyYWxUeXBlO1xyXG4gIC8vIHR3byBwdWJsaWMgcHJvcHM6IHByb3BlcnR5UGF0aCwgZGF0ZVR5cGVcclxuICBjb25zdHJ1Y3Rvcihwcm9wZXJ0eVBhdGg6IHN0cmluZykge1xyXG4gICAgc3VwZXIoJ3Byb3BFeHByJyk7XHJcbiAgICB0aGlzLnByb3BlcnR5UGF0aCA9IHByb3BlcnR5UGF0aDtcclxuICAgIC8vdGhpcy5kYXRhVHlwZSA9IERhdGFUeXBlLlVuZGVmaW5lZDtcclxuICAgIC8vIHRoaXMuZGF0YVR5cGUgcmVzb2x2ZWQgYWZ0ZXIgdmFsaWRhdGUgKCBpZiBub3Qgb24gYW4gYW5vbiB0eXBlIH1cclxuICB9XHJcblxyXG4gIHRvU3RyaW5nKCkge1xyXG4gICAgcmV0dXJuIFwiIFByb3BFeHByIC0gXCIgKyB0aGlzLnByb3BlcnR5UGF0aDtcclxuICB9XHJcblxyXG4gIF92YWxpZGF0ZShlbnRpdHlUeXBlOiBFbnRpdHlUeXBlIHwgdW5kZWZpbmVkLCB1c2VzTmFtZU9uU2VydmVyPzogYm9vbGVhbikge1xyXG5cclxuICAgIGlmIChlbnRpdHlUeXBlID09IG51bGwgfHwgZW50aXR5VHlwZS5pc0Fub255bW91cykgcmV0dXJuO1xyXG4gICAgbGV0IHByb3BzID0gZW50aXR5VHlwZS5nZXRQcm9wZXJ0aWVzT25QYXRoKHRoaXMucHJvcGVydHlQYXRoLCBudWxsLCBmYWxzZSk7XHJcblxyXG4gICAgaWYgKCFwcm9wcykge1xyXG4gICAgICBsZXQgbXNnID0gY29yZS5mb3JtYXRTdHJpbmcoXCJVbmFibGUgdG8gcmVzb2x2ZSBwcm9wZXJ0eVBhdGguICBFbnRpdHlUeXBlOiAnJTEnICAgUHJvcGVydHlQYXRoOiAnJTInXCIsIGVudGl0eVR5cGUubmFtZSwgdGhpcy5wcm9wZXJ0eVBhdGgpO1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IobXNnKTtcclxuICAgIH1cclxuICAgIC8vIGdldCB0aGUgbGFzdCBwcm9wZXJ0eVxyXG4gICAgbGV0IHByb3AgPSBwcm9wc1twcm9wcy5sZW5ndGggLSAxXTtcclxuICAgIGlmIChwcm9wIGluc3RhbmNlb2YgRGF0YVByb3BlcnR5KSB7XHJcbiAgICAgIHRoaXMuZGF0YVR5cGUgPSBwcm9wLmRhdGFUeXBlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5kYXRhVHlwZSA9IHByb3AuZW50aXR5VHlwZTtcclxuICAgIH1cclxuICB9XHJcblxyXG59XHJcblxyXG4vKiogRm9yIHVzZSBieSBicmVlemUgcGx1Z2luIGF1dGhvcnMgb25seS4gVGhlIGNsYXNzIGlzIGZvciB1c2UgaW4gYnVpbGRpbmcgYSBbW0lVcmlCdWlsZGVyQWRhcHRlcl1dIGltcGxlbWVudGF0aW9uLiBcclxuQGFkYXB0ZXIgKHNlZSBbW0lVcmlCdWlsZGVyQWRhcHRlcl1dKSAgICBcclxuQGhpZGRlbiBAZHluYW1pY1xyXG4qL1xyXG5leHBvcnQgY2xhc3MgRm5FeHByIGV4dGVuZHMgUHJlZGljYXRlRXhwcmVzc2lvbiB7XHJcbiAgZm5OYW1lOiBzdHJpbmc7XHJcbiAgZXhwcnM6IFByZWRpY2F0ZUV4cHJlc3Npb25bXTtcclxuICBsb2NhbEZuOiBhbnk7IC8vIFRPRE86XHJcbiAgZGF0YVR5cGU6IERhdGFUeXBlO1xyXG4gIGNvbnN0cnVjdG9yKGZuTmFtZTogc3RyaW5nLCBleHByczogUHJlZGljYXRlRXhwcmVzc2lvbltdKSB7XHJcbiAgICBzdXBlcignZm5FeHByJyk7XHJcbiAgICAvLyA0IHB1YmxpYyBwcm9wczogZm5OYW1lLCBleHBycywgbG9jYWxGbiwgZGF0YVR5cGVcclxuICAgIHRoaXMuZm5OYW1lID0gZm5OYW1lO1xyXG4gICAgdGhpcy5leHBycyA9IGV4cHJzO1xyXG4gICAgbGV0IHFmID0gRm5FeHByLl9mdW5jTWFwW2ZuTmFtZV07XHJcbiAgICBpZiAocWYgPT0gbnVsbCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmtub3duIGZ1bmN0aW9uOiBcIiArIGZuTmFtZSk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmxvY2FsRm4gPSBxZi5mbjtcclxuICAgIHRoaXMuZGF0YVR5cGUgPSBxZi5kYXRhVHlwZTtcclxuICB9XHJcblxyXG4gIHRvU3RyaW5nKCkge1xyXG4gICAgbGV0IGV4cHJTdHIgPSB0aGlzLmV4cHJzLm1hcChmdW5jdGlvbiAoZXhwcikge1xyXG4gICAgICBleHByLnRvU3RyaW5nKCk7XHJcbiAgICB9KS50b1N0cmluZygpO1xyXG4gICAgcmV0dXJuIFwiRm5FeHByIC0gXCIgKyB0aGlzLmZuTmFtZSArIFwiKFwiICsgZXhwclN0ciArIFwiKVwiO1xyXG4gIH1cclxuXHJcbiAgX3ZhbGlkYXRlKGVudGl0eVR5cGU6IEVudGl0eVR5cGUgfCB1bmRlZmluZWQsIHVzZXNOYW1lT25TZXJ2ZXI/OiBib29sZWFuKSB7XHJcbiAgICB0aGlzLmV4cHJzLmZvckVhY2goZnVuY3Rpb24gKGV4cHIpIHtcclxuICAgICAgZXhwci5fdmFsaWRhdGUoZW50aXR5VHlwZSwgdXNlc05hbWVPblNlcnZlcik7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBfZnVuY01hcCA9IHtcclxuICAgIHRvdXBwZXI6IHtcclxuICAgICAgZm46IGZ1bmN0aW9uIChzb3VyY2U6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiBzb3VyY2UudG9VcHBlckNhc2UoKTtcclxuICAgICAgfSwgZGF0YVR5cGU6IERhdGFUeXBlLlN0cmluZ1xyXG4gICAgfSxcclxuICAgIHRvbG93ZXI6IHtcclxuICAgICAgZm46IGZ1bmN0aW9uIChzb3VyY2U6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiBzb3VyY2UudG9Mb3dlckNhc2UoKTtcclxuICAgICAgfSwgZGF0YVR5cGU6IERhdGFUeXBlLlN0cmluZ1xyXG4gICAgfSxcclxuICAgIHN1YnN0cmluZzoge1xyXG4gICAgICBmbjogZnVuY3Rpb24gKHNvdXJjZTogc3RyaW5nLCBwb3M6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIpIHtcclxuICAgICAgICByZXR1cm4gc291cmNlLnN1YnN0cmluZyhwb3MsIGxlbmd0aCk7XHJcbiAgICAgIH0sIGRhdGFUeXBlOiBEYXRhVHlwZS5TdHJpbmdcclxuICAgIH0sXHJcbiAgICBzdWJzdHJpbmdvZjoge1xyXG4gICAgICBmbjogZnVuY3Rpb24gKGZpbmQ6IHN0cmluZywgc291cmNlOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gc291cmNlLmluZGV4T2YoZmluZCkgPj0gMDtcclxuICAgICAgfSwgZGF0YVR5cGU6IERhdGFUeXBlLkJvb2xlYW5cclxuICAgIH0sXHJcbiAgICBsZW5ndGg6IHtcclxuICAgICAgZm46IGZ1bmN0aW9uIChzb3VyY2U6IGFueSkge1xyXG4gICAgICAgIHJldHVybiBzb3VyY2UubGVuZ3RoO1xyXG4gICAgICB9LCBkYXRhVHlwZTogRGF0YVR5cGUuSW50MzJcclxuICAgIH0sXHJcbiAgICB0cmltOiB7XHJcbiAgICAgIGZuOiBmdW5jdGlvbiAoc291cmNlOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gc291cmNlLnRyaW0oKTtcclxuICAgICAgfSwgZGF0YVR5cGU6IERhdGFUeXBlLlN0cmluZ1xyXG4gICAgfSxcclxuICAgIGNvbmNhdDoge1xyXG4gICAgICBmbjogZnVuY3Rpb24gKHMxOiBzdHJpbmcsIHMyOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gczEuY29uY2F0KHMyKTtcclxuICAgICAgfSwgZGF0YVR5cGU6IERhdGFUeXBlLlN0cmluZ1xyXG4gICAgfSxcclxuICAgIHJlcGxhY2U6IHtcclxuICAgICAgZm46IGZ1bmN0aW9uIChzb3VyY2U6IHN0cmluZywgZmluZDogc3RyaW5nLCByZXBsYWNlOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gc291cmNlLnJlcGxhY2UoZmluZCwgcmVwbGFjZSk7XHJcbiAgICAgIH0sIGRhdGFUeXBlOiBEYXRhVHlwZS5TdHJpbmdcclxuICAgIH0sXHJcbiAgICBzdGFydHN3aXRoOiB7XHJcbiAgICAgIGZuOiBmdW5jdGlvbiAoc291cmNlOiBzdHJpbmcsIGZpbmQ6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiBjb3JlLnN0cmluZ1N0YXJ0c1dpdGgoc291cmNlLCBmaW5kKTtcclxuICAgICAgfSwgZGF0YVR5cGU6IERhdGFUeXBlLkJvb2xlYW5cclxuICAgIH0sXHJcbiAgICBlbmRzd2l0aDoge1xyXG4gICAgICBmbjogZnVuY3Rpb24gKHNvdXJjZTogc3RyaW5nLCBmaW5kOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gY29yZS5zdHJpbmdFbmRzV2l0aChzb3VyY2UsIGZpbmQpO1xyXG4gICAgICB9LCBkYXRhVHlwZTogRGF0YVR5cGUuQm9vbGVhblxyXG4gICAgfSxcclxuICAgIGluZGV4b2Y6IHtcclxuICAgICAgZm46IGZ1bmN0aW9uIChzb3VyY2U6IGFueSwgZmluZDogYW55KSB7XHJcbiAgICAgICAgcmV0dXJuIHNvdXJjZS5pbmRleE9mKGZpbmQpO1xyXG4gICAgICB9LCBkYXRhVHlwZTogRGF0YVR5cGUuSW50MzJcclxuICAgIH0sXHJcbiAgICByb3VuZDoge1xyXG4gICAgICBmbjogZnVuY3Rpb24gKHNvdXJjZTogbnVtYmVyKSB7XHJcbiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoc291cmNlKTtcclxuICAgICAgfSwgZGF0YVR5cGU6IERhdGFUeXBlLkludDMyXHJcbiAgICB9LFxyXG4gICAgY2VpbGluZzoge1xyXG4gICAgICBmbjogZnVuY3Rpb24gKHNvdXJjZTogbnVtYmVyKSB7XHJcbiAgICAgICAgcmV0dXJuIE1hdGguY2VpbChzb3VyY2UpO1xyXG4gICAgICB9LCBkYXRhVHlwZTogRGF0YVR5cGUuSW50MzJcclxuICAgIH0sXHJcbiAgICBmbG9vcjoge1xyXG4gICAgICBmbjogZnVuY3Rpb24gKHNvdXJjZTogbnVtYmVyKSB7XHJcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3Ioc291cmNlKTtcclxuICAgICAgfSwgZGF0YVR5cGU6IERhdGFUeXBlLkludDMyXHJcbiAgICB9LFxyXG4gICAgc2Vjb25kOiB7XHJcbiAgICAgIGZuOiBmdW5jdGlvbiAoc291cmNlOiBEYXRlKSB7XHJcbiAgICAgICAgcmV0dXJuIHNvdXJjZS5nZXRTZWNvbmRzKCk7XHJcbiAgICAgIH0sIGRhdGFUeXBlOiBEYXRhVHlwZS5JbnQzMlxyXG4gICAgfSxcclxuICAgIG1pbnV0ZToge1xyXG4gICAgICBmbjogZnVuY3Rpb24gKHNvdXJjZTogRGF0ZSkge1xyXG4gICAgICAgIHJldHVybiBzb3VyY2UuZ2V0TWludXRlcygpO1xyXG4gICAgICB9LCBkYXRhVHlwZTogRGF0YVR5cGUuSW50MzJcclxuICAgIH0sXHJcbiAgICBkYXk6IHtcclxuICAgICAgZm46IGZ1bmN0aW9uIChzb3VyY2U6IERhdGUpIHtcclxuICAgICAgICByZXR1cm4gc291cmNlLmdldERhdGUoKTtcclxuICAgICAgfSwgZGF0YVR5cGU6IERhdGFUeXBlLkludDMyXHJcbiAgICB9LFxyXG4gICAgbW9udGg6IHtcclxuICAgICAgZm46IGZ1bmN0aW9uIChzb3VyY2U6IERhdGUpIHtcclxuICAgICAgICByZXR1cm4gc291cmNlLmdldE1vbnRoKCkgKyAxO1xyXG4gICAgICB9LCBkYXRhVHlwZTogRGF0YVR5cGUuSW50MzJcclxuICAgIH0sXHJcbiAgICB5ZWFyOiB7XHJcbiAgICAgIGZuOiBmdW5jdGlvbiAoc291cmNlOiBEYXRlKSB7XHJcbiAgICAgICAgcmV0dXJuIHNvdXJjZS5nZXRGdWxsWWVhcigpO1xyXG4gICAgICB9LCBkYXRhVHlwZTogRGF0YVR5cGUuSW50MzJcclxuICAgIH1cclxuICB9O1xyXG5cclxufVxyXG5cclxuLy8gVE9ETzogYWRkIGRhdGFUeXBlcyBmb3IgdGhlIGFyZ3MgbmV4dCAtIHdpbGwgaGVscCB0byBpbmZlciBvdGhlciBkYXRhVHlwZXMuXHJcblxyXG5cclxubGV0IFJYX0lERU5USUZJRVIgPSAvXlthLXpfXVtcXHcuJF0qJC9pO1xyXG4vLyBjb21tYSBkZWxpbWl0ZWQgZXhwcmVzc2lvbnMgaWdub3JpbmcgY29tbWFzIGluc2lkZSBvZiBib3RoIHNpbmdsZSBhbmQgZG91YmxlIHF1b3Rlcy5cclxubGV0IFJYX0NPTU1BX0RFTElNMSA9IC8oJ1teJ10qJ3xbXixdKykvZztcclxubGV0IFJYX0NPTU1BX0RFTElNMiA9IC8oXCJbXlwiXSpcInxbXixdKykvZztcclxubGV0IERFTElNID0gU3RyaW5nLmZyb21DaGFyQ29kZSgxOTEpO1xyXG5cclxuZnVuY3Rpb24gY3JlYXRlRXhwcihzb3VyY2U6IGFueSwgZXhwckNvbnRleHQ6IEV4cHJlc3Npb25Db250ZXh0KSB7XHJcbiAgbGV0IGVudGl0eVR5cGUgPSBleHByQ29udGV4dC5lbnRpdHlUeXBlO1xyXG5cclxuICAvLyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIGFuICdpbicgY2xhdXNlXHJcbiAgaWYgKEFycmF5LmlzQXJyYXkoc291cmNlKSkge1xyXG4gICAgaWYgKCFleHByQ29udGV4dC5pc1JIUykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBcnJheSBleHByZXNzaW9ucyBhcmUgb25seSBwZXJtaXR0ZWQgb24gdGhlIHJpZ2h0IGhhbmQgc2lkZSBvZiBhIEJpbmFyeVByZWRpY2F0ZVwiKTtcclxuICAgIH1cclxuICAgIHJldHVybiBuZXcgTGl0RXhwcihzb3VyY2UsIGV4cHJDb250ZXh0LmRhdGFUeXBlISk7XHJcbiAgfVxyXG5cclxuICBpZiAoISh0eXBlb2Ygc291cmNlID09PSAnc3RyaW5nJykpIHtcclxuICAgIGlmIChzb3VyY2UgIT0gbnVsbCAmJiB0eXBlb2Ygc291cmNlID09PSAnb2JqZWN0JyAmJiAhc291cmNlLnRvSVNPU3RyaW5nKSB7XHJcbiAgICAgIC8vIHNvdXJjZSBpcyBhbiBvYmplY3QgYnV0IG5vdCBhIERhdGUtbGlrZSB0aGluZyBzdWNoIGFzIGEgSlMgb3IgTW9tZW50SlMgRGF0ZVxyXG4gICAgICBpZiAoc291cmNlLnZhbHVlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmFibGUgdG8gcmVzb2x2ZSBhbiBleHByZXNzaW9uIGZvcjogXCIgKyBzb3VyY2UgKyBcIiBvbiBlbnRpdHlUeXBlOiBcIiArIChlbnRpdHlUeXBlID8gZW50aXR5VHlwZS5uYW1lIDogJ251bGwnKSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHNvdXJjZS5pc1Byb3BlcnR5KSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9wRXhwcihzb3VyY2UudmFsdWUpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIHdlIHdhbnQgdG8gaW5zdXJlIHRoYXQgYW55IExpdEV4cHIgY3JlYXRlZCB0aGlzIHdheSBpcyB0YWdnZWQgd2l0aCAnaGFzRXhwbGljaXREYXRhVHlwZTogdHJ1ZSdcclxuICAgICAgICAvLyBiZWNhdXNlIHdlIHdhbnQgdG8gaW5zdXJlIHRoYXQgaWYgd2Ugcm91bmR0cmlwIHRocnUgdG9KU09OIHRoYXQgd2UgZG9uJ3RcclxuICAgICAgICAvLyBhY2NpZGVudGFsbHkgcmVpbnRlcnByZXQgdGhpcyBub2RlIGFzIGEgUHJvcEV4cHIuXHJcbiAgICAgICAgLy8gcmV0dXJuIG5ldyBMaXRFeHByKHNvdXJjZS52YWx1ZSwgc291cmNlLmRhdGFUeXBlIHx8IGNvbnRleHQuZGF0YVR5cGUsICEhc291cmNlLmRhdGFUeXBlKTtcclxuICAgICAgICByZXR1cm4gbmV3IExpdEV4cHIoc291cmNlLnZhbHVlLCBzb3VyY2UuZGF0YVR5cGUgfHwgZXhwckNvbnRleHQuZGF0YVR5cGUsIHRydWUpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gbmV3IExpdEV4cHIoc291cmNlLCBleHByQ29udGV4dC5kYXRhVHlwZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBpZiAoZXhwckNvbnRleHQuaXNSSFMpIHtcclxuICAgIGlmIChlbnRpdHlUeXBlID09IG51bGwgfHwgZW50aXR5VHlwZS5pc0Fub255bW91cykge1xyXG4gICAgICAvLyBpZiBlbnRpdHlUeXBlIGlzIHVua25vd24gdGhlbiBhc3N1bWUgdGhhdCB0aGUgcmhzIGlzIGEgbGl0ZXJhbFxyXG4gICAgICByZXR1cm4gbmV3IExpdEV4cHIoc291cmNlLCBleHByQ29udGV4dC5kYXRhVHlwZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gcGFyc2VMaXRPclByb3BFeHByKHNvdXJjZSwgZXhwckNvbnRleHQpO1xyXG4gICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICBsZXQgcmVnZXggPSAvXFwoW14oKV0qXFwpLztcclxuICAgIGxldCBtOiBSZWdFeHBFeGVjQXJyYXkgfCBudWxsO1xyXG4gICAgbGV0IHRva2Vuczogc3RyaW5nW10gPSBbXTtcclxuICAgIGxldCBpID0gMDtcclxuICAgIHdoaWxlIChtID0gcmVnZXguZXhlYyhzb3VyY2UpKSB7XHJcbiAgICAgIGxldCB0b2tlbiA9IG1bMF07XHJcbiAgICAgIHRva2Vucy5wdXNoKHRva2VuKTtcclxuICAgICAgbGV0IHJlcGwgPSBERUxJTSArIGkrKztcclxuICAgICAgc291cmNlID0gc291cmNlLnJlcGxhY2UodG9rZW4sIHJlcGwpO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBleHByID0gcGFyc2VFeHByKHNvdXJjZSwgdG9rZW5zLCBleHByQ29udGV4dCk7XHJcbiAgICBleHByLl92YWxpZGF0ZShlbnRpdHlUeXBlLCBleHByQ29udGV4dC51c2VzTmFtZU9uU2VydmVyKTtcclxuICAgIHJldHVybiBleHByO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcGFyc2VFeHByKHNvdXJjZTogc3RyaW5nLCB0b2tlbnM6IHN0cmluZ1tdLCBleHByQ29udGV4dDogRXhwcmVzc2lvbkNvbnRleHQpOiBQcmVkaWNhdGVFeHByZXNzaW9uIHtcclxuICBsZXQgcGFydHMgPSBzb3VyY2Uuc3BsaXQoREVMSU0pO1xyXG4gIGlmIChwYXJ0cy5sZW5ndGggPT09IDEpIHtcclxuICAgIHJldHVybiBwYXJzZUxpdE9yUHJvcEV4cHIocGFydHNbMF0sIGV4cHJDb250ZXh0KTtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIHBhcnNlRm5FeHByKHNvdXJjZSwgcGFydHMsIHRva2VucywgZXhwckNvbnRleHQpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcGFyc2VMaXRPclByb3BFeHByKHZhbHVlOiBzdHJpbmcsIGV4cHJDb250ZXh0OiBFeHByZXNzaW9uQ29udGV4dCk6IFByZWRpY2F0ZUV4cHJlc3Npb24ge1xyXG4gIHZhbHVlID0gdmFsdWUudHJpbSgpO1xyXG4gIC8vIHZhbHVlIGlzIGVpdGhlciBhIHN0cmluZywgYSBxdW90ZWQgc3RyaW5nLCBhIG51bWJlciwgYSBib29sIHZhbHVlLCBvciBhIGRhdGVcclxuICAvLyBpZiBhIHN0cmluZyAoIG5vdCBhIHF1b3RlZCBzdHJpbmcpIHRoZW4gdGhpcyByZXByZXNlbnRzIGEgcHJvcGVydHkgbmFtZSAoIDFzdCApIG9yIGEgbGl0IHN0cmluZyAoIDJuZClcclxuICBsZXQgZmlyc3RDaGFyID0gdmFsdWUuc3Vic3RyKDAsIDEpO1xyXG4gIGxldCBpc1F1b3RlZCA9IChmaXJzdENoYXIgPT09IFwiJ1wiIHx8IGZpcnN0Q2hhciA9PT0gJ1wiJykgJiYgdmFsdWUubGVuZ3RoID4gMSAmJiB2YWx1ZS5zdWJzdHIodmFsdWUubGVuZ3RoIC0gMSkgPT09IGZpcnN0Q2hhcjtcclxuICBpZiAoaXNRdW90ZWQpIHtcclxuICAgIGxldCB1bnF1b3RlZFZhbHVlID0gdmFsdWUuc3Vic3RyKDEsIHZhbHVlLmxlbmd0aCAtIDIpO1xyXG4gICAgcmV0dXJuIG5ldyBMaXRFeHByKHVucXVvdGVkVmFsdWUsIGV4cHJDb250ZXh0LmRhdGFUeXBlIHx8IERhdGFUeXBlLlN0cmluZyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGxldCBlbnRpdHlUeXBlID0gZXhwckNvbnRleHQuZW50aXR5VHlwZTtcclxuICAgIC8vIFRPRE86IGdldCByaWQgb2YgaXNBbm9ueW1vdXMgYmVsb3cgd2hlbiB3ZSBnZXQgdGhlIGNoYW5jZS5cclxuICAgIGlmIChlbnRpdHlUeXBlID09IG51bGwgfHwgZW50aXR5VHlwZS5pc0Fub255bW91cykge1xyXG4gICAgICAvLyB0aGlzIGZvcmsgd2lsbCBvbmx5IGJlIHJlYWNoZWQgb24gdGhlIExIUyBvZiBhbiBCaW5hcnlQcmVkaWNhdGUgLVxyXG4gICAgICAvLyBhIFJIUyBleHByIGNhbm5vdCBnZXQgaGVyZSB3aXRoIGFuIGFub24gdHlwZVxyXG4gICAgICByZXR1cm4gbmV3IFByb3BFeHByKHZhbHVlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxldCBtYXlCZUlkZW50aWZpZXIgPSBSWF9JREVOVElGSUVSLnRlc3QodmFsdWUpO1xyXG4gICAgICBpZiAobWF5QmVJZGVudGlmaWVyKSB7XHJcbiAgICAgICAgLy8gaWYgKGVudGl0eVR5cGUuZ2V0UHJvcGVydHkodmFsdWUsIGZhbHNlKSAhPSBudWxsKSB7XHJcbiAgICAgICAgaWYgKGVudGl0eVR5cGUuZ2V0UHJvcGVydGllc09uUGF0aCh2YWx1ZSwgbnVsbCwgZmFsc2UpICE9IG51bGwpIHtcclxuICAgICAgICAgIHJldHVybiBuZXcgUHJvcEV4cHIodmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gd2UgZG9uJ3QgcmVhbGx5IGtub3cgdGhlIGRhdGF0eXBlIGhlcmUgYmVjYXVzZSBldmVuIHRob3VnaCBpdCBjb21lcyBpbiBhcyBhIHN0cmluZ1xyXG4gICAgLy8gaXRzIHVzdWFsbHkgYSBzdHJpbmcgQlVUIGl0IG1pZ2h0IGJlIGEgbnVtYmVyICBpLmUuIHRoZSBcIjFcIiBvciB0aGUgXCIyXCIgZnJvbSBhbiBleHByXHJcbiAgICAvLyBsaWtlIFwidG9VcHBlcihzdWJzdHJpbmcoY29tcGFueU5hbWUsIDEsIDIpKVwiXHJcbiAgICByZXR1cm4gbmV3IExpdEV4cHIodmFsdWUsIGV4cHJDb250ZXh0LmRhdGFUeXBlKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBhcnNlRm5FeHByKHNvdXJjZTogc3RyaW5nLCBwYXJ0czogc3RyaW5nW10sIHRva2Vuczogc3RyaW5nW10sIGV4cHJDb250ZXh0OiBFeHByZXNzaW9uQ29udGV4dCkge1xyXG4gIHRyeSB7XHJcbiAgICBsZXQgZm5OYW1lID0gcGFydHNbMF0udHJpbSgpLnRvTG93ZXJDYXNlKCk7XHJcblxyXG4gICAgbGV0IGFyZ1NvdXJjZSA9IHRva2Vuc1twYXJ0c1sxXV0udHJpbSgpIGFzIHN0cmluZztcclxuICAgIGlmIChhcmdTb3VyY2Uuc3Vic3RyKDAsIDEpID09PSBcIihcIikge1xyXG4gICAgICBhcmdTb3VyY2UgPSBhcmdTb3VyY2Uuc3Vic3RyKDEsIGFyZ1NvdXJjZS5sZW5ndGggLSAyKTtcclxuICAgIH1cclxuICAgIGxldCBjb21tYU1hdGNoU3RyID0gc291cmNlLmluZGV4T2YoXCInXCIpID49IDAgPyBSWF9DT01NQV9ERUxJTTEgOiBSWF9DT01NQV9ERUxJTTI7XHJcbiAgICBsZXQgYXJncyA9IGFyZ1NvdXJjZS5tYXRjaChjb21tYU1hdGNoU3RyKTtcclxuICAgIGxldCBuZXdDb250ZXh0ID0gY29yZS5leHRlbmQoe30sIGV4cHJDb250ZXh0KSBhcyBFeHByZXNzaW9uQ29udGV4dDtcclxuICAgIC8vIGEgZGF0YVR5cGUgb2YgVW5kZWZpbmVkIG9uIGEgY29udGV4dCBiYXNpY2FsbHkgbWVhbnMgbm90IHRvIHRyeSBwYXJzaW5nXHJcbiAgICAvLyB0aGUgdmFsdWUgaWYgdGhlIGV4cHIgaXMgYSBsaXRlcmFsXHJcbiAgICBuZXdDb250ZXh0LmRhdGFUeXBlID0gRGF0YVR5cGUuVW5kZWZpbmVkO1xyXG4gICAgbmV3Q29udGV4dC5pc0ZuQXJnID0gdHJ1ZTtcclxuICAgIGxldCBleHBycyA9IGFyZ3MhLm1hcChmdW5jdGlvbiAoYSkge1xyXG4gICAgICByZXR1cm4gcGFyc2VFeHByKGEsIHRva2VucywgbmV3Q29udGV4dCk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBuZXcgRm5FeHByKGZuTmFtZSwgZXhwcnMpO1xyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIC8vIFRPRE86IHJlbW92ZWQgb2xkIGNvZGUgaGVyZVxyXG4gICAgLy8gcmV0dXJuIG51bGw7XHJcbiAgICAvLyBhbmQgcmVwbGFjZWQgd2l0aCBcclxuICAgIHRocm93IGU7XHJcbiAgfVxyXG59XHJcblxyXG4vLyB0b0Z1bmN0aW9uVmlzaXRvclxyXG5cclxubGV0IHRvRnVuY3Rpb25WaXNpdG9yID0ge1xyXG5cclxuICBpc0V4dGVuZGVkOiBmYWxzZSxcclxuXHJcbiAgcGFzc3RocnVQcmVkaWNhdGU6IGZ1bmN0aW9uICh0aGlzOiBQYXNzdGhydVByZWRpY2F0ZSkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGV4ZWN1dGUgYW4gUGFzc3RocnVQcmVkaWNhdGUgZXhwcmVzc2lvbiBhZ2FpbnN0IHRoZSBsb2NhbCBjYWNoZTogXCIgKyB0aGlzLnZhbHVlKTtcclxuICB9LFxyXG5cclxuICB1bmFyeVByZWRpY2F0ZTogZnVuY3Rpb24gKHRoaXM6IFVuYXJ5UHJlZGljYXRlLCBjb250ZXh0OiBWaXNpdENvbnRleHQpIHtcclxuICAgIGxldCBwcmVkRm4gPSB0aGlzLnByZWQudmlzaXQoY29udGV4dCk7XHJcbiAgICBzd2l0Y2ggKHRoaXMub3Aua2V5KSB7XHJcbiAgICAgIGNhc2UgXCJub3RcIjpcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVudGl0eTogYW55KSB7XHJcbiAgICAgICAgICByZXR1cm4gIXByZWRGbihlbnRpdHkpO1xyXG4gICAgICAgIH07XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCB1bmFyeSBvcGVyYXRvcjpcIiArIHRoaXMub3Aua2V5KTtcclxuICAgIH1cclxuICB9LFxyXG5cclxuICBiaW5hcnlQcmVkaWNhdGU6IGZ1bmN0aW9uICh0aGlzOiBCaW5hcnlQcmVkaWNhdGUsIGNvbnRleHQ6IFZpc2l0Q29udGV4dCkge1xyXG4gICAgbGV0IGV4cHIxRm4gPSB0aGlzLmV4cHIxIS52aXNpdChjb250ZXh0KTtcclxuICAgIGxldCBleHByMkZuID0gdGhpcy5leHByMiEudmlzaXQoY29udGV4dCk7XHJcbiAgICBsZXQgZGF0YVR5cGUgPSB0aGlzLmV4cHIxIS5kYXRhVHlwZSB8fCB0aGlzLmV4cHIyIS5kYXRhVHlwZTtcclxuICAgIGxldCBscWNvID0gY29udGV4dC5lbnRpdHlUeXBlIS5tZXRhZGF0YVN0b3JlLmxvY2FsUXVlcnlDb21wYXJpc29uT3B0aW9ucztcclxuICAgIGxldCBwcmVkRm4gPSBnZXRCaW5hcnlQcmVkaWNhdGVGbih0aGlzLCBkYXRhVHlwZSBhcyBEYXRhVHlwZSwgbHFjbyk7XHJcbiAgICBpZiAocHJlZEZuID09IG51bGwpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBiaW5hcnlQcmVkaWNhdGUgb3BlcmF0b3I6XCIgKyB0aGlzLm9wLmtleSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGVudGl0eTogRW50aXR5KSB7XHJcbiAgICAgIHJldHVybiBwcmVkRm4hKGV4cHIxRm4oZW50aXR5KSwgZXhwcjJGbihlbnRpdHkpKTtcclxuICAgIH07XHJcbiAgfSxcclxuXHJcbiAgYW5kT3JQcmVkaWNhdGU6IGZ1bmN0aW9uICh0aGlzOiBBbmRPclByZWRpY2F0ZSwgY29udGV4dDogVmlzaXRDb250ZXh0KSB7XHJcbiAgICBsZXQgcHJlZEZucyA9IHRoaXMucHJlZHMubWFwKChwcmVkKSA9PiB7XHJcbiAgICAgIHJldHVybiBwcmVkLnZpc2l0KGNvbnRleHQpO1xyXG4gICAgfSk7XHJcbiAgICBzd2l0Y2ggKHRoaXMub3AhLmtleSkge1xyXG4gICAgICBjYXNlIFwiYW5kXCI6XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbnRpdHk6IGFueSkge1xyXG4gICAgICAgICAgbGV0IHJlc3VsdCA9IHByZWRGbnMucmVkdWNlKGZ1bmN0aW9uIChwcmV2LCBjdXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHByZXYgJiYgY3VyKGVudGl0eSk7XHJcbiAgICAgICAgICB9LCB0cnVlKTtcclxuICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfTtcclxuICAgICAgY2FzZSBcIm9yXCI6XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbnRpdHk6IGFueSkge1xyXG4gICAgICAgICAgbGV0IHJlc3VsdCA9IHByZWRGbnMucmVkdWNlKGZ1bmN0aW9uIChwcmV2LCBjdXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHByZXYgfHwgY3VyKGVudGl0eSk7XHJcbiAgICAgICAgICB9LCBmYWxzZSk7XHJcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBib29sZWFuIG9wZXJhdG9yOlwiICsgdGhpcy5vcCEua2V5KTtcclxuICAgIH1cclxuICB9LFxyXG5cclxuICBhbnlBbGxQcmVkaWNhdGU6IGZ1bmN0aW9uICh0aGlzOiBBbnlBbGxQcmVkaWNhdGUsIGNvbnRleHQ6IFZpc2l0Q29udGV4dCkge1xyXG4gICAgbGV0IGV4cHJGbiA9IHRoaXMuZXhwci52aXNpdChjb250ZXh0KTtcclxuICAgIGxldCBuZXdDb250ZXh0ID0gY29yZS5leHRlbmQoe30sIGNvbnRleHQpIGFzIFZpc2l0Q29udGV4dDtcclxuICAgIG5ld0NvbnRleHQuZW50aXR5VHlwZSA9IHRoaXMuZXhwci5kYXRhVHlwZSBhcyBFbnRpdHlUeXBlO1xyXG4gICAgbGV0IHByZWRGbiA9IHRoaXMucHJlZC52aXNpdChuZXdDb250ZXh0KTtcclxuICAgIGxldCBhbnlBbGxQcmVkRm4gPSBnZXRBbnlBbGxQcmVkaWNhdGVGbih0aGlzLm9wKTtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoZW50aXR5OiBhbnkpIHtcclxuICAgICAgcmV0dXJuIGFueUFsbFByZWRGbihleHByRm4oZW50aXR5KSwgcHJlZEZuKTtcclxuICAgIH07XHJcbiAgfSxcclxuXHJcbiAgbGl0RXhwcjogZnVuY3Rpb24gKHRoaXM6IExpdEV4cHIpIHtcclxuICAgIGxldCB2YWx1ZSA9IHRoaXMudmFsdWU7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGVudGl0eTogYW55KSB7XHJcbiAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgIH07XHJcbiAgfSxcclxuXHJcbiAgcHJvcEV4cHI6IGZ1bmN0aW9uICh0aGlzOiBQcm9wRXhwcikge1xyXG4gICAgbGV0IHByb3BlcnR5UGF0aCA9IHRoaXMucHJvcGVydHlQYXRoO1xyXG4gICAgbGV0IHByb3BlcnRpZXMgPSBwcm9wZXJ0eVBhdGguc3BsaXQoJy4nKTtcclxuICAgIGlmIChwcm9wZXJ0aWVzLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGVudGl0eTogYW55KSB7XHJcbiAgICAgICAgcmV0dXJuIGVudGl0eS5nZXRQcm9wZXJ0eShwcm9wZXJ0eVBhdGgpO1xyXG4gICAgICB9O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbnRpdHk6IEVudGl0eSkge1xyXG4gICAgICAgIHJldHVybiBFbnRpdHlBc3BlY3QuZ2V0UHJvcGVydHlQYXRoVmFsdWUoZW50aXR5LCBwcm9wZXJ0aWVzKTtcclxuICAgICAgfTtcclxuICAgIH1cclxuICB9LFxyXG5cclxuICBmbkV4cHI6IGZ1bmN0aW9uICh0aGlzOiBGbkV4cHIsIGNvbnRleHQ6IEV4cHJlc3Npb25Db250ZXh0KSB7XHJcbiAgICBsZXQgZXhwckZucyA9IHRoaXMuZXhwcnMubWFwKGZ1bmN0aW9uIChleHByKSB7XHJcbiAgICAgIHJldHVybiBleHByLnZpc2l0KGNvbnRleHQpO1xyXG4gICAgfSk7XHJcbiAgICBsZXQgdGhhdCA9IHRoaXM7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGVudGl0eTogYW55KSB7XHJcbiAgICAgIGxldCB2YWx1ZXMgPSBleHByRm5zLm1hcChmdW5jdGlvbiAoZXhwckZuKSB7XHJcbiAgICAgICAgbGV0IHZhbHVlID0gZXhwckZuKGVudGl0eSk7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICB9KTtcclxuICAgICAgbGV0IHJlc3VsdCA9IHRoYXQubG9jYWxGbi5hcHBseShudWxsLCB2YWx1ZXMpO1xyXG4gICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICB9XHJcblxyXG59O1xyXG5cclxuZnVuY3Rpb24gZ2V0QW55QWxsUHJlZGljYXRlRm4ob3A6IE9wKTogKHYxOiBhbnlbXSwgdjI6IGFueSkgPT4gYm9vbGVhbiB7XHJcbiAgc3dpdGNoIChvcC5rZXkpIHtcclxuICAgIGNhc2UgXCJhbnlcIjpcclxuICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2MSwgdjIpIHtcclxuICAgICAgICByZXR1cm4gdjEuc29tZShmdW5jdGlvbiAodikge1xyXG4gICAgICAgICAgcmV0dXJuIHYyKHYpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG4gICAgY2FzZSBcImFsbFwiOlxyXG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHYxLCB2Mikge1xyXG4gICAgICAgIHJldHVybiB2MS5ldmVyeShmdW5jdGlvbiAodikge1xyXG4gICAgICAgICAgcmV0dXJuIHYyKHYpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9O1xyXG4gICAgZGVmYXVsdDpcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5rbm93biBvcGVyYXRvcjogXCIgKyBvcC5rZXkpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0QmluYXJ5UHJlZGljYXRlRm4oYmluYXJ5UHJlZGljYXRlOiBCaW5hcnlQcmVkaWNhdGUsIGRhdGFUeXBlOiBEYXRhVHlwZSwgbHFjbzogTG9jYWxRdWVyeUNvbXBhcmlzb25PcHRpb25zKSB7XHJcbiAgbGV0IG9wID0gYmluYXJ5UHJlZGljYXRlLm9wO1xyXG4gIGxldCBtYyA9IERhdGFUeXBlLmdldENvbXBhcmFibGVGbihkYXRhVHlwZSk7XHJcbiAgbGV0IHByZWRGbjogKHYxOiBhbnksIHYyOiBhbnkpID0+IGJvb2xlYW47XHJcbiAgc3dpdGNoIChvcC5rZXkpIHtcclxuICAgIGNhc2UgJ2VxJzpcclxuICAgICAgcHJlZEZuID0gZnVuY3Rpb24gKHYxLCB2Mikge1xyXG4gICAgICAgIGlmICh2MSAmJiB0eXBlb2YgdjEgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICByZXR1cm4gc3RyaW5nRXF1YWxzKHYxLCB2MiwgbHFjbyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiBtYyh2MSkgPT09IG1jKHYyKTtcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAnbmUnOlxyXG4gICAgICBwcmVkRm4gPSBmdW5jdGlvbiAodjEsIHYyKSB7XHJcbiAgICAgICAgaWYgKHYxICYmIHR5cGVvZiB2MSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgIHJldHVybiAhc3RyaW5nRXF1YWxzKHYxLCB2MiwgbHFjbyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiBtYyh2MSkgIT09IG1jKHYyKTtcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAnZ3QnOlxyXG4gICAgICBwcmVkRm4gPSBmdW5jdGlvbiAodjEsIHYyKSB7XHJcbiAgICAgICAgcmV0dXJuIG1jKHYxKSA+IG1jKHYyKTtcclxuICAgICAgfTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlICdnZSc6XHJcbiAgICAgIHByZWRGbiA9IGZ1bmN0aW9uICh2MSwgdjIpIHtcclxuICAgICAgICByZXR1cm4gbWModjEpID49IG1jKHYyKTtcclxuICAgICAgfTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlICdsdCc6XHJcbiAgICAgIHByZWRGbiA9IGZ1bmN0aW9uICh2MSwgdjIpIHtcclxuICAgICAgICByZXR1cm4gbWModjEpIDwgbWModjIpO1xyXG4gICAgICB9O1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgJ2xlJzpcclxuICAgICAgcHJlZEZuID0gZnVuY3Rpb24gKHYxLCB2Mikge1xyXG4gICAgICAgIHJldHVybiBtYyh2MSkgPD0gbWModjIpO1xyXG4gICAgICB9O1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgJ3N0YXJ0c3dpdGgnOlxyXG4gICAgICBwcmVkRm4gPSBmdW5jdGlvbiAodjEsIHYyKSB7XHJcbiAgICAgICAgcmV0dXJuIHN0cmluZ1N0YXJ0c1dpdGgodjEsIHYyLCBscWNvKTtcclxuICAgICAgfTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlICdlbmRzd2l0aCc6XHJcbiAgICAgIHByZWRGbiA9IGZ1bmN0aW9uICh2MSwgdjIpIHtcclxuICAgICAgICByZXR1cm4gc3RyaW5nRW5kc1dpdGgodjEsIHYyLCBscWNvKTtcclxuICAgICAgfTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlICdjb250YWlucyc6XHJcbiAgICAgIHByZWRGbiA9IGZ1bmN0aW9uICh2MSwgdjIpIHtcclxuICAgICAgICByZXR1cm4gc3RyaW5nQ29udGFpbnModjEsIHYyLCBscWNvKTtcclxuICAgICAgfTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlICdpbic6XHJcbiAgICAgIHByZWRGbiA9IGZ1bmN0aW9uICh2MTogYW55LCB2MjogYW55W10pIHtcclxuICAgICAgICB2MSA9IG1jKHYxKTtcclxuICAgICAgICB2MiA9IHYyLm1hcChmdW5jdGlvbiAodikgeyByZXR1cm4gbWModik7IH0pO1xyXG4gICAgICAgIHJldHVybiB2Mi5pbmRleE9mKHYxKSA+PSAwO1xyXG4gICAgICB9O1xyXG4gICAgICBicmVhaztcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuICByZXR1cm4gcHJlZEZuO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzdHJpbmdFcXVhbHMoYTogYW55LCBiOiBhbnksIGxxY286IExvY2FsUXVlcnlDb21wYXJpc29uT3B0aW9ucykge1xyXG4gIGlmIChiID09IG51bGwpIHJldHVybiBmYWxzZTtcclxuICBpZiAodHlwZW9mIGIgIT09ICdzdHJpbmcnKSB7XHJcbiAgICBiID0gYi50b1N0cmluZygpO1xyXG4gIH1cclxuICBpZiAobHFjby51c2VzU3FsOTJDb21wbGlhbnRTdHJpbmdDb21wYXJpc29uKSB7XHJcbiAgICBhID0gKGEgfHwgXCJcIikudHJpbSgpO1xyXG4gICAgYiA9IChiIHx8IFwiXCIpLnRyaW0oKTtcclxuICB9XHJcbiAgaWYgKCFscWNvLmlzQ2FzZVNlbnNpdGl2ZSkge1xyXG4gICAgYSA9IChhIHx8IFwiXCIpLnRvTG93ZXJDYXNlKCk7XHJcbiAgICBiID0gKGIgfHwgXCJcIikudG9Mb3dlckNhc2UoKTtcclxuICB9XHJcbiAgcmV0dXJuIGEgPT09IGI7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHN0cmluZ1N0YXJ0c1dpdGgoYTogYW55LCBiOiBhbnksIGxxY286IExvY2FsUXVlcnlDb21wYXJpc29uT3B0aW9ucykge1xyXG4gIGlmICghbHFjby5pc0Nhc2VTZW5zaXRpdmUpIHtcclxuICAgIGEgPSAoYSB8fCBcIlwiKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgYiA9IChiIHx8IFwiXCIpLnRvTG93ZXJDYXNlKCk7XHJcbiAgfVxyXG4gIHJldHVybiBjb3JlLnN0cmluZ1N0YXJ0c1dpdGgoYSwgYik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHN0cmluZ0VuZHNXaXRoKGE6IGFueSwgYjogYW55LCBscWNvOiBMb2NhbFF1ZXJ5Q29tcGFyaXNvbk9wdGlvbnMpIHtcclxuICBpZiAoIWxxY28uaXNDYXNlU2Vuc2l0aXZlKSB7XHJcbiAgICBhID0gKGEgfHwgXCJcIikudG9Mb3dlckNhc2UoKTtcclxuICAgIGIgPSAoYiB8fCBcIlwiKS50b0xvd2VyQ2FzZSgpO1xyXG4gIH1cclxuICByZXR1cm4gY29yZS5zdHJpbmdFbmRzV2l0aChhLCBiKTtcclxufVxyXG5cclxuZnVuY3Rpb24gc3RyaW5nQ29udGFpbnMoYTogYW55LCBiOiBhbnksIGxxY286IExvY2FsUXVlcnlDb21wYXJpc29uT3B0aW9ucykge1xyXG4gIGlmICghbHFjby5pc0Nhc2VTZW5zaXRpdmUpIHtcclxuICAgIGEgPSAoYSB8fCBcIlwiKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgYiA9IChiIHx8IFwiXCIpLnRvTG93ZXJDYXNlKCk7XHJcbiAgfVxyXG4gIHJldHVybiBhLmluZGV4T2YoYikgPj0gMDtcclxufVxyXG5cclxuLy8gdG9KU09OVmlzaXRvclxyXG5cclxubGV0IHRvSlNPTlZpc2l0b3IgPSB7XHJcblxyXG4gIHBhc3N0aHJ1UHJlZGljYXRlOiBmdW5jdGlvbiAodGhpczogUGFzc3RocnVQcmVkaWNhdGUpIHtcclxuICAgIHJldHVybiB0aGlzLnZhbHVlO1xyXG4gIH0sXHJcblxyXG4gIHVuYXJ5UHJlZGljYXRlOiBmdW5jdGlvbiAodGhpczogVW5hcnlQcmVkaWNhdGUsIGNvbnRleHQ6IFZpc2l0Q29udGV4dCkge1xyXG4gICAgbGV0IHByZWRWYWwgPSB0aGlzLnByZWQudmlzaXQoY29udGV4dCk7XHJcbiAgICBsZXQganNvbiA9IHt9O1xyXG4gICAganNvblt0aGlzLm9wLmtleV0gPSBwcmVkVmFsO1xyXG4gICAgcmV0dXJuIGpzb247XHJcbiAgfSxcclxuXHJcbiAgYmluYXJ5UHJlZGljYXRlOiBmdW5jdGlvbiAodGhpczogQmluYXJ5UHJlZGljYXRlLCBjb250ZXh0OiBWaXNpdENvbnRleHQpIHtcclxuICAgIGxldCBleHByMVZhbCA9IHRoaXMuZXhwcjEhLnZpc2l0KGNvbnRleHQpO1xyXG4gICAgbGV0IGV4cHIyVmFsID0gdGhpcy5leHByMiEudmlzaXQoY29udGV4dCk7XHJcbiAgICBsZXQganNvbiA9IHt9O1xyXG4gICAgaWYgKHRoaXMuZXhwcjIgaW5zdGFuY2VvZiBQcm9wRXhwcikge1xyXG4gICAgICBleHByMlZhbCA9IHsgdmFsdWU6IGV4cHIyVmFsLCBpc1Byb3BlcnR5OiB0cnVlIH07XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5vcC5rZXkgPT09IFwiZXFcIikge1xyXG4gICAgICBqc29uW2V4cHIxVmFsXSA9IGV4cHIyVmFsO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbGV0IHZhbHVlID0ge307XHJcbiAgICAgIGpzb25bZXhwcjFWYWxdID0gdmFsdWU7XHJcbiAgICAgIHZhbHVlW3RoaXMub3Aua2V5XSA9IGV4cHIyVmFsO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGpzb247XHJcbiAgfSxcclxuXHJcbiAgYW5kT3JQcmVkaWNhdGU6IGZ1bmN0aW9uICh0aGlzOiBBbmRPclByZWRpY2F0ZSwgY29udGV4dDogVmlzaXRDb250ZXh0KSB7XHJcbiAgICBsZXQgcHJlZFZhbHMgPSB0aGlzLnByZWRzLm1hcChmdW5jdGlvbiAocHJlZCkge1xyXG4gICAgICByZXR1cm4gcHJlZC52aXNpdChjb250ZXh0KTtcclxuICAgIH0pO1xyXG4gICAgaWYgKCFwcmVkVmFscyB8fCAhcHJlZFZhbHMubGVuZ3RoKSB7XHJcbiAgICAgIHJldHVybiB7fTtcclxuICAgIH1cclxuICAgIGxldCBqc29uOiBPYmplY3QgfCB1bmRlZmluZWQ7XHJcbiAgICAvLyBub3JtYWxpemVBbmQgY2xhdXNlcyBpZiBwb3NzaWJsZS5cclxuICAgIC8vIHBhc3N0aHJ1IHByZWRpY2F0ZSB3aWxsIGFwcGVhciBhcyBzdHJpbmcgYW5kIHRoZWlyICdhbmRzJyBjYW4ndCBiZSAnbm9ybWFsaXplZCdcclxuICAgIGlmICh0aGlzLm9wIS5rZXkgPT09ICdhbmQnICYmIHByZWRWYWxzLmxlbmd0aCA9PT0gMiAmJiAhcHJlZFZhbHMuc29tZSgodikgPT4gdHlwZW9mKHYpID09PSAnc3RyaW5nJykpIHtcclxuICAgICAgLy8gbm9ybWFsaXplICdhbmQnIGNsYXVzZXMgLSB3aWxsIHJldHVybiBudWxsIGlmIGNhbid0IGJlIGNvbWJpbmVkLlxyXG4gICAgICBqc29uID0gcHJlZFZhbHMucmVkdWNlKGNvbWJpbmUpO1xyXG4gICAgfVxyXG4gICAgaWYgKGpzb24gPT0gbnVsbCkge1xyXG4gICAgICBqc29uID0ge307XHJcbiAgICAgIGpzb25bdGhpcy5vcCEua2V5IV0gPSBwcmVkVmFscztcclxuICAgIH1cclxuICAgIHJldHVybiBqc29uO1xyXG4gIH0sXHJcblxyXG4gIGFueUFsbFByZWRpY2F0ZTogZnVuY3Rpb24gKHRoaXM6IEFueUFsbFByZWRpY2F0ZSwgY29udGV4dDogVmlzaXRDb250ZXh0KSB7XHJcbiAgICBsZXQgZXhwclZhbCA9IHRoaXMuZXhwci52aXNpdChjb250ZXh0KTtcclxuICAgIGxldCBuZXdDb250ZXh0ID0gY29yZS5leHRlbmQoe30sIGNvbnRleHQpIGFzIFZpc2l0Q29udGV4dDtcclxuICAgIG5ld0NvbnRleHQuZW50aXR5VHlwZSA9IHRoaXMuZXhwci5kYXRhVHlwZSBhcyBFbnRpdHlUeXBlO1xyXG4gICAgbGV0IHByZWRWYWwgPSB0aGlzLnByZWQudmlzaXQobmV3Q29udGV4dCk7XHJcbiAgICBsZXQganNvbiA9IHt9O1xyXG4gICAgbGV0IHZhbHVlID0ge307XHJcbiAgICB2YWx1ZVt0aGlzLm9wLmtleV0gPSBwcmVkVmFsO1xyXG4gICAganNvbltleHByVmFsXSA9IHZhbHVlO1xyXG4gICAgcmV0dXJuIGpzb247XHJcbiAgfSxcclxuXHJcbiAgbGl0RXhwcjogZnVuY3Rpb24gKHRoaXM6IExpdEV4cHIsIGNvbnRleHQ6IFZpc2l0Q29udGV4dCkge1xyXG4gICAgaWYgKHRoaXMuaGFzRXhwbGljaXREYXRhVHlwZSB8fCBjb250ZXh0LnVzZUV4cGxpY2l0RGF0YVR5cGUpIHtcclxuICAgICAgcmV0dXJuIHsgdmFsdWU6IHRoaXMudmFsdWUsIGRhdGFUeXBlOiB0aGlzLmRhdGFUeXBlLm5hbWUgfTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnZhbHVlO1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIHByb3BFeHByOiBmdW5jdGlvbiAodGhpczogUHJvcEV4cHIsIGNvbnRleHQ6IFZpc2l0Q29udGV4dCkge1xyXG4gICAgaWYgKGNvbnRleHQudG9OYW1lT25TZXJ2ZXIpIHtcclxuICAgICAgcmV0dXJuIGNvbnRleHQuZW50aXR5VHlwZSEuY2xpZW50UHJvcGVydHlQYXRoVG9TZXJ2ZXIodGhpcy5wcm9wZXJ0eVBhdGgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRoaXMucHJvcGVydHlQYXRoO1xyXG4gICAgfVxyXG4gIH0sXHJcblxyXG4gIGZuRXhwcjogZnVuY3Rpb24gKHRoaXM6IEZuRXhwciwgY29udGV4dDogVmlzaXRDb250ZXh0KSB7XHJcbiAgICBsZXQgZXhwclZhbHMgPSB0aGlzLmV4cHJzLm1hcChmdW5jdGlvbiAoZXhwcikge1xyXG4gICAgICByZXR1cm4gZXhwci52aXNpdChjb250ZXh0KTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHRoaXMuZm5OYW1lICsgXCIoXCIgKyBleHByVmFscy5qb2luKFwiLFwiKSArIFwiKVwiO1xyXG4gIH1cclxuXHJcbn07XHJcblxyXG5mdW5jdGlvbiBjb21iaW5lKGoxOiBPYmplY3QsIGoyOiBPYmplY3QpIHtcclxuICBsZXQgb2sgPSBPYmplY3Qua2V5cyhqMikuZXZlcnkoZnVuY3Rpb24gKGtleSkge1xyXG4gICAgaWYgKGoxLmhhc093blByb3BlcnR5KGtleSkpIHtcclxuICAgICAgaWYgKHR5cGVvZiAoajJba2V5XSkgIT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgLy8gZXhpdCBhbmQgaW5kaWNhdGUgdGhhdCB3ZSBjYW4ndCBjb21iaW5lXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChjb21iaW5lKGoxW2tleV0sIGoyW2tleV0pID09IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGoxW2tleV0gPSBqMltrZXldO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfSk7XHJcbiAgcmV0dXJuIG9rID8gajEgOiBudWxsO1xyXG59XHJcblxyXG5cclxuXHJcblxyXG4iXX0=